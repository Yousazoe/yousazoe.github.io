<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 6.2.0"><link rel="apple-touch-icon" sizes="180x180" href="/images/favicon.ico"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.ico"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.ico"><link rel="mask-icon" href="/images/favicon.ico" color="#222"><meta name="google-site-verification" content="35AYyqm-wpmGmXtkn-vQMrk7AkFl1Do55uHdlLLLT38"><meta name="baidu-site-verification" content="slBbq5f8WxljPytW"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="//fonts.proxy.ustclug.org/css?family=Lato:300,300italic,400,400italic,700,700italic&amp;display=swap&amp;subset=latin,latin-ext"><link rel="stylesheet" href="//lib.baomitu.com/font-awesome/5.15.4/css/all.min.css"><link rel="stylesheet" href="//lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css"><link rel="stylesheet" href="//unpkg.com/pace-js@1/themes/blue/pace-theme-minimal.css"><script src="//unpkg.com/pace-js@1.2.4/pace.min.js"></script><script id="hexo-configurations">var NexT=window.NexT||{},CONFIG={hostname:"yousazoe.top",root:"/",scheme:"Gemini",version:"7.8.0",exturl:!1,sidebar:{position:"left",display:"post",padding:18,offset:12,onmobile:!1},copycode:{enable:!0,show_result:!0,style:"mac"},back2top:{enable:!0,sidebar:!0,scrollpercent:!0},bookmark:{enable:!1,color:"#222",save:"auto"},fancybox:!0,mediumzoom:!1,lazyload:!0,pangu:!0,comments:{style:"tabs",active:null,storage:!0,lazyload:!0,nav:null},algolia:{hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}},localsearch:{enable:!0,trigger:"auto",top_n_per_article:3,unescape:!1,preload:!1},motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}},path:"search.xml"}</script><meta name="description" content="引言本文内容包括俯视角 2D 人物移动控制、2.5D 风格的实现一机使用协程实现相机绕玩家旋转效果。"><meta property="og:type" content="article"><meta property="og:title" content="“饥荒”风格的俯视角2.5D实现"><meta property="og:url" content="https://yousazoe.top/archives/dd9fb894.html"><meta property="og:site_name" content="Fl0w3r"><meta property="og:description" content="引言本文内容包括俯视角 2D 人物移动控制、2.5D 风格的实现一机使用协程实现相机绕玩家旋转效果。"><meta property="og:locale" content="en_US"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/Yousazoe/picgo-repo/img/image-20210803125552781.png"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/Yousazoe/picgo-repo/img/dhspi9vvaaehbva_tzpw.jpg"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/Yousazoe/picgo-repo/img/image-20210803125620842.png"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/Yousazoe/picgo-repo/img/image-20210803125700030.png"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/Yousazoe/picgo-repo/img/image-20210803125714566.png"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/Yousazoe/picgo-repo/img/image-20210803125726008.png"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/Yousazoe/picgo-repo/img/image-20210803125753430.png"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/Yousazoe/picgo-repo/img/image-20210803125816129.png"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/Yousazoe/picgo-repo/img/image-20210803125829053.png"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/Yousazoe/picgo-repo/img/image-20210803125841648.png"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/Yousazoe/picgo-repo/img/image-20210803125853446.png"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/Yousazoe/picgo-repo/img/image-20210803125902527.png"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/Yousazoe/picgo-repo/img/image-20210803125916854.png"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/Yousazoe/picgo-repo/img/image-20210803125925573.png"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/Yousazoe/picgo-repo/img/image-20210803125937902.png"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/Yousazoe/picgo-repo/img/image-20210803125947474.png"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/Yousazoe/picgo-repo/img/image-20210803130006577.png"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/Yousazoe/picgo-repo/img/image-20210803210909958.png"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/Yousazoe/picgo-repo/img/image-20210803210647649.png"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/Yousazoe/picgo-repo/img/image-20210803210713332.png"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/Yousazoe/picgo-repo/img/image-20210803211949168.png"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/Yousazoe/picgo-repo/img/image-20210803212059578.png"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/Yousazoe/picgo-repo/img/image-20210803210129592.png"><meta property="article:published_time" content="2021-08-03T02:55:52.000Z"><meta property="article:modified_time" content="2022-07-28T04:04:36.669Z"><meta property="article:author" content="Yousazoe"><meta property="article:tag" content="Game"><meta property="article:tag" content="Unity"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/Yousazoe/picgo-repo/img/image-20210803125552781.png"><link rel="canonical" href="https://yousazoe.top/archives/dd9fb894.html"><script id="page-configurations">CONFIG.page={sidebar:"",isHome:!1,isPost:!0,lang:"en"}</script><title>“饥荒”风格的俯视角2.5D实现 | Fl0w3r</title><noscript><style>.sidebar-inner,.use-motion .brand,.use-motion .collection-header,.use-motion .comments,.use-motion .menu-item,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header{opacity:initial}.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.use-motion .logo-line-before i{left:initial}.use-motion .logo-line-after i{right:initial}</style></noscript><link rel="alternate" href="/atom.xml" title="Fl0w3r" type="application/atom+xml"></head><body itemscope="" itemtype="http://schema.org/WebPage"><div class="container use-motion"><div class="headband"></div><header class="header" itemscope="" itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-container"><div class="site-nav-toggle"><div class="toggle" aria-label="Toggle navigation bar"><span class="toggle-line toggle-line-first"></span> <span class="toggle-line toggle-line-middle"></span> <span class="toggle-line toggle-line-last"></span></div></div><div class="site-meta"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span><h1 class="site-title">Fl0w3r</h1><span class="logo-line-after"><i></i></span></a><p class="site-subtitle" itemprop="description">carpe diem</p></div><div class="site-nav-right"><div class="toggle popup-trigger"><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class="site-nav"><ul id="menu" class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-address-card fa-fw"></i>About</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a></li><li class="menu-item menu-item-links"><a href="/links/" rel="section"><i class="fa fa-paperclip fa-fw"></i>Links</a></li><li class="menu-item menu-item-photos"><a href="/photos/" rel="section"><i class="fa fa-camera fa-fw"></i>Photos</a></li><li class="menu-item menu-item-artitalk"><a href="/artitalk/" rel="section"><i class="fa fa-calendar fa-fw"></i>Artitalk</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a></li><li class="menu-item menu-item-document"><a href="/docs/" rel="section"><i class="fas fa-book fa-fw"></i>Document</a></li><li class="menu-item menu-item-qexoadmin"><a href="https://blog-yousazoe-qexo.vercel.app/" rel="noopener" target="_blank"><i class="fa fa-database fa-fw"></i>QexoAdmin</a></li><li class="menu-item menu-item-gametracker"><a href="https://yousazoe.notion.site/yousazoe/b05999823bd14b57a7a6cd81fba1a1af?v=21c3398e0bdb429c9b8157b7bf12ff6a" rel="noopener" target="_blank"><i class="fas fa-trophy fa-fw"></i>GameTracker</a></li><li class="menu-item menu-item-sitemap"><a href="/sitemap.xml" rel="section"><i class="fa fa-sitemap fa-fw"></i>Sitemap</a></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search</a></li></ul></nav><div class="search-pop-overlay"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"><input autocomplete="off" autocapitalize="off" placeholder="Searching..." spellcheck="false" type="search" class="search-input"></div><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span></div><div id="search-result"><div id="no-result"><i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i></div></div></div></div></div></header><div class="reading-progress-bar"></div><main class="main"><div class="main-inner"><div class="content-wrap"><div class="content post posts-expand"><article itemscope="" itemtype="http://schema.org/Article" class="post-block" lang="en"><link itemprop="mainEntityOfPage" href="https://yousazoe.top/archives/dd9fb894.html"><span hidden="" itemprop="author" itemscope="" itemtype="http://schema.org/Person"><meta itemprop="image" content="https://img.yousazoe.top/uPic/img/blog/icon/icon.jpeg"><meta itemprop="name" content="Yousazoe"><meta itemprop="description" content="done is better than perfect"></span><span hidden="" itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization"><meta itemprop="name" content="Fl0w3r"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">“饥荒”风格的俯视角2.5D实现</h1><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i> </span><span class="post-meta-item-text">Posted on</span> <time title="Created: 2021-08-03 10:55:52" itemprop="dateCreated datePublished" datetime="2021-08-03T10:55:52+08:00">2021-08-03</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-folder"></i> </span><span class="post-meta-item-text">In</span> <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/Unity-%E6%B8%B8%E6%88%8F%E5%BC%95%E6%93%8E-Unity-Game-Engine/" itemprop="url" rel="index"><span itemprop="name">Unity 游戏引擎 (Unity Game Engine)</span></a> </span></span><span class="post-meta-item" title="Views" id="busuanzi_container_page_pv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-eye"></i> </span><span class="post-meta-item-text">Views: </span><span id="busuanzi_value_page_pv"></span></span><br><span class="post-meta-item" title="Symbols count in article"><span class="post-meta-item-icon"><i class="fas fa-pen"></i></span><span>7.1k</span> </span><span class="post-meta-item" title="Reading time"><span class="post-meta-item-icon"><i class="far fa-clock"></i> </span><span>13 mins.</span></span></div></header><div class="post-body" itemprop="articleBody"><p><img data-src="https://img.yousazoe.top/uPic/img/blog/icon/mona-loading-default.gif" data-original="https://cdn.jsdelivr.net/gh/Yousazoe/picgo-repo/img/image-20210803125552781.png"></p><h3 id="引言"><a href="#引言" class="headerlink" title="引言"></a>引言</h3><p>本文内容包括俯视角 2D 人物移动控制、2.5D 风格的实现一机使用协程实现相机绕玩家旋转效果。</p><span id="more"></span><p>通常游戏按照镜头角度可以分为 2D 游戏和 3D 游戏，但还有一种独树一帜的游戏风格，将二维与三维的特点结合起来，在 2D 图像上展现出了 3D 的效果，我们称之为 2.5D，也就是伪 3D。有很多非常受欢迎的游戏都采用了这种风格，而这种风格也将它们从同类的其他游戏中凸显出来，例如《饥荒》和《八方旅人》。</p><p><img data-src="https://img.yousazoe.top/uPic/img/blog/icon/mona-loading-default.gif" data-original="https://cdn.jsdelivr.net/gh/Yousazoe/picgo-repo/img/dhspi9vvaaehbva_tzpw.jpg"></p><p>今天我们就来一起使用 Unity 制作出类似《饥荒》 的俯视角 2.5D 风格。</p><h3 id="场景搭建"><a href="#场景搭建" class="headerlink" title="场景搭建"></a>场景搭建</h3><p>首先我们来快速制作一个 2D 的俯视角场景和人物控制。首先从<a target="_blank" rel="noopener" href="https://assetstore.unity.com/packages/2d/characters/tiny-rpg-forest-114685">资源商店</a>里导入我们需要的游戏素材：</p><p><img data-src="https://img.yousazoe.top/uPic/img/blog/icon/mona-loading-default.gif" data-original="https://cdn.jsdelivr.net/gh/Yousazoe/picgo-repo/img/image-20210803125620842.png"></p><p>这个素材是免费的，你可以很容易的从资源商店找到。</p><p>接着更改素材的尺寸，然后把需要的素材的轴心设置为底部，保证 sprite 在旋转后位于地面上层：</p><p><img data-src="https://img.yousazoe.top/uPic/img/blog/icon/mona-loading-default.gif" data-original="https://cdn.jsdelivr.net/gh/Yousazoe/picgo-repo/img/image-20210803125700030.png"></p><p>在场景中创建一个瓦片地图，然后打开平铺调色板创建瓦片资源：</p><p><img data-src="https://img.yousazoe.top/uPic/img/blog/icon/mona-loading-default.gif" data-original="https://cdn.jsdelivr.net/gh/Yousazoe/picgo-repo/img/image-20210803125714566.png"></p><p>导入完成后就可以开始绘制地图了：</p><p><img data-src="https://img.yousazoe.top/uPic/img/blog/icon/mona-loading-default.gif" data-original="https://cdn.jsdelivr.net/gh/Yousazoe/picgo-repo/img/image-20210803125726008.png"></p><p>为了让场景物体和玩家有碰撞，我们给场景物体添加碰撞器。</p><p>新建一个空物体 <code>FaceObject</code>，将所有需要朝向摄像机的物体都作为这个物体的子物体，便于管理：</p><p><img data-src="https://img.yousazoe.top/uPic/img/blog/icon/mona-loading-default.gif" data-original="https://cdn.jsdelivr.net/gh/Yousazoe/picgo-repo/img/image-20210803125753430.png"></p><h3 id="角色"><a href="#角色" class="headerlink" title="角色"></a>角色</h3><p>然后就是角色。我们首先创建一个 sprite，指定它的默认精灵并重命名为 <code>Player</code>：</p><p><img data-src="https://img.yousazoe.top/uPic/img/blog/icon/mona-loading-default.gif" data-original="https://cdn.jsdelivr.net/gh/Yousazoe/picgo-repo/img/image-20210803125816129.png"></p><p>为 <code>Player</code> 设置标签 <code>Player</code>，方便之后查找。</p><p>我们需要 player 移动，与场景中的物体碰撞和播放动画，所以我们给 player 添加上刚体、碰撞体和动画控制器：</p><p><img data-src="https://img.yousazoe.top/uPic/img/blog/icon/mona-loading-default.gif" data-original="https://cdn.jsdelivr.net/gh/Yousazoe/picgo-repo/img/image-20210803125829053.png"></p><h4 id="角色动画"><a href="#角色动画" class="headerlink" title="角色动画"></a>角色动画</h4><p>选中 player 并按下 <code>ctrl</code>+<code>6</code> 快捷键打开动画窗口，将序列帧素材拖到窗口中创建新动画：</p><p><img data-src="https://img.yousazoe.top/uPic/img/blog/icon/mona-loading-default.gif" data-original="https://cdn.jsdelivr.net/gh/Yousazoe/picgo-repo/img/image-20210803125841648.png"></p><p>然后我们打开动画器，可以看到动画已经导入了。这里我们用 blendtree 快速实现动画的过渡，右键 create stat，选择 blendtree 重命名为 <code>walk</code>：</p><p><img data-src="https://img.yousazoe.top/uPic/img/blog/icon/mona-loading-default.gif" data-original="https://cdn.jsdelivr.net/gh/Yousazoe/picgo-repo/img/image-20210803125853446.png"></p><p>双击这个节点打开新混合树。目前这个混合树只接受一个输入参数，我们需要两个输入参数来表示二维平面上的移动。选择类型为 2D simple directional，这样我们就有两个可接受的参数了：</p><p><img data-src="https://img.yousazoe.top/uPic/img/blog/icon/mona-loading-default.gif" data-original="https://cdn.jsdelivr.net/gh/Yousazoe/picgo-repo/img/image-20210803125902527.png"></p><p>所以我们创建两个 <code>float</code> 类型的参数，分别取名为 <code>InputX</code> 和 <code>InputY</code>：</p><p><img data-src="https://img.yousazoe.top/uPic/img/blog/icon/mona-loading-default.gif" data-original="https://cdn.jsdelivr.net/gh/Yousazoe/picgo-repo/img/image-20210803125916854.png"></p><p>然后在混合树中就可以选择接受的两个参数了。我们选择好刚创建的两个参数，点击加号添加要混合的动画：</p><p><img data-src="https://img.yousazoe.top/uPic/img/blog/icon/mona-loading-default.gif" data-original="https://cdn.jsdelivr.net/gh/Yousazoe/picgo-repo/img/image-20210803125925573.png"></p><p>设置完之后我们可以拖动屏幕中心的红点来模拟输入，混合树会自动的对我们输入的值进行判断播放哪个动画。然后我们还需要静止的画面，回到上一层同样创建一个混合树用来播放静止动画，命名为 <code>idle</code>，再创建一个 <code>bool</code> 变量 <code>isMoving</code> 来切换两组动画：</p><p><img data-src="https://img.yousazoe.top/uPic/img/blog/icon/mona-loading-default.gif" data-original="https://cdn.jsdelivr.net/gh/Yousazoe/picgo-repo/img/image-20210803125937902.png"></p><p>设置好两个混合树的切换条件：</p><p><img data-src="https://img.yousazoe.top/uPic/img/blog/icon/mona-loading-default.gif" data-original="https://cdn.jsdelivr.net/gh/Yousazoe/picgo-repo/img/image-20210803125947474.png"></p><p>设置 <code>idle</code> 混合树的混合动画：</p><p><img data-src="https://img.yousazoe.top/uPic/img/blog/icon/mona-loading-default.gif" data-original="https://cdn.jsdelivr.net/gh/Yousazoe/picgo-repo/img/image-20210803130006577.png"></p><h4 id="角色控制"><a href="#角色控制" class="headerlink" title="角色控制"></a>角色控制</h4><p>接下来我们来编写一个简单的程序控制 <code>Player</code> 的移动。新建 C# 脚本起名为 <code>PlayerMovement</code>，然后打开它，首先设置好需要的变量：</p><figure class="highlight c#"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="built_in">float</span> speed;</span><br><span class="line"><span class="keyword">new</span> <span class="keyword">private</span> Rigidbody2D rigidbody;</span><br><span class="line"><span class="keyword">private</span> Animator animator;</span><br><span class="line"><span class="keyword">private</span> <span class="built_in">float</span> inputX, inputY;</span><br></pre></td></tr></tbody></table></figure><p>其中 <code>speed</code> 控制移动速度，<code>rigidbody</code> 和 <code>animator</code> 获取刚体和控制体，<code>inputX</code> 和 <code>inputY</code> 获取键盘上的方向输入。在 <code>Start()</code> 函数中通过变量获取 <code>Player</code> 相应组件方便后续使用：</p><figure class="highlight c#"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Start</span>()</span></span><br><span class="line">{</span><br><span class="line">    rigidbody = GetComponent&lt;Rigidbody2D&gt;();</span><br><span class="line">    animator = GetComponent&lt;Animator&gt;();</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>然后在 <code>Update()</code> 函数中实时获取到玩家的输入信息，使用 <code>GetAxisRaw()</code> 获取玩家的输入，这个函数会根据参数字符串获取到不同的玩家输入：</p><figure class="highlight c#"><table><tbody><tr><td class="code"><pre><span class="line">inputX = Input.GetAxisRaw(<span class="string">"Horizontal"</span>);</span><br><span class="line">inputY = Input.GetAxisRaw(<span class="string">"Vertical"</span>);</span><br></pre></td></tr></tbody></table></figure><p>例如我这里输入 Horizontal 也就是水平的英文单词，这个参数会自动获取我的左右和 AD 这两组按键并返回一个 -1 到 1 的值，可以用这种方法非常快速的获取到玩家输入。按键对应的字符串可在 Edit - Project Setting 中的 Input Manager 中找到：</p><p><img data-src="https://img.yousazoe.top/uPic/img/blog/icon/mona-loading-default.gif" data-original="https://cdn.jsdelivr.net/gh/Yousazoe/picgo-repo/img/image-20210803210909958.png"></p><p>我们现在就可以找到垂直输入的参数是 Vertical，它对应的按键是上下和 WS。回到脚本中获取到 Y 轴的输入，用一个 <code>Vector2</code> 向量接受输入并进行 normalized 标准化：</p><figure class="highlight c#"><table><tbody><tr><td class="code"><pre><span class="line">Vector2 input = (transform.right * inputX + transform.up * inputY).normalized;</span><br></pre></td></tr></tbody></table></figure><p>然后使用这个变量乘以速度赋值给刚体的速度：</p><figure class="highlight c#"><table><tbody><tr><td class="code"><pre><span class="line">rigidbody.velocity = input * speed;</span><br></pre></td></tr></tbody></table></figure><p>那么为什么需要将向量标准化呢？我们先取消标准化然后运行游戏，人物现在可以在场景中自由移动了，但当同时按下 X 轴和 Y 轴的按键时角色的移动会比正常情况下更快，这是因为 X 轴的速度和 Y 轴的速度叠加了。事实上我们只需要速度的方向，因此这个向量的长度必须是 1，而标准化后的向量方向不会变，而大小被限制成了 1。现在加上标准化再次运行，可以看到速度没有异常了。</p><p>接下来来控制动画的播放。当存在输入的时候，也就是 <code>inputX</code> 或 <code>inputY</code> 不为零的时候，修改动画控制器为 <code>true</code>，否则为 <code>false</code>：</p><p>运行游戏，可以看到移动时的动画在正常播放，但不会停在原来的方向。我们查看动画器可以发现，一旦我们停止输入，动画器的参数就会归零，而混合树则会默认播放第一个动画。</p><p>我们的解决办法是传给动画器有效的输入，新增两个变量 <code>stopX</code> 和 <code>stopY</code> 记录输入不为零的部分，当存在输入的时候才更新这两个值，然后将这两个值传给动画器：</p><figure class="highlight c#"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (input != Vector2.zero)</span><br><span class="line">{</span><br><span class="line">  animator.SetBool(<span class="string">"isMoving"</span>, <span class="literal">true</span>);</span><br><span class="line">  stopX = inputX;</span><br><span class="line">  stopY = inputY;</span><br><span class="line">}</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">{</span><br><span class="line">  animator.SetBool(<span class="string">"isMoving"</span>, <span class="literal">false</span>);</span><br><span class="line">}</span><br><span class="line">animator.SetFloat(<span class="string">"InputX"</span>, stopX);</span><br><span class="line">animator.SetFloat(<span class="string">"InputY"</span>, stopY);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>再次运行，可以看到我们的动画已经完美运行了。</p><h3 id="视角"><a href="#视角" class="headerlink" title="视角"></a>视角</h3><p>接下来就是重头部分了，我们将把这个场景从 2D 扩展到 2.5D。事实上 Unity 的 2D 是基于 3D 的，我们只需要点击这个 2D 按钮取消 2D 模式，Unity 就会回到 3D视图：</p><p><img data-src="https://img.yousazoe.top/uPic/img/blog/icon/mona-loading-default.gif" data-original="https://cdn.jsdelivr.net/gh/Yousazoe/picgo-repo/img/image-20210803210647649.png"></p><h4 id="透视投影"><a href="#透视投影" class="headerlink" title="透视投影"></a>透视投影</h4><p>在这个视图下我们可以调整相机的角度俯视地图，不过首先要修改相机的投影模式，修改为透视。这个模式通常用于 3D，有近大远小的感觉：</p><p><img data-src="https://img.yousazoe.top/uPic/img/blog/icon/mona-loading-default.gif" data-original="https://cdn.jsdelivr.net/gh/Yousazoe/picgo-repo/img/image-20210803210713332.png"></p><p>你可以随意更改相机的角度，不过我推荐 45 度，这是最常用的视角，能最大程度的平衡玩家和视野场景：</p><p><img data-src="https://img.yousazoe.top/uPic/img/blog/icon/mona-loading-default.gif" data-original="https://cdn.jsdelivr.net/gh/Yousazoe/picgo-repo/img/image-20210803211949168.png"></p><p>然后编写简单脚本来控制场景中的物体都朝向摄像机。新建 C# 脚本，起名为 <code>FacingCamera</code>，将脚本添加到场景副物体上，进入脚本。</p><p>首先我们需要一个数组变量来获取这个物体的所有子物体，在 <code>Start()</code> 方法中循环遍历所有子物体并存储下来：</p><figure class="highlight c#"><table><tbody><tr><td class="code"><pre><span class="line">Transform[] childs;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Start</span>()</span></span><br><span class="line">{</span><br><span class="line">	childs = <span class="keyword">new</span> Transform[transform.childCount];</span><br><span class="line">	<span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; transform.childCount; i++)</span><br><span class="line">  {</span><br><span class="line">		childs[i] = transform.GetChild(i);</span><br><span class="line">	}</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>在 <code>Update()</code> 方法中遍历子物体，并让子物体的旋转值设置成和 camera 一样：</p><figure class="highlight c#"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Update</span>()</span></span><br><span class="line">{</span><br><span class="line">	<span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; childs.Length; i++)</span><br><span class="line">	{</span><br><span class="line">	childs[i].rotation = Camera.main.transform.rotation;</span><br><span class="line">	}</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>这样场景中的所有 sprite 就会始终朝向摄像机了，再在 <code>PlayerMovement</code> 脚本中加上简单的相机跟随 Player 位置代码：</p><figure class="highlight diff"><table><tbody><tr><td class="code"><pre><span class="line">......</span><br><span class="line"><span class="addition">+private Vector3 offset;</span></span><br><span class="line"></span><br><span class="line">void Start()</span><br><span class="line">{</span><br><span class="line"><span class="addition">+	offset = Camera.main.transform.position - transform.position;</span></span><br><span class="line">	......</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">void Update()</span><br><span class="line">{</span><br><span class="line">	......</span><br><span class="line"><span class="addition">+	Camera.main.transform.position += offset;</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>最后在项目设置 - 图形设置透明度排序模式为透视，这将让 sprite 根据距离相机远近渲染先后顺序：</p><p><img data-src="https://img.yousazoe.top/uPic/img/blog/icon/mona-loading-default.gif" data-original="https://cdn.jsdelivr.net/gh/Yousazoe/picgo-repo/img/image-20210803212059578.png"></p><p>运行场景，这样一个还不错的 2.5D 场景就制作完成了。</p><h4 id="旋转视角"><a href="#旋转视角" class="headerlink" title="旋转视角"></a>旋转视角</h4><p>但在最后我们要再实现一个《饥荒》中的小功能：按下 <code>q</code> 和 <code>e</code> 键旋转摄像机，这让我们可以更全面的观察整个场景。</p><p>《饥荒》中的摄像机是围绕着玩家旋转的，每次旋转 45 度，那么如何让摄像机围绕玩家旋转呢？我们可以使用 <code>RotateAround()</code> 方法，但经过我的测试，这种方法并不好用。然后我发现，其实没必要让摄像机主动转起来，只需要让摄像机作为子物体，旋转父物体就会让摄像机被动地绕父物体旋转。所以我们先让摄像机作为玩家的子物体，再旋转玩家，就可以看到绕玩家旋转的效果。</p><p>但我们没办法就这样简单的旋转玩家控制摄像机，还记得刚刚的 <code>FacingCamera</code> 脚本吗？<code>Player</code> 的旋转角度实际上是受摄像机的旋转角度控制的，所以我们新建一个空物体，起名为 <code>CameraPosition</code>并把摄像机作为子物体，这样我们就可以通过旋转或移动这个物体控制摄像机的位置和旋转。</p><p>为这个物体新建脚本 <code>RotatingCamera</code>，进入脚本。首先我们要删掉之前在 <code>PlayerMovement</code> 脚本中的相机跟随脚本。</p><p>我们需要一个公有变量控制一次旋转需要的时间 <code>rotateTime</code>，然后需要一个变量 <code>player</code> 来获取 <code>Player</code> 的位置，还需要一个 <code>bool</code> 类型的变量 <code>isRotating</code> 来防止多次旋转冲突：</p><figure class="highlight c#"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="built_in">float</span> rotateTime = <span class="number">0.2f</span>;</span><br><span class="line"><span class="keyword">private</span> Transform player;</span><br><span class="line"><span class="keyword">private</span> <span class="built_in">bool</span> isRotating = <span class="literal">false</span>;</span><br></pre></td></tr></tbody></table></figure><p>在 <code>Start()</code> 函数中获取到 <code>Player</code> 的 <code>Transform</code>，在 <code>Update()</code> 函数中让摄像机的位置一直跟随玩家，然后编写控制旋转的函数 <code>Rotate()</code> 和进行旋转的协程函数：</p><figure class="highlight c#"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Start</span>()</span></span><br><span class="line">{</span><br><span class="line">	player = GameObject.FindGameObjectWithTag(<span class="string">"Player"</span>).transform;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Update</span>()</span></span><br><span class="line">{</span><br><span class="line">	transform.position = player.position;</span><br><span class="line">	Rotate();</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>这里简单解释一下协程函数的概念。在普通的函数中，无论内部有多少代码，进行多少次循环，都将在 1 帧内执行完，着就导致我们无法在普通函数中使用循环来做一个持续进行的效果。如果不幸遇到了死循环，还会导致 Unity 失去响应，这时候就需要用到协程函数，这种函数内部在执行时可以先暂停执行，等到固定的时间后继续执行，加上循环后给人的感觉就像是一个可以设置更新频率，自动停止的 <code>Update()</code> 函数，可以很方便的制作程序性动画或一个循序渐进的效果。</p><p>协程函数没有返回值但可以有参数，在声明的时候必须使用 <code>IEnumerator</code> 关键字。我们创建一个协程，取名为 <code>RotateAround()</code>，传入两个参数，分别为旋转的角度和旋转的时间。</p><p>然后首先计算出需要旋转多少次，我这里是用 <code>FixUpdate()</code> 的帧率更新的，1 秒执行 60次。接着根据次数和总角度计算每次需要旋转多少度。</p><p>接下来开始循环计算出的次数，每次旋转一个较小的度数，然后使用 <code>yield return new WaitForFixedUpdate</code> 暂停执行，等到下一帧时继续执行下个循环：</p><figure class="highlight c#"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function">IEnumerator <span class="title">RotateAround</span>(<span class="params"><span class="built_in">float</span> angel, <span class="built_in">float</span> time</span>)</span></span><br><span class="line">{</span><br><span class="line">	<span class="built_in">float</span> number = <span class="number">60</span> * time;</span><br><span class="line">	<span class="built_in">float</span> nextAngel = angel / number;</span><br><span class="line">	isRotating = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; number; i++)</span><br><span class="line">	{</span><br><span class="line">		transform.Rotate(<span class="keyword">new</span> Vector3(<span class="number">0</span>, <span class="number">0</span>, nextAngel));</span><br><span class="line">		<span class="function"><span class="keyword">yield</span> <span class="keyword">return</span> <span class="keyword">new</span> <span class="title">WaitForFixedUpdate</span>()</span>;</span><br><span class="line">	}</span><br><span class="line"></span><br><span class="line">	isRotating = <span class="literal">false</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>开启协程需要使用 <code>StartCoroutine()</code> 函数，传入 -45 角度和时间，按照同样的方法写出 <code>e</code> 的旋转：</p><figure class="highlight c#"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Rotate</span>()</span></span><br><span class="line">{</span><br><span class="line">  <span class="keyword">if</span> (Input.GetKeyDown(KeyCode.Q) &amp;&amp; !isRotating)</span><br><span class="line">  {</span><br><span class="line">    StartCoroutine(RotateAround(<span class="number">-45</span>, rotateTime));</span><br><span class="line">  }</span><br><span class="line">  <span class="keyword">if</span> (Input.GetKeyDown(KeyCode.E) &amp;&amp; !isRotating)</span><br><span class="line">  {</span><br><span class="line">    StartCoroutine(RotateAround(<span class="number">45</span>, rotateTime));</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>回到 Unity 开始运行，可以看到我们的旋转效果已经成功运行了：</p><p><img data-src="https://img.yousazoe.top/uPic/img/blog/icon/mona-loading-default.gif" data-original="https://cdn.jsdelivr.net/gh/Yousazoe/picgo-repo/img/image-20210803210129592.png"></p><h3 id="源码"><a href="#源码" class="headerlink" title="源码"></a>源码</h3><h4 id="PlayerMovement"><a href="#PlayerMovement" class="headerlink" title="PlayerMovement"></a>PlayerMovement</h4><figure class="highlight c#"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">using</span> System.Collections;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">PlayerMovement</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">{</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">float</span> speed;</span><br><span class="line">    <span class="keyword">new</span> <span class="keyword">private</span> Rigidbody2D rigidbody;</span><br><span class="line">    <span class="keyword">private</span> Animator animator;</span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">float</span> inputX, inputY;</span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">float</span> stopX, stopY;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Start</span>()</span></span><br><span class="line">    {</span><br><span class="line">        rigidbody = GetComponent&lt;Rigidbody2D&gt;();</span><br><span class="line">        animator = GetComponent&lt;Animator&gt;();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Update</span>()</span></span><br><span class="line">    {</span><br><span class="line">        inputX = Input.GetAxisRaw(<span class="string">"Horizontal"</span>);</span><br><span class="line">        inputY = Input.GetAxisRaw(<span class="string">"Vertical"</span>);</span><br><span class="line">        Vector2 input = (transform.right * inputX + transform.up * inputY).normalized;</span><br><span class="line">        rigidbody.velocity = input * speed;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (input != Vector2.zero)</span><br><span class="line">        {</span><br><span class="line">            animator.SetBool(<span class="string">"isMoving"</span>, <span class="literal">true</span>);</span><br><span class="line">            stopX = inputX;</span><br><span class="line">            stopY = inputY;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        {</span><br><span class="line">            animator.SetBool(<span class="string">"isMoving"</span>, <span class="literal">false</span>);</span><br><span class="line">        }</span><br><span class="line">        animator.SetFloat(<span class="string">"InputX"</span>, stopX);</span><br><span class="line">        animator.SetFloat(<span class="string">"InputY"</span>, stopY);</span><br><span class="line"></span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h4 id="FacingCamera"><a href="#FacingCamera" class="headerlink" title="FacingCamera"></a>FacingCamera</h4><figure class="highlight c#"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">using</span> System.Collections;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">FacingCamera</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">{</span><br><span class="line">    Transform[] childs;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Start</span>()</span></span><br><span class="line">    {</span><br><span class="line">        childs = <span class="keyword">new</span> Transform[transform.childCount];</span><br><span class="line">        <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; transform.childCount; i++)</span><br><span class="line">        {</span><br><span class="line">            childs[i] = transform.GetChild(i);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Update</span>()</span></span><br><span class="line">    {</span><br><span class="line">        <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; childs.Length; i++)</span><br><span class="line">        {</span><br><span class="line">            childs[i].rotation = Camera.main.transform.rotation;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h4 id="RotatingCamera"><a href="#RotatingCamera" class="headerlink" title="RotatingCamera"></a>RotatingCamera</h4><figure class="highlight c#"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">using</span> System.Collections;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">RotatingCamera</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">{</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">float</span> rotateTime = <span class="number">0.2f</span>;</span><br><span class="line">    <span class="keyword">private</span> Transform player;</span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">bool</span> isRotating = <span class="literal">false</span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Start</span>()</span></span><br><span class="line">    {</span><br><span class="line">        player = GameObject.FindGameObjectWithTag(<span class="string">"Player"</span>).transform;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Update</span>()</span></span><br><span class="line">    {</span><br><span class="line">        transform.position = player.position;</span><br><span class="line"></span><br><span class="line">        Rotate();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Rotate</span>()</span></span><br><span class="line">    {</span><br><span class="line">        <span class="keyword">if</span> (Input.GetKeyDown(KeyCode.Q) &amp;&amp; !isRotating)</span><br><span class="line">        {</span><br><span class="line">            StartCoroutine(RotateAround(<span class="number">-45</span>, rotateTime));</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">if</span> (Input.GetKeyDown(KeyCode.E) &amp;&amp; !isRotating)</span><br><span class="line">        {</span><br><span class="line">            StartCoroutine(RotateAround(<span class="number">45</span>, rotateTime));</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function">IEnumerator <span class="title">RotateAround</span>(<span class="params"><span class="built_in">float</span> angel, <span class="built_in">float</span> time</span>)</span></span><br><span class="line">    {</span><br><span class="line">        <span class="built_in">float</span> number = <span class="number">60</span> * time;</span><br><span class="line">        <span class="built_in">float</span> nextAngel = angel / number;</span><br><span class="line">        isRotating = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; number; i++)</span><br><span class="line">        {</span><br><span class="line">            transform.Rotate(<span class="keyword">new</span> Vector3(<span class="number">0</span>, <span class="number">0</span>, nextAngel));</span><br><span class="line">            <span class="function"><span class="keyword">yield</span> <span class="keyword">return</span> <span class="keyword">new</span> <span class="title">WaitForFixedUpdate</span>()</span>;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        isRotating = <span class="literal">false</span>;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h4 id="项目地址"><a href="#项目地址" class="headerlink" title="项目地址"></a>项目地址</h4><ul><li><a target="_blank" rel="noopener" href="https://github.com/Yousazoe/Don-t-Starve">Don’t Starve</a></li></ul></div><div class="popular-posts-header">Related Posts</div><ul class="popular-posts"><li class="popular-posts-item"><div class="popular-posts-title"><a href="/archives/1a46bbd3.html" rel="bookmark">LD49游戏开发笔记：Deepwell Safety Inc.</a></div></li><li class="popular-posts-item"><div class="popular-posts-title"><a href="/archives/6144e1a0.html" rel="bookmark">48小时里我做了什么：第一次极限游戏开发，Ludum Dare 38</a></div></li><li class="popular-posts-item"><div class="popular-posts-title"><a href="/archives/e8e3308a.html" rel="bookmark">Unity Student Plan申请指南</a></div></li></ul><footer class="post-footer"><div class="post-tags"><a href="/tags/Game/" rel="tag"># Game</a> <a href="/tags/Unity/" rel="tag"># Unity</a></div><div class="post-nav"><div class="post-nav-item"><a href="/archives/deda69a.html" rel="prev" title="Realistic Rendering"><i class="fa fa-chevron-left"></i> Realistic Rendering</a></div><div class="post-nav-item"><a href="/archives/6ec960b5.html" rel="next" title="Binary Search">Binary Search <i class="fa fa-chevron-right"></i></a></div></div></footer></article></div><script>window.addEventListener("tabs:register",()=>{let{activeClass:e}=CONFIG.comments;if(CONFIG.comments.storage&&(e=localStorage.getItem("comments_active")||e),e){let t=document.querySelector(`a[href="#comment-${e}"]`);t&&t.click()}}),CONFIG.comments.storage&&window.addEventListener("tabs:click",t=>{t.target.matches(".tabs-comment .tab-content .tab-pane")&&(t=t.target.classList[1],localStorage.setItem("comments_active",t))})</script></div><div class="toggle sidebar-toggle"><span class="toggle-line toggle-line-first"></span> <span class="toggle-line toggle-line-middle"></span> <span class="toggle-line toggle-line-last"></span></div><aside class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc">Table of Contents</li><li class="sidebar-nav-overview">Overview</li></ul><div class="post-toc-wrap sidebar-panel"><div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BC%95%E8%A8%80"><span class="nav-number">1.</span> <span class="nav-text">引言</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9C%BA%E6%99%AF%E6%90%AD%E5%BB%BA"><span class="nav-number">2.</span> <span class="nav-text">场景搭建</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%A7%92%E8%89%B2"><span class="nav-number">3.</span> <span class="nav-text">角色</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%A7%92%E8%89%B2%E5%8A%A8%E7%94%BB"><span class="nav-number">3.1.</span> <span class="nav-text">角色动画</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%A7%92%E8%89%B2%E6%8E%A7%E5%88%B6"><span class="nav-number">3.2.</span> <span class="nav-text">角色控制</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%A7%86%E8%A7%92"><span class="nav-number">4.</span> <span class="nav-text">视角</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%80%8F%E8%A7%86%E6%8A%95%E5%BD%B1"><span class="nav-number">4.1.</span> <span class="nav-text">透视投影</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%97%8B%E8%BD%AC%E8%A7%86%E8%A7%92"><span class="nav-number">4.2.</span> <span class="nav-text">旋转视角</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%BA%90%E7%A0%81"><span class="nav-number">5.</span> <span class="nav-text">源码</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#PlayerMovement"><span class="nav-number">5.1.</span> <span class="nav-text">PlayerMovement</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#FacingCamera"><span class="nav-number">5.2.</span> <span class="nav-text">FacingCamera</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#RotatingCamera"><span class="nav-number">5.3.</span> <span class="nav-text">RotatingCamera</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%A1%B9%E7%9B%AE%E5%9C%B0%E5%9D%80"><span class="nav-number">5.4.</span> <span class="nav-text">项目地址</span></a></li></ol></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person"><img class="site-author-image" itemprop="image" alt="Yousazoe" src="https://img.yousazoe.top/uPic/img/blog/icon/icon.jpeg"><p class="site-author-name" itemprop="name">Yousazoe</p><div class="site-description" itemprop="description">done is better than perfect</div></div><div class="site-state-wrap motion-element"><nav class="site-state"><div class="site-state-item site-state-posts"><a href="/archives/"><span class="site-state-item-count">280</span> <span class="site-state-item-name">posts</span></a></div><div class="site-state-item site-state-categories"><a href="/categories/"><span class="site-state-item-count">44</span> <span class="site-state-item-name">categories</span></a></div><div class="site-state-item site-state-tags"><a href="/tags/"><span class="site-state-item-count">70</span> <span class="site-state-item-name">tags</span></a></div></nav></div><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="mailto:zoeyousa@gmail.com" title="E-Mail → mailto:zoeyousa@gmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i></a> </span><span class="links-of-author-item"><a href="https://github.com/Yousazoe" title="GitHub → https://github.com/Yousazoe" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i></a> </span><span class="links-of-author-item"><a href="https://twitter.com/YousaZoe" title="Twitter → https://twitter.com/YousaZoe" rel="noopener" target="_blank"><i class="fab fa-twitter fa-fw"></i></a> </span><span class="links-of-author-item"><a href="https://www.weibo.com/6034231696/profile?rightmod=1&amp;wvr=6&amp;mod=personinfo&amp;is_all=1" title="Weibo → https://www.weibo.com/6034231696/profile?rightmod=1&amp;wvr=6&amp;mod=personinfo&amp;is_all=1" rel="noopener" target="_blank"><i class="fab fa-weibo fa-fw"></i></a> </span><span class="links-of-author-item"><a href="https://steamcommunity.com/profiles/76561198856466228/" title="Steam → https://steamcommunity.com/profiles/76561198856466228/" rel="noopener" target="_blank"><i class="fab fa-steam fa-fw"></i></a> </span><span class="links-of-author-item"><a href="https://www.chess.com/member/yousazoe" title="Chess → https://www.chess.com/member/yousazoe" rel="noopener" target="_blank"><i class="fa fa-chess-pawn fa-fw"></i></a> </span><span class="links-of-author-item"><a href="/atom.xml" title="RSS → /atom.xml"><i class="fa fa-rss fa-fw"></i></a></span></div><div class="cc-license motion-element" itemprop="license"><a href="https://creativecommons.org/licenses/by-nc-sa/4.0/zh-CN" class="cc-opacity" rel="noopener" target="_blank"><img src="https://img.yousazoe.top/uPic/img/blog/icon/mona-loading-default.gif" data-original="/images/cc-by-nc-sa.svg" alt="Creative Commons"></a></div></div><div class="twopeople"><div class="container" style="height:200px"><canvas class="illo" width="800" height="800" style="max-width:200px;max-height:200px;touch-action:none;width:640px;height:640px"></canvas></div><script src="https://img.yousazoe.top/js/twopeople1.js"></script><script src="https://img.yousazoe.top/js/zdog.dist.js"></script><script id="rendered-js" src="https://img.yousazoe.top/js/twopeople.js"></script><style>.twopeople{margin:0;align-items:center;justify-content:center;text-align:center}canvas{display:block;margin:0 auto;cursor:move}</style></div><div class="cc-license animated" itemprop="sponsor"><link rel="preconnect" href="https://www.netlify.com"><span class="exturl cc-opacity" title="Deploy with Netlify → https://www.netlify.com" data-url="aHR0cHM6Ly93d3cubmV0bGlmeS5jb20="><img width="80" src="https://img.yousazoe.top/uPic/img/blog/icon/mona-loading-default.gif" data-original="https://www.netlify.com/img/global/badges/netlify-dark.svg" alt="Netlify"></span></div><div class="back-to-top motion-element"><i class="fa fa-arrow-up"></i> <span>0%</span></div></div></aside><div id="sidebar-dimmer"></div></div></main><footer class="footer"><div class="footer-inner"><div class="translate-style">繁/简：<a id="translateLink" href="javascript:translatePage();">繁体</a></div><script type="text/javascript" src="/js/tw_cn.js"></script><script type="text/javascript">var defaultEncoding=2,translateDelay=0,cookieDomain="https://tding.top/",msgToTraditionalChinese="繁体",msgToSimplifiedChinese="简体",translateButtonId="translateLink";translateInitilization()</script><div class="beian"><a href="https://beian.miit.gov.cn/" rel="noopener" target="_blank">晋ICP备2021009930号 </a><img src="https://img.yousazoe.top/uPic/img/blog/icon/mona-loading-default.gif" data-original="https://img.yousazoe.top/uPic/img/blog/icon/beian.png" style="display:inline-block"></div><div class="copyright">© 2020 – <span itemprop="copyrightYear">2022</span> <span class="with-love"><i class="fa fa-heart"></i> </span><span class="author" itemprop="copyrightHolder">Yousazoe</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-chart-area"></i> </span><span title="Symbols count total">4.2m</span></div><div class="powered-by"><span><a target="_blank" rel="noopener" href="https://www.upyun.com/?utm_source=lianmeng&amp;utm_medium=referral"><img src="https://img.yousazoe.top/uPic/img/blog/icon/mona-loading-default.gif" data-original="https://cdn.jsdelivr.net/gh/YukiNoUta/cdn-static@main/blog/svg/upyun.svg" width="53" height="18" style="fill:currentColor;display:inline-block"></a></span><span class="post-meta-divider">|</span>今早雾霾蔽日，但是不要害怕，太阳依旧在云端</div><div class="busuanzi-count"><script data-pjax="" async="" src="js/busuanzi.pure.mini.js"></script><span class="post-meta-item" id="busuanzi_container_site_uv" style="display:inline"><span class="post-meta-item-icon"><i class="fa fa-user"></i> </span><span class="site-uv" title="Total Visitors"><span id="busuanzi_value_site_uv"></span> </span></span><span class="post-meta-divider">|</span> <span class="post-meta-item" id="busuanzi_container_site_pv" style="display:inline"><span class="post-meta-item-icon"><i class="fa fa-eye"></i> </span><span class="site-pv" title="Total Views"><span id="busuanzi_value_site_pv"></span></span></span></div></div></footer></div><script src="//unpkg.com/animejs@3.1.0/lib/anime.min.js"></script><script src="//npm.elemecdn.com/pjax/pjax.min.js"></script><script src="//lib.baomitu.com/jquery/3.6.0/jquery.min.js"></script><script src="//lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js"></script><script src="//unpkg.com/lozad@1.16.0/dist/lozad.min.js"></script><script src="//lib.baomitu.com/pangu/4.0.7/pangu.min.js"></script><script src="/lib/velocity/velocity.min.js"></script><script src="/lib/velocity/velocity.ui.min.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/pisces.js"></script><script src="/js/next-boot.js"></script><script>var pjax = new Pjax({
  selectors: [
    'head title',
    '#page-configurations',
    '.content-wrap',
    '.post-toc-wrap',
    '.languages',
    '#pjax'
  ],
  switches: {
    '.post-toc-wrap': Pjax.switches.innerHTML
  },
  analytics: false,
  cacheBust: false,
  scrollTo : !CONFIG.bookmark.enable
});

window.addEventListener('pjax:success', () => {
    $(document).ready(function () {

    if(location.href.indexOf("#reloaded")==-1){
        location.href=location.href+"#reloaded";
        location.reload();
    }
}）
#在这后面可以加入程序的其他代码  


  document.querySelectorAll('script[data-pjax], script#page-configurations, #pjax script').forEach(element => {
    var code = element.text || element.textContent || element.innerHTML || '';
    var parent = element.parentNode;
    parent.removeChild(element);
    var script = document.createElement('script');
    if (element.id) {
      script.id = element.id;
    }
    if (element.className) {
      script.className = element.className;
    }
    if (element.type) {
      script.type = element.type;
    }
    if (element.src) {
      script.src = element.src;
      // Force synchronous loading of peripheral JS.
      script.async = false;
    }
    if (element.dataset.pjax !== undefined) {
      script.dataset.pjax = '';
    }
    if (code !== '') {
      script.appendChild(document.createTextNode(code));
    }
    parent.appendChild(script);
  });

  
  NexT.boot.refresh();
  
  // Define Motion Sequence & Bootstrap Motion.
  if (CONFIG.motion.enable) {
    NexT.motion.integrator
      .init()
      .add(NexT.motion.middleWares.subMenu)
      .add(NexT.motion.middleWares.postList)
      .bootstrap();
  }
  
  NexT.utils.updateSidebarPosition();
});</script><script defer="" src="//img.yousazoe.top/js/three.min.js"></script><script defer="" src="//img.yousazoe.top/js/caidai.js"></script><script data-pjax="">!function(){var e,t,o,n,r=document.getElementsByTagName("link");if(0<r.length)for(i=0;i<r.length;i++)"canonical"==r[i].rel.toLowerCase()&&r[i].href&&(e=r[i].href);t=(e||window.location.protocol).split(":")[0],e=e||window.location.href,window,o=e,n=document.referrer,/([http|https]:\/\/[a-zA-Z0-9\_\.]+\.baidu\.com)/gi.test(o)||(t="https"===String(t).toLowerCase()?"https://sp0.baidu.com/9_Q4simg2RQJ8t7jm9iCKT-xh_/s.gif":"//api.share.baidu.com/s.gif",n?(t+="?r="+encodeURIComponent(document.referrer),o&&(t+="&l="+o)):o&&(t+="?l="+o),(new Image).src=t)}()</script><script src="/js/local-search.js"></script><script data-pjax="">document.querySelectorAll(".pdfobject-container").forEach(e=>{var t=e.dataset.target,a="#"+Object.entries({navpanes:0,toolbar:0,statusbar:0,pagemode:"thumbs",view:"FitH"}).map(([e,t])=>`${e}=${encodeURIComponent(t)}`).join("&"),r=`/lib/pdf/web/viewer.html?file=${encodeURIComponent(t)}${a}`;NexT.utils.supportsPDFs()?e.innerHTML=`<embed class="pdfobject" src="${t+a}" type="application/pdf" style="height: ${e.dataset.height};">`:e.innerHTML=`<iframe src="${r}" style="height: ${e.dataset.height};" frameborder="0"></iframe>`})</script><script data-pjax="">document.querySelectorAll("pre.mermaid").length&&NexT.utils.getScript("//lib.baomitu.com/mermaid/8.4.8/mermaid.min.js",()=>{mermaid.initialize({theme:"forest",logLevel:3,flowchart:{curve:"linear"},gantt:{axisFormat:"%m/%d/%Y"},sequence:{actorMargin:50}})},window.mermaid)</script><div id="pjax"></div><script type="text/javascript" src="/js/cursor/fireworks.js"></script><script src="https://img.yousazoe.top/live2dw/lib/L2Dwidget.min.js"></script><script>L2Dwidget.init({pluginRootPath:"live2dw/",pluginJsPath:"lib/",pluginModelPath:"assets/",tagMode:!1,debug:!1,model:{jsonPath:"/live2dw/assets/assets/hijiki.model.json"},display:{position:"right",width:100,height:200},mobile:{show:!0},log:!1})</script><script>window.imageLazyLoadSetting={isSPA:!1,preloadRatio:5,processImages:null}</script><script>window.addEventListener("load",function(){var t=/\.(gif|jpg|jpeg|tiff|png)$/i,r=/^data:image\/[a-z]+;base64,/;Array.prototype.slice.call(document.querySelectorAll("img[data-original]")).forEach(function(a){var e=a.parentNode;"A"===e.tagName&&(e.href.match(t)||e.href.match(r))&&(e.href=a.dataset.original)})})</script><script>!function(n){n.imageLazyLoadSetting.processImages=o;var e=n.imageLazyLoadSetting.isSPA,i=n.imageLazyLoadSetting.preloadRatio||1,r=Array.prototype.slice.call(document.querySelectorAll("img[data-original]"));function o(){e&&(r=Array.prototype.slice.call(document.querySelectorAll("img[data-original]")));for(var t,a=0;a<r.length;a++)0<=(t=(t=r[a]).getBoundingClientRect()).bottom&&0<=t.left&&t.top<=(n.innerHeight*i||document.documentElement.clientHeight*i)&&function(){var e=r[a],t=e,n=function(){r=r.filter(function(t){return e!==t})},i=new Image,o=t.getAttribute("data-original");i.onload=function(){t.src=o,n()},t.src!==o&&(i.src=o)}()}o(),n.addEventListener("scroll",function(){var t=o,e=n;clearTimeout(t.tId),t.tId=setTimeout(function(){t.call(e)},500)})}(this)</script><script type="text/javascript" charset="utf-8" src="/js/lazyload-plugin/lazyload.intersectionObserver.min.js"></script></body></html>