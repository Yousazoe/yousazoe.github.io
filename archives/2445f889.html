<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 5.4.2"><link rel="apple-touch-icon" sizes="180x180" href="/images/favicon.ico"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.ico"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.ico"><link rel="mask-icon" href="/images/favicon.ico" color="#222"><meta name="baidu-site-verification" content="slBbq5f8WxljPytW"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="//fonts.proxy.ustclug.org/css?family=Lato:300,300italic,400,400italic,700,700italic&amp;display=swap&amp;subset=latin,latin-ext"><link rel="stylesheet" href="//cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css"><link rel="stylesheet" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.css"><script id="hexo-configurations">var NexT=window.NexT||{},CONFIG={hostname:"yousazoe.top",root:"/",scheme:"Gemini",version:"7.8.0",exturl:!1,sidebar:{position:"left",display:"post",padding:18,offset:12,onmobile:!1},copycode:{enable:!0,show_result:!0,style:"mac"},back2top:{enable:!0,sidebar:!0,scrollpercent:!0},bookmark:{enable:!1,color:"#222",save:"auto"},fancybox:!0,mediumzoom:!1,lazyload:!0,pangu:!0,comments:{style:"tabs",active:null,storage:!0,lazyload:!0,nav:null},algolia:{hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}},localsearch:{enable:!0,trigger:"auto",top_n_per_article:3,unescape:!1,preload:!1},motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}},path:"search.xml"}</script><meta name="description" content="引言本文主要面向对Unity有基本了解，并想学习制作一个完整的2D Platformer游戏的读者。在课程中会透过重新制作《On Off》这个小游戏，来为大家讲解关于2D人物的操纵以及动画转换，也包含了开始选单、音乐音效等在各游戏中都非常泛用的知识点。"><meta property="og:type" content="article"><meta property="og:title" content="OnOff-Unity2D游戏开发"><meta property="og:url" content="https://yousazoe.top/archives/2445f889.html"><meta property="og:site_name" content="Fl0w3r"><meta property="og:description" content="引言本文主要面向对Unity有基本了解，并想学习制作一个完整的2D Platformer游戏的读者。在课程中会透过重新制作《On Off》这个小游戏，来为大家讲解关于2D人物的操纵以及动画转换，也包含了开始选单、音乐音效等在各游戏中都非常泛用的知识点。"><meta property="og:locale" content="en_US"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/Yousazoe/picgo-repo/img/008eGmZEly1gn4o2y46uwj311x0j6q3b.jpg"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/Yousazoe/picgo-repo/img/0081Kckwgy1glppevonu5j30lh0b4dg5.jpg"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/Yousazoe/picgo-repo/img/0081Kckwgy1glr6d7070ij30c0052767.jpg"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/Yousazoe/picgo-repo/img/0081Kckwgy1glr6hlcranj30ud0cjmyv.jpg"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/Yousazoe/picgo-repo/img/0081Kckwgy1glrbjvxjkaj311w0it0t5.jpg"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/Yousazoe/picgo-repo/img/0081Kckwgy1glrbki061lj311v0isjrs.jpg"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/Yousazoe/picgo-repo/img/0081Kckwgy1glr5tlnd9wj310g0kq0v6.jpg"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/Yousazoe/picgo-repo/img/0081Kckwgy1glr5vor43ej310g0kq0va.jpg"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/Yousazoe/picgo-repo/img/0081Kckwgy1glrckakqhsj30mf0bx74v.jpg"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/Yousazoe/picgo-repo/img/0081Kckwgy1glrcugvl4gj30bq05j74i.jpg"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/Yousazoe/picgo-repo/img/0081Kckwgy1glrx0hlcfdj30tx0bv0tt.jpg"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/Yousazoe/picgo-repo/img/0081Kckwgy1glrdc6meqlj310a0kptbf.jpg"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/Yousazoe/picgo-repo/img/0081Kckwgy1glml20r92kj311y0lcwgz.jpg"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/Yousazoe/picgo-repo/img/0081Kckwgy1glml4ev83kj311y0lc0v6.jpg"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/Yousazoe/picgo-repo/img/0081Kckwgy1glmky153orj30nx0amgls.jpg"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/Yousazoe/picgo-repo/img/0081Kckwgy1glnol6g2kqj304702gaa1.jpg"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/Yousazoe/picgo-repo/img/0081Kckwgy1glnovx64ddj30bb039wen.jpg"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/Yousazoe/picgo-repo/img/0081Kckwgy1glotyuw5hmj30bn0biaaz.jpg"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/Yousazoe/picgo-repo/img/0081Kckwgy1glou01t6tyj30dq0443yn.jpg"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/Yousazoe/picgo-repo/img/0081Kckwgy1glrd93hiu4j30fk049mxi.jpg"><meta property="article:published_time" content="2020-12-09T15:34:48.000Z"><meta property="article:modified_time" content="2021-02-15T08:40:16.991Z"><meta property="article:author" content="Yousazoe"><meta property="article:tag" content="Game Develop"><meta property="article:tag" content="Unity"><meta property="article:tag" content="Csharp"><meta property="article:tag" content="2D Game"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/Yousazoe/picgo-repo/img/008eGmZEly1gn4o2y46uwj311x0j6q3b.jpg"><link rel="canonical" href="https://yousazoe.top/archives/2445f889.html"><script id="page-configurations">CONFIG.page={sidebar:"",isHome:!1,isPost:!0,lang:"en"}</script><title>OnOff-Unity2D游戏开发 | Fl0w3r</title><noscript><style>.sidebar-inner,.use-motion .brand,.use-motion .collection-header,.use-motion .comments,.use-motion .menu-item,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header{opacity:initial}.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.use-motion .logo-line-before i{left:initial}.use-motion .logo-line-after i{right:initial}</style></noscript><link rel="alternate" href="/atom.xml" title="Fl0w3r" type="application/atom+xml"></head><body itemscope="" itemtype="http://schema.org/WebPage"><div class="container use-motion"><div class="headband"></div><header class="header" itemscope="" itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-container"><div class="site-nav-toggle"><div class="toggle" aria-label="Toggle navigation bar"><span class="toggle-line toggle-line-first"></span> <span class="toggle-line toggle-line-middle"></span> <span class="toggle-line toggle-line-last"></span></div></div><div class="site-meta"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span><h1 class="site-title">Fl0w3r</h1><span class="logo-line-after"><i></i></span></a><p class="site-subtitle" itemprop="description">carpe diem</p></div><div class="site-nav-right"><div class="toggle popup-trigger"><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class="site-nav"><ul id="menu" class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-address-card fa-fw"></i>About</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a></li><li class="menu-item menu-item-links"><a href="/links/" rel="section"><i class="fa fa-paperclip fa-fw"></i>Links</a></li><li class="menu-item menu-item-photos"><a href="/photos/" rel="section"><i class="fa fa-camera fa-fw"></i>Photos</a></li><li class="menu-item menu-item-artitalk"><a href="/artitalk/" rel="section"><i class="fa fa-calendar fa-fw"></i>Artitalk</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a></li><li class="menu-item menu-item-document"><a href="https://theme-next.js.org/docs/" rel="noopener" target="_blank"><i class="fas fa-book fa-fw"></i>Document</a></li><li class="menu-item menu-item-gametracker"><a href="https://yousazoe.notion.site/yousazoe/b05999823bd14b57a7a6cd81fba1a1af?v=21c3398e0bdb429c9b8157b7bf12ff6a" rel="noopener" target="_blank"><i class="fas fa-trophy fa-fw"></i>GameTracker</a></li><li class="menu-item menu-item-sitemap"><a href="/sitemap.xml" rel="section"><i class="fa fa-sitemap fa-fw"></i>Sitemap</a></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search</a></li></ul></nav><div class="search-pop-overlay"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"><input autocomplete="off" autocapitalize="off" placeholder="Searching..." spellcheck="false" type="search" class="search-input"></div><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span></div><div id="search-result"><div id="no-result"><i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i></div></div></div></div></div></header><div class="reading-progress-bar"></div><main class="main"><div class="main-inner"><div class="content-wrap"><div class="content post posts-expand"><article itemscope="" itemtype="http://schema.org/Article" class="post-block" lang="en"><link itemprop="mainEntityOfPage" href="https://yousazoe.top/archives/2445f889.html"><span hidden="" itemprop="author" itemscope="" itemtype="http://schema.org/Person"><meta itemprop="image" content="https://tva1.sinaimg.cn/large/008eGmZEly1gn2f3efk0dj30lc0lcq31.jpg"><meta itemprop="name" content="Yousazoe"><meta itemprop="description" content="done is better than perfect"></span><span hidden="" itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization"><meta itemprop="name" content="Fl0w3r"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">OnOff-Unity2D游戏开发</h1><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i> </span><span class="post-meta-item-text">Posted on</span> <time title="Created: 2020-12-09 23:34:48" itemprop="dateCreated datePublished" datetime="2020-12-09T23:34:48+08:00">2020-12-09</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-folder"></i> </span><span class="post-meta-item-text">In</span> <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/Unity-%E6%B8%B8%E6%88%8F%E5%BC%95%E6%93%8E-Unity-Game-Engine/" itemprop="url" rel="index"><span itemprop="name">Unity 游戏引擎 (Unity Game Engine)</span></a> </span></span><span class="post-meta-item" title="Views" id="busuanzi_container_page_pv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-eye"></i> </span><span class="post-meta-item-text">Views: </span><span id="busuanzi_value_page_pv"></span></span><br><span class="post-meta-item" title="Symbols count in article"><span class="post-meta-item-icon"><i class="fas fa-pen"></i></span><span>12k</span> </span><span class="post-meta-item" title="Reading time"><span class="post-meta-item-icon"><i class="far fa-clock"></i> </span><span>22 mins.</span></span></div></header><div class="post-body" itemprop="articleBody"><p><img data-src="./image/loading.gif" data-original="https://cdn.jsdelivr.net/gh/Yousazoe/picgo-repo/img/008eGmZEly1gn4o2y46uwj311x0j6q3b.jpg"></p><h3 id="引言"><a href="#引言" class="headerlink" title="引言"></a>引言</h3><p>本文主要面向对Unity有基本了解，并想学习制作一个完整的2D Platformer游戏的读者。在课程中会透过重新制作《On Off》这个小游戏，来为大家讲解关于2D人物的操纵以及动画转换，也包含了开始选单、音乐音效等在各游戏中都非常泛用的知识点。</p><span id="more"></span><h3 id="项目介绍"><a href="#项目介绍" class="headerlink" title="项目介绍"></a>项目介绍</h3><h4 id="项目架构"><a href="#项目架构" class="headerlink" title="项目架构"></a>项目架构</h4><ul><li>玩家 <code>PlayerController.cs</code></li><li>游戏功能 <code>GameManager.cs</code></li><li>转换颜色 <code>SwitchColor.cs</code></li><li>地板 <code>Ground.cs</code></li><li>终点 <code>Goal.cs</code></li></ul><h4 id="玩家功能"><a href="#玩家功能" class="headerlink" title="玩家功能"></a>玩家功能</h4><h5 id="按左右键进行移动"><a href="#按左右键进行移动" class="headerlink" title="按左右键进行移动"></a>按左右键进行移动</h5><ul><li><p>侦测左右键输入</p><ul><li><code>float h = Input.GetAxisRaw("Horizontal")</code></li><li>不按键，<code>h=0</code>；按右键，<code>h=1</code>；按左键，<code>h=-1</code></li></ul></li><li><p>实际移动</p><ul><li>修改速度 <code>rb.velocity</code></li><li>只修改<code>x</code>方向速度</li><li><code>rb.velocity=new Vector2(moveSpeed*h,rb.velocity.y)</code></li></ul></li><li><p>角色面向随行走方向改变</p><ul><li>通过改变<code>transform.localScale.x</code>实现</li></ul></li><li><p>角色动画</p><ul><li>站立、行走、跳跃三个动画之间的转换</li></ul></li></ul><h5 id="向上进行跳跃"><a href="#向上进行跳跃" class="headerlink" title="向上进行跳跃"></a>向上进行跳跃</h5><ul><li>向上施加力</li><li>不能在空中跳跃<ul><li>判断是否踩在地板上 <code>isGround</code></li></ul></li></ul><h3 id="核心功能搭建"><a href="#核心功能搭建" class="headerlink" title="核心功能搭建"></a>核心功能搭建</h3><h4 id="角色控制"><a href="#角色控制" class="headerlink" title="角色控制"></a>角色控制</h4><h5 id="变量声明"><a href="#变量声明" class="headerlink" title="变量声明"></a>变量声明</h5><p>我们首先声明一些变量：</p><ul><li><code>moveSpeed</code>：玩家移动速度</li><li><code>jumpForce</code>：玩家跳跃速度</li><li><code>rb</code>：玩家物理组件</li><li><code>anim</code>：玩家动画组件</li></ul><figure class="highlight c#"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="built_in">float</span> moveSpeed;</span><br><span class="line"><span class="keyword">public</span> <span class="built_in">float</span> jumpForce;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> Rigidbody2D rb;</span><br><span class="line"><span class="keyword">private</span> Animator anim;  </span><br></pre></td></tr></tbody></table></figure><p>声明变量之后我们先在<code>Start()</code>中获取这些组件，需要注意的是动画组件是用获取子物件的<code>GetComponentInChildren&lt;Animator&gt;()</code></p><figure class="highlight c#"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">// Start is called before the first frame update</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Start</span>()</span></span><br><span class="line">{</span><br><span class="line">  rb = GetComponent&lt;Rigidbody2D&gt;();</span><br><span class="line">  anim = GetComponentInChildren&lt;Animator&gt;();</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h5 id="横向移动实现"><a href="#横向移动实现" class="headerlink" title="横向移动实现"></a>横向移动实现</h5><p>这里使用<code>GetAxisRaw</code>而不是<code>GetAxis</code>的原因是如果我们使用<code>GetAxis</code>按键松手后h会慢慢过渡回0，而<code>GetAxisRaw</code>是瞬时变化为0。</p><p>移动的实现我们选择<code>rb.velocity</code>，<code>Vector2()</code>中的<code>h * moveSpeed</code>代表了方向乘以移动速度，这样如果按下左键<code>h = -1</code>就会向左移动；如果按下右键<code>h = 1</code>则向右移动；没有输入则保持不动。</p><figure class="highlight c#"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">// Update is called once per frame</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Update</span>()</span></span><br><span class="line">{</span><br><span class="line">  <span class="comment">//right h =1</span></span><br><span class="line">  <span class="comment">//left h = -1</span></span><br><span class="line">  <span class="comment">//no input h = 0</span></span><br><span class="line">  <span class="comment">//GetAxis GetAxisRaw</span></span><br><span class="line">  <span class="built_in">float</span> h = Input.GetAxisRaw(<span class="string">"Horizontal"</span>);</span><br><span class="line"></span><br><span class="line">  rb.velocity = <span class="keyword">new</span> Vector2(h * moveSpeed,rb.velocity.y);</span><br><span class="line"></span><br><span class="line">}   </span><br></pre></td></tr></tbody></table></figure><p>回到Unity，在<code>PlayerController.cs</code>脚本中设定<code>moveSpeed</code>，测试角色可以正常移动。但相比其他平台跳跃类游戏，我们的角色移动时的朝向并不会改变，所以我们需要接着修改。</p><h5 id="移动朝向"><a href="#移动朝向" class="headerlink" title="移动朝向"></a>移动朝向</h5><p>朝向问题其实不难解决，我们可以先尝试修改一下角色<code>Transform</code>组件中的<code>Scale</code>，不难发现向右时为1；向左时为-1。这时候联想一下刚才的<code>h</code>，赋值属性非常契合。</p><p>在代码中我们需要考虑没有输入的情况，如果依然随着<code>h</code>，那么角色会被压缩到无，所以需要加入判断<code>if (h != 0)</code>，然后在判断内通过对<code>Scale</code>赋值为<code>h</code>来改变朝向。</p><figure class="highlight c#"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">// Update is called once per frame</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Update</span>()</span></span><br><span class="line">{</span><br><span class="line">  ......</span><br><span class="line">	<span class="keyword">if</span> (h != <span class="number">0</span>)</span><br><span class="line">  {</span><br><span class="line">  	transform.localScale = <span class="keyword">new</span> Vector3(h,<span class="number">1</span>,<span class="number">1</span>);</span><br><span class="line">  }</span><br><span class="line">}   </span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure><p>回到Unity测试，角色已经可以随着移动方向改变而改变朝向。</p><h5 id="跳跃"><a href="#跳跃" class="headerlink" title="跳跃"></a>跳跃</h5><p>通常来讲一般和物理相关都需要写在<code>FixedUpdate()</code>里，但我们这个小游戏没有很吃性能，所以就写在<code>Update()</code>里面了。</p><p>如果按下上键，那么我们会给<code>Rigidbody2D</code>添加一个方向向上、大小为<code>jumpForce</code>，施力模式向<code>ForceMode2D.Impulse</code>是此 <code>rigidbody2D</code> 添加瞬时力冲击。</p><figure class="highlight c#"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">// Update is called once per frame</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Update</span>()</span></span><br><span class="line">{</span><br><span class="line">  ......</span><br><span class="line">  <span class="keyword">if</span> (Input.GetKeyDown(KeyCode.UpArrow))</span><br><span class="line">  {</span><br><span class="line">    rb.AddForce(Vector3.up * jumpForce,ForceMode2D.Impulse);</span><br><span class="line">  }</span><br><span class="line">}   </span><br></pre></td></tr></tbody></table></figure><p>返回Unity，设置调整<code>jumpForce</code>数值，测试角色跳跃。</p><p>但如果多测试几次就会发现，角色可以在空中进行多次跳跃，也就是所谓的“无限跳”。对于这个问题，我们其实只需要判断 <strong>角色的脚底是否是地板</strong> 就可以了，而踩在地板这个条件则可以通过标签进行判断，如果角色脚底是地板则可以进行跳跃操作，否则则不能跳跃。</p><p>所以我们在<code>Player</code>上创建子物件<code>GroundCheck</code>移到角色脚底，作用就是检测角色是否碰到地板。</p><p><img data-src="./image/loading.gif" data-original="https://cdn.jsdelivr.net/gh/Yousazoe/picgo-repo/img/0081Kckwgy1glppevonu5j30lh0b4dg5.jpg"></p><p>回到程式我们需要找到这个检测物件<code>GroundCheck</code>，所以首先在前面声明变量：</p><figure class="highlight c#"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">PlayerController</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">{</span><br><span class="line">	......</span><br><span class="line">	<span class="keyword">public</span> Transform groundCheck;</span><br><span class="line">	......</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>然后回到跳跃的判断，加入判断函数<code>isGround()</code>来判断我们是否踩在地板上：</p><figure class="highlight c#"><table><tbody><tr><td class="code"><pre><span class="line">- <span class="keyword">if</span> (Input.GetKeyDown(KeyCode.UpArrow))</span><br><span class="line">+ <span class="keyword">if</span> (Input.GetKeyDown(KeyCode.UpArrow) &amp;&amp; IsGround())</span><br><span class="line">{</span><br><span class="line">  rb.AddForce(Vector3.up * jumpForce,ForceMode2D.Impulse);</span><br><span class="line">  AudioManager.S.PlayPlayerSFX(<span class="number">0</span>);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>编写判断函数<code>isGround()</code>，这里<code>Physics2D.CircleCast(transform.position,0.3f,Vector2.down,0.35f,whatIsGround)</code>的意思是我们画一个圆在物件本身的位置上，向下0.35个单位画一个半径为0.3的圆，这个圆将只会和被我们判定成<code>Ground</code>的图层碰撞。如果<code>hit</code>碰撞到返回<code>true</code>，否则返回<code>false</code>。</p><figure class="highlight c#"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="built_in">bool</span> <span class="title">IsGround</span>()</span></span><br><span class="line">{</span><br><span class="line">	RaycastHit2D hit = Physics2D.CircleCast(transform.position,<span class="number">0.3f</span>,Vector2.down,<span class="number">0.35f</span>,whatIsGround);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> hit;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>这样写就不需要<code>groundCheck</code>了，我们删除之前设置的变量和空物件，改为获取图层<code>LayerMask</code>：</p><figure class="highlight c#"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">PlayerController</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">{</span><br><span class="line">	......</span><br><span class="line">	- <span class="keyword">public</span> Transform groundCheck;</span><br><span class="line">  + <span class="keyword">public</span> LayerMask whatIsGround;</span><br><span class="line">	......</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>回到Unity设置检测图层为<code>Ground</code>：</p><p><img data-src="./image/loading.gif" data-original="https://cdn.jsdelivr.net/gh/Yousazoe/picgo-repo/img/0081Kckwgy1glr6d7070ij30c0052767.jpg"></p><h5 id="动画连接"><a href="#动画连接" class="headerlink" title="动画连接"></a>动画连接</h5><p>Move部分是由<code>Move</code>这个Parameter判断的，0播放Player_Idle；1播放Player_Move。</p><p><img data-src="./image/loading.gif" data-original="https://cdn.jsdelivr.net/gh/Yousazoe/picgo-repo/img/0081Kckwgy1glr6hlcranj30ud0cjmyv.jpg"></p><p>可以发现动画播放和<code>h</code>的关联性，但因为有-1的关系需要取绝对值<code>Mathf.Abs()</code>，这样左右移动取值均为1。</p><figure class="highlight c#"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">// Update is called once per frame</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Update</span>()</span></span><br><span class="line">{</span><br><span class="line">	......</span><br><span class="line">  anim.SetFloat(<span class="string">"Move"</span>,Mathf.Abs(h));</span><br><span class="line">  anim.SetBool(<span class="string">"isGround"</span>,IsGround());</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>回到Unity，测试站立、移动和跳跃的动画。</p><h5 id="整理"><a href="#整理" class="headerlink" title="整理"></a>整理</h5><p>对我们<code>PlayerController.cs</code>的代码稍加整理，添加一些注释：</p><figure class="highlight c#"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">// Update is called once per frame</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Update</span>()</span></span><br><span class="line">{</span><br><span class="line">  <span class="comment">// Move</span></span><br><span class="line">  <span class="comment">//right h =1 left h = -1 no input h = 0</span></span><br><span class="line">  <span class="comment">//GetAxis GetAxisRaw</span></span><br><span class="line">  <span class="built_in">float</span> h = Input.GetAxisRaw(<span class="string">"Horizontal"</span>);</span><br><span class="line">  rb.velocity = <span class="keyword">new</span> Vector2(h * moveSpeed,rb.velocity.y);</span><br><span class="line"></span><br><span class="line">  <span class="comment">//Change Face Direction</span></span><br><span class="line">  <span class="keyword">if</span> (h != <span class="number">0</span>)</span><br><span class="line">  {</span><br><span class="line">    transform.localScale = <span class="keyword">new</span> Vector3(h,<span class="number">1</span>,<span class="number">1</span>);</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  <span class="comment">//Apply Jump</span></span><br><span class="line">  <span class="keyword">if</span> (Input.GetKeyDown(KeyCode.UpArrow) &amp;&amp; IsGround())</span><br><span class="line">  {</span><br><span class="line">    rb.AddForce(Vector3.up * jumpForce,ForceMode2D.Impulse);</span><br><span class="line">    AudioManager.S.PlayPlayerSFX(<span class="number">0</span>);</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  <span class="comment">//Set Animator</span></span><br><span class="line">  anim.SetFloat(<span class="string">"Move"</span>,Mathf.Abs(h));</span><br><span class="line">  anim.SetBool(<span class="string">"isGround"</span>,IsGround());</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h4 id="颜色转换"><a href="#颜色转换" class="headerlink" title="颜色转换"></a>颜色转换</h4><p>这部分我们来实现游戏的核心功能：颜色转换的部分。首先为所有需要颜色转换功能的物件（玩家、地板等等）新建一个共同的脚本命名为<code>SwitchColor.cs</code>，同时因为这是游戏的核心功能，所以我们新建一个<code>GameManager.cs</code>来进行管理。</p><p>为了确保<code>GameManager</code>游戏管理者有且仅有一个，我们使用单例模式：</p><figure class="highlight c#"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">GameManager</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">{</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> GameManager S;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">Awake</span>()</span></span><br><span class="line">  {</span><br><span class="line">  	S = <span class="keyword">this</span>;</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p><code>SwitchAllColor()</code>函数用于抓取场景所有有<code>SwitchColor</code>，同时设置数组存储这些物体：</p><figure class="highlight c#"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> SwitchColor[] colorObjs;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">SwitchAllColor</span>()</span>{}</span><br></pre></td></tr></tbody></table></figure><p>而<code>colorObjs</code>则在开始时的<code>Start()</code>中获取，保存在<code>SwitchColor[]</code>中：</p><figure class="highlight c#"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Start</span>()</span></span><br><span class="line">{</span><br><span class="line">	colorObjs = FindObjectsOfType&lt;SwitchColor&gt;();</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>回到<code>SwitchAllColor()</code>中遍历数组呼叫里面的<code>SwichObjColor()</code>函数：</p><figure class="highlight c#"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">SwitchAllColor</span>()</span></span><br><span class="line">{</span><br><span class="line">  + <span class="keyword">foreach</span> (SwitchColor colorObj <span class="keyword">in</span> colorObjs)</span><br><span class="line">  + {</span><br><span class="line">  + 	colorObj.SwichObjColor();</span><br><span class="line">  + }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>新建<code>SwitchColor.cs</code>，声明之前在<code>GameManager.cs</code>调用的<code>SwichObjColor()</code>。因为这个脚本需要同时满足玩家、地板、背景、UI等的颜色变换需求，所以我们用枚举的方式区分不同的类别，然后根据枚举的类型决定颜色转换的方式：</p><p>对于玩家而言，颜色的改变只需要将<code>spriteRender</code>中的颜色改变即可；而地板则需要考虑碰撞体的激活问题；背景则由相机的<code>Background</code>来控制；<code>image</code>和<code>text</code>之后会用于UI的颜色转换。</p><figure class="highlight c#"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">SwitchColor</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">{</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">SwichObjColor</span>()</span>{}</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="built_in">enum</span> ComponentType</span><br><span class="line">{</span><br><span class="line">   player,spriteRender,image,text,camera,ground</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>回到Unity对相应物件的组件类型<code>ComponentType</code>进行赋值。返回<code>SwitchColor.cs</code>，声明作为选项的组件类型和变换前后的两种颜色：</p><figure class="highlight c#"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">SwitchColor</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">{</span><br><span class="line">    + <span class="keyword">public</span> ComponentType componentType;</span><br><span class="line">    + <span class="keyword">public</span> Color startColor;</span><br><span class="line">    + <span class="keyword">public</span> Color endColor;</span><br><span class="line">  </span><br><span class="line">  ......</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>有了上面的变量，我们就可以根据不同的组件类型利用<code>Switch</code>对转换颜色进行分支操作：</p><ul><li><code>player</code>：获取精灵渲染器改变颜色，<code>color == startColor ? endColor : startColor</code>做一个颜色的翻转</li><li><code>spriteRender</code>：同<code>player</code></li><li><code>image</code>：涉及UI部分需要引入<code>using UnityEngine.UI</code></li><li><code>text</code>：同<code>image</code></li><li><code>camera</code>：同<code>player</code></li><li><code>ground</code>：在<code>player</code>的基础上对是否启用<code>BoxCollider2D</code>进行翻转</li></ul><figure class="highlight c#"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">SwichObjColor</span>()</span></span><br><span class="line">{</span><br><span class="line">  <span class="keyword">switch</span> (componentType)</span><br><span class="line">  {</span><br><span class="line">    <span class="keyword">case</span> ComponentType.player:</span><br><span class="line">      {</span><br><span class="line">        <span class="comment">//if black</span></span><br><span class="line">        <span class="comment">//change to white</span></span><br><span class="line">        <span class="comment">//else</span></span><br><span class="line">        <span class="comment">//change to black</span></span><br><span class="line">        GetComponentInChildren&lt;SpriteRenderer&gt;().color =</span><br><span class="line">          GetComponentInChildren&lt;SpriteRenderer&gt;().color == startColor ? endColor : startColor;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">case</span> ComponentType.spriteRender:</span><br><span class="line">      {</span><br><span class="line">        GetComponent&lt;SpriteRenderer&gt;().color =</span><br><span class="line">          GetComponent&lt;SpriteRenderer&gt;().color == startColor ? endColor : startColor;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">case</span> ComponentType.image:</span><br><span class="line">      {</span><br><span class="line">        GetComponent&lt;Image&gt;().color =</span><br><span class="line">          GetComponent&lt;Image&gt;().color == startColor ? endColor : startColor;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">case</span> ComponentType.text:</span><br><span class="line">      {</span><br><span class="line">        GetComponent&lt;Text&gt;().color =</span><br><span class="line">          GetComponent&lt;Text&gt;().color == startColor ? endColor : startColor;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">case</span> ComponentType.camera:</span><br><span class="line">      {</span><br><span class="line">        Camera.main.backgroundColor = Camera.main.backgroundColor == startColor ? endColor : startColor;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">case</span> ComponentType.ground:</span><br><span class="line">      {</span><br><span class="line">        GetComponent&lt;BoxCollider2D&gt;().enabled = !GetComponent&lt;BoxCollider2D&gt;().enabled;</span><br><span class="line"></span><br><span class="line">        GetComponentInChildren&lt;SpriteRenderer&gt;().color =</span><br><span class="line">          GetComponentInChildren&lt;SpriteRenderer&gt;().color == startColor ? endColor : startColor;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      }</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>回到<code>PlayerController.cs</code>，在<code>Update()</code>函数中调用<code>GameManager.cs</code>中的<code>SwitchAllColor()</code>，再经由此跳转到<code>SwitchColor.cs</code>中的<code>SwichObjColor()</code>方法：</p><figure class="highlight c#"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">// Update is called once per frame</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Update</span>()</span></span><br><span class="line">{</span><br><span class="line">  ......</span><br><span class="line"></span><br><span class="line">  <span class="comment">//Switch Color</span></span><br><span class="line">  <span class="keyword">if</span> (Input.GetKeyDown(KeyCode.Space))</span><br><span class="line">  {</span><br><span class="line">  	GameManager.S.SwitchAllColor();</span><br><span class="line">	}</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>回到Unity，对组件的起始、结束的颜色进行赋值，注意透明度调至255：</p><table><thead><tr><th align="left">ComponentType</th><th align="left">startColor</th><th align="left">endColor</th></tr></thead><tbody><tr><td align="left">Main Camera</td><td align="left">255 255 255</td><td align="left">0 0 0</td></tr><tr><td align="left">Player</td><td align="left">0 0 0</td><td align="left">255 255 255</td></tr><tr><td align="left">BlackGround</td><td align="left">51 51 51</td><td align="left">71 71 71</td></tr><tr><td align="left">WhiteGround</td><td align="left">235 235 235</td><td align="left">255 255 255</td></tr></tbody></table><p>测试颜色转换功能：</p><p><img data-src="./image/loading.gif" data-original="https://cdn.jsdelivr.net/gh/Yousazoe/picgo-repo/img/0081Kckwgy1glrbjvxjkaj311w0it0t5.jpg"></p><p><img data-src="./image/loading.gif" data-original="https://cdn.jsdelivr.net/gh/Yousazoe/picgo-repo/img/0081Kckwgy1glrbki061lj311v0isjrs.jpg"></p><h4 id="死亡及死亡特效"><a href="#死亡及死亡特效" class="headerlink" title="死亡及死亡特效"></a>死亡及死亡特效</h4><p><img data-src="./image/loading.gif" data-original="https://cdn.jsdelivr.net/gh/Yousazoe/picgo-repo/img/0081Kckwgy1glr5tlnd9wj310g0kq0v6.jpg"></p><p><img data-src="./image/loading.gif" data-original="https://cdn.jsdelivr.net/gh/Yousazoe/picgo-repo/img/0081Kckwgy1glr5vor43ej310g0kq0va.jpg"></p><figure class="highlight diff"><table><tbody><tr><td class="code"><pre><span class="line">//Switch Color</span><br><span class="line">if (Input.GetKeyDown(KeyCode.Space))</span><br><span class="line">{</span><br><span class="line">  GameManager.S.SwitchAllColor();</span><br><span class="line"></span><br><span class="line"><span class="addition">+   if (insideBlock)</span></span><br><span class="line"><span class="addition">+   {</span></span><br><span class="line"><span class="addition">+	    Die();</span></span><br><span class="line"><span class="addition">+   }</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><figure class="highlight diff"><table><tbody><tr><td class="code"><pre><span class="line">void Update()</span><br><span class="line">{</span><br><span class="line">  ......</span><br><span class="line"><span class="addition">+ 	if (transform.position.y &lt; seftDestructionHeight &amp;&amp; sr.enabled)</span></span><br><span class="line"><span class="addition">+ 	{</span></span><br><span class="line"><span class="addition">+ 		Die();</span></span><br><span class="line"><span class="addition">+ 	}</span></span><br><span class="line">}  </span><br></pre></td></tr></tbody></table></figure><figure class="highlight c#"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Die</span>()</span></span><br><span class="line">{</span><br><span class="line">  GameManager.S.PlayerDie();</span><br><span class="line">  sr.enabled = <span class="literal">false</span>;</span><br><span class="line">  GetComponent&lt;BoxCollider2D&gt;().enabled = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">  GameObject dfx = Instantiate(deadEffect, transform.position, Quaternion.identity);</span><br><span class="line">  Destroy(dfx,<span class="number">2f</span>);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h4 id="加载关卡"><a href="#加载关卡" class="headerlink" title="加载关卡"></a>加载关卡</h4><p><img data-src="./image/loading.gif" data-original="https://cdn.jsdelivr.net/gh/Yousazoe/picgo-repo/img/0081Kckwgy1glrckakqhsj30mf0bx74v.jpg"></p><p>为目标添加<code>Goal.cs</code>：</p><ul><li><code>OnTriggerEnter2D(Collider2D collision)</code>：检测碰撞玩家，播放动画；为防止再次触发过关手动把<code>CircleCollider2D</code>关掉</li><li><code>ToNextStage()</code>：调用<code>GameManager</code>中的<code>NextStage()</code>函数进入下一关</li><li><code>EnableCollider()</code>：将碰撞体激活</li></ul><figure class="highlight c#"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Goal</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">{</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">OnTriggerEnter2D</span>(<span class="params">Collider2D collision</span>)</span></span><br><span class="line">    {</span><br><span class="line">        <span class="keyword">if</span> (collision.gameObject.CompareTag(<span class="string">"Player"</span>))</span><br><span class="line">        {</span><br><span class="line">            GetComponent&lt;Animator&gt;().SetTrigger(<span class="string">"Goal"</span>);</span><br><span class="line">            GetComponent&lt;CircleCollider2D&gt;().enabled = <span class="literal">false</span>;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">ToNextStage</span>()</span></span><br><span class="line">    {</span><br><span class="line">        GameManager.S.NextStage();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">EnableCollider</span>()</span></span><br><span class="line">    {</span><br><span class="line">        GetComponent&lt;CircleCollider2D&gt;().enabled = <span class="literal">true</span>;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>回到<code>GameManager.cs</code>编写进入关卡的逻辑，直接调用<code>SceneManager</code>读取我们的关卡数，+1后就是下一关。</p><figure class="highlight c#"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"><span class="keyword">using</span> UnityEngine.SceneManagement;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">GameManager</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">{</span><br><span class="line">    + <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">NextStage</span>()</span></span><br><span class="line"><span class="function">    +</span> {   </span><br><span class="line">    +    SceneManager.LoadScene(SceneManager.GetActiveScene().buildIndex + <span class="number">1</span>);</span><br><span class="line">    + }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>回到Unity将结束动画中最后帧中的<code>Function</code>赋值给<code>ToNextStage()</code>以触发：</p><p><img data-src="./image/loading.gif" data-original="https://cdn.jsdelivr.net/gh/Yousazoe/picgo-repo/img/0081Kckwgy1glrcugvl4gj30bq05j74i.jpg"></p><p>​</p><h4 id="用户界面及数据继承"><a href="#用户界面及数据继承" class="headerlink" title="用户界面及数据继承"></a>用户界面及数据继承</h4><p>搭建UI组件，放入素材中的图片，挂载颜色转换脚本<code>SwitchColor.cs</code>同时将类型更改为<code>Image</code>或<code>Text</code>：</p><p><img data-src="./image/loading.gif" data-original="https://cdn.jsdelivr.net/gh/Yousazoe/picgo-repo/img/0081Kckwgy1glrx0hlcfdj30tx0bv0tt.jpg"></p><p>为了便于管理，我们新建一个管理UI的脚本<code>UIManager.cs</code>。</p><p>首先像之前一样使用单例模式创建一个UIManager，再声明两个<code>Text</code>类型的变量（死亡数和星星数），最后声明两个<code>Refresh</code>刷新函数用于接收新数据并更新UI界面的数据：</p><figure class="highlight c#"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">using</span> UnityEngine.UI;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">UIManager</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">{</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> UIManager S;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">Awake</span>()</span></span><br><span class="line">    {</span><br><span class="line">        S = <span class="keyword">this</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Text skullText;</span><br><span class="line">    <span class="keyword">public</span> Text startText;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">RefreshSkullText</span>(<span class="params"><span class="built_in">int</span> amount</span>)</span></span><br><span class="line">    {</span><br><span class="line">        skullText.text = amount.ToString();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">RefreshStarText</span>(<span class="params"><span class="built_in">int</span> amount</span>)</span></span><br><span class="line">    {</span><br><span class="line">        startText.text = amount.ToString();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>回到<code>GameManager.cs</code>新增统计死亡数和星星数的变量：</p><figure class="highlight c#"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">GameManager</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">{</span><br><span class="line">		......</span><br><span class="line">    + <span class="keyword">public</span> <span class="keyword">static</span> <span class="built_in">int</span> deadCount;</span><br><span class="line">    + <span class="keyword">public</span> <span class="keyword">static</span> <span class="built_in">int</span> starCount;</span><br><span class="line">    ......</span><br><span class="line">}    </span><br></pre></td></tr></tbody></table></figure><p>分别在死亡和过关的函数中计数并调用UIManager：</p><figure class="highlight c#"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">PlayerDie</span>()</span></span><br><span class="line">{</span><br><span class="line">  + deadCount++;</span><br><span class="line">  + UIManager.S.RefreshSkullText(deadCount);</span><br><span class="line"></span><br><span class="line">  StartCoroutine(PlayerRevive());</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">NextStage</span>()</span></span><br><span class="line">{</span><br><span class="line">  + starCount++;</span><br><span class="line">  + UIManager.S.RefreshStarText(starCount);</span><br><span class="line"></span><br><span class="line">  SceneManager.LoadScene(SceneManager.GetActiveScene().buildIndex + <span class="number">1</span>);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>最后在<code>Star()</code>函数中调用刷新函数确保数据能够刷新：</p><figure class="highlight c#"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Start</span>()</span></span><br><span class="line">{</span><br><span class="line">  colorObjs = FindObjectsOfType&lt;SwitchColor&gt;();</span><br><span class="line"></span><br><span class="line">  + UIManager.S.RefreshSkullText(deadCount);</span><br><span class="line">  + UIManager.S.RefreshStarText(starCount);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h4 id="音乐与音效"><a href="#音乐与音效" class="headerlink" title="音乐与音效"></a>音乐与音效</h4><figure class="highlight c#"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">AudioManager</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">{</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> AudioManager S;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">Awake</span>()</span> </span><br><span class="line">    {</span><br><span class="line">        <span class="keyword">if</span> (S == <span class="literal">null</span>) </span><br><span class="line">        {</span><br><span class="line">            S = <span class="keyword">this</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        {</span><br><span class="line">            Destroy(gameObject);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> AudioSource playerAudio;</span><br><span class="line">    <span class="keyword">public</span> AudioSource stageAudio;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> AudioClip[] playerSfx;</span><br><span class="line">    <span class="keyword">public</span> AudioClip[] stageSfx;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Start is called before the first frame update</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Start</span>()</span></span><br><span class="line">    {</span><br><span class="line">        DontDestroyOnLoad(gameObject);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">PlayPlayerSFX</span>(<span class="params"><span class="built_in">int</span> index</span>)</span></span><br><span class="line">    {</span><br><span class="line">        playerAudio.clip = playerSfx[index];</span><br><span class="line">        playerAudio.Play();</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">PlayStageSFX</span>(<span class="params"><span class="built_in">int</span> index</span>)</span></span><br><span class="line">    {</span><br><span class="line">        stageAudio.clip = stageSfx[index];</span><br><span class="line">        stageAudio.Play();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h3 id="效果完善总结"><a href="#效果完善总结" class="headerlink" title="效果完善总结"></a>效果完善总结</h3><h4 id="开始界面"><a href="#开始界面" class="headerlink" title="开始界面"></a>开始界面</h4><p><img data-src="./image/loading.gif" data-original="https://cdn.jsdelivr.net/gh/Yousazoe/picgo-repo/img/0081Kckwgy1glrdc6meqlj310a0kptbf.jpg"></p><h4 id="残影效果"><a href="#残影效果" class="headerlink" title="残影效果"></a>残影效果</h4><h5 id="代码逻辑"><a href="#代码逻辑" class="headerlink" title="代码逻辑"></a>代码逻辑</h5><p>我们首先需要声明一些变量：</p><ul><li><code>dashSpeed</code>：冲刺速度</li><li><code>dashTime</code>：冲刺持续时间</li><li><code>startDashTime</code>：倒计时的计时器</li><li><code>isDashing</code>：冲刺状态的记录量</li><li><code>dashObj</code>：保存残影物体</li></ul><p>冲刺的逻辑是：</p><figure class="highlight c#"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(不是冲刺状态)</span><br><span class="line">{</span><br><span class="line">	<span class="keyword">if</span>(按下左Shift键)</span><br><span class="line">	{</span><br><span class="line">		进入冲刺状态；</span><br><span class="line">		启用残影对象；</span><br><span class="line">		启用计时器；</span><br><span class="line">	}</span><br><span class="line">}</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">{</span><br><span class="line">	<span class="keyword">if</span>(还有时间剩余)</span><br><span class="line">	{</span><br><span class="line">		velocity向前乘以向前的冲刺速度</span><br><span class="line">	}</span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">	{</span><br><span class="line">		改变冲刺状态；</span><br><span class="line">		隐藏残影的游戏物体；		</span><br><span class="line">	}</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>通过上面的伪代码，我们可以轻松写出业务逻辑：</p><figure class="highlight c#"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">using</span> System.Collections;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">PlayerController</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">{</span><br><span class="line">		<span class="keyword">public</span> <span class="built_in">float</span> dashSpeed;</span><br><span class="line">  	<span class="keyword">public</span> <span class="built_in">float</span> dashTime;</span><br><span class="line">    <span class="keyword">public</span> GameObject dashObj;</span><br><span class="line">    </span><br><span class="line"> 		<span class="keyword">private</span> <span class="built_in">bool</span> isDashing;</span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">float</span> startDashTime;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Update</span>()</span></span><br><span class="line">    {</span><br><span class="line">        <span class="function">BASIC MOVEMENT</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">        </span></span><br><span class="line"><span class="function">        <span class="title">if</span> (<span class="params">!isDashing</span>)</span></span><br><span class="line">        {</span><br><span class="line">            <span class="keyword">if</span> (Input.GetKeyDown(KeyCode.LeftShift))</span><br><span class="line">            {</span><br><span class="line">                dashObj.SetActive(<span class="literal">true</span>);</span><br><span class="line">                </span><br><span class="line">                isDashing = <span class="literal">true</span>;</span><br><span class="line">                startDashTime = dashTime;</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        {</span><br><span class="line">            startDashTime -= Time.deltaTime;</span><br><span class="line">            <span class="keyword">if</span> (startDashTime &lt;= <span class="number">0</span>)</span><br><span class="line">            {</span><br><span class="line">                isDashing = <span class="literal">false</span>;</span><br><span class="line">                dashObj.SetActive(<span class="literal">false</span>);</span><br><span class="line">            }</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            {</span><br><span class="line">                rb.velocity = transform.right * dashSpeed;</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">      </span><br><span class="line">        ......</span><br><span class="line">    }</span><br><span class="line">}    </span><br></pre></td></tr></tbody></table></figure><h5 id="粒子效果"><a href="#粒子效果" class="headerlink" title="粒子效果"></a>粒子效果</h5><p>回到Unity编辑器，新建一个空的游戏对象并为其添加一个粒子系统组件</p><h6 id="粒子系统（Particle-System）主模块"><a href="#粒子系统（Particle-System）主模块" class="headerlink" title="粒子系统（Particle System）主模块"></a>粒子系统（Particle System）主模块</h6><p>Particle System 模块包含影响整个系统的全局属性。大多数这些属性用于控制新创建的粒子的初始状态。</p><ul><li><p><code>Duration</code>：系统运行的时间长度。取值与冲刺时间相近避免残影持续太长时间</p></li><li><p><code>Start LifeTime</code>：粒子的初始生命周期。与上面同理</p></li><li><p><code>Start Size</code>：每个粒子的初始大小。根据自己的大小来调整</p></li><li><p><code>StartColor</code>：每个粒子的初始颜色。这里我们选择由浅绿色到浅蓝色的随机渐变</p></li><li><p><code>Simulation Space</code>：控制粒子的运动位置是在父对象的局部空间中（因此与父对象一起移动）、在世界空间中还是相对于自定义对象（与您选择的自定义对象一起移动）。选择世界空间（<code>World</code>）使残影生成时留在原地，不会和角色移动有任何关系</p></li><li><p><code>Max Particles</code>：系统中同时允许的最多粒子数。可以适当调小一些</p></li></ul><h6 id="Emission-模块"><a href="#Emission-模块" class="headerlink" title="Emission 模块"></a>Emission 模块</h6><p>此模块中的属性会影响粒子系统发射的速率和时间。</p><ul><li><code>Rate over Distance</code>：每个移动距离单位发射的粒子数。这样粒子系统就会随距离而不是时间生成粒子</li></ul><p><img data-src="./image/loading.gif" data-original="https://cdn.jsdelivr.net/gh/Yousazoe/picgo-repo/img/0081Kckwgy1glml20r92kj311y0lcwgz.jpg"></p><h6 id="Shape模块"><a href="#Shape模块" class="headerlink" title="Shape模块"></a>Shape模块</h6><p>此模块用于定义可发射粒子的体积或表面以及起始速度的方向。Shape 属性定义发射体积的形状，其余模块属性根据您选择的 Shape 值而变化。</p><ul><li><code>Shape</code>：发射体积的形状。选择圆形（<code>Circle</code>）</li></ul><h6 id="Color-Over-Lifetime-模块"><a href="#Color-Over-Lifetime-模块" class="headerlink" title="Color Over Lifetime 模块"></a>Color Over Lifetime 模块</h6><p>此模块指定粒子的颜色和透明度在其生命周期中如何变化。</p><ul><li><code>Color</code>：粒子在其生命周期内的颜色渐变，渐变条的左侧点表示粒子寿命的开始，而渐变条的右侧表示粒子寿命的结束。我们这里设置渐变透明，透明度由高到低</li></ul><h6 id="Texture-Sheet-Animation-模块"><a href="#Texture-Sheet-Animation-模块" class="headerlink" title="Texture Sheet Animation 模块"></a>Texture Sheet Animation 模块</h6><p>粒子的图形不必是静止图像。此模块允许您将纹理视为可作为动画帧进行播放的一组单独子图像。</p><ul><li><code>Mode</code>：弹出菜单。2D残影选择<code>Sprites</code>模式，图片选择切分好的站立的精灵即可</li></ul><p><img data-src="./image/loading.gif" data-original="https://cdn.jsdelivr.net/gh/Yousazoe/picgo-repo/img/0081Kckwgy1glml4ev83kj311y0lc0v6.jpg"></p><h5 id="效果"><a href="#效果" class="headerlink" title="效果"></a>效果</h5><p>最后我们按下<code>LeftShift</code>就有一个由绿到蓝的渐变透明残影的效果了：</p><p><img data-src="./image/loading.gif" data-original="https://cdn.jsdelivr.net/gh/Yousazoe/picgo-repo/img/0081Kckwgy1glmky153orj30nx0amgls.jpg"></p><h4 id="尖刺和二段跳"><a href="#尖刺和二段跳" class="headerlink" title="尖刺和二段跳"></a>尖刺和二段跳</h4><h5 id="尖刺"><a href="#尖刺" class="headerlink" title="尖刺"></a>尖刺</h5><p>创建一个三角形物体并拖拽至精灵文件夹<code>Sprites</code>中，命名为<code>Triangle</code>：</p><p><img data-src="./image/loading.gif" data-original="https://cdn.jsdelivr.net/gh/Yousazoe/picgo-repo/img/0081Kckwgy1glnol6g2kqj304702gaa1.jpg"></p><p>制作预制体，为其添加组件<code>BoxCollider2D</code>，可以在<code>Edit Collider</code>中变更碰撞判定。在实际游戏开发中不可能将碰撞体制作修正的和本体一模一样，大部分做法是根据感觉选择一个折中的碰撞判定区域，所以我们框选一个差不多的碰撞体即可。和之前的地板一致，在初始状态下白色的尖刺碰撞体应该是取消勾选碰撞组件的。</p><p>为其添加颜色转换组件<code>SwitchColor.cs</code>：</p><ul><li><code>Commponent Type</code>：选择<code>Ground</code>，性质与<code>Ground</code>一致</li><li><code>Start Color</code>：颜色<code>235</code>，<code>235</code>，<code>235</code>；透明度 <code>255</code></li><li><code>End Color</code>：颜色<code>255</code>，<code>255</code>，<code>255</code>；透明度<code>255</code></li></ul><p><img data-src="./image/loading.gif" data-original="https://cdn.jsdelivr.net/gh/Yousazoe/picgo-repo/img/0081Kckwgy1glnovx64ddj30bb039wen.jpg"></p><p>对于尖刺的脚本只需要附载<code>OnTriggerEnter2D(Collider2D collision)</code>，通过判断碰撞体标签是否为<code>Player</code>来判断是否碰到玩家，如果碰到则触发玩家控制器<code>PlayerController.cs</code>中的玩家死亡<code>Die()</code>即可。</p><figure class="highlight c#"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Trap</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">{</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">OnTriggerEnter2D</span>(<span class="params">Collider2D collision</span>)</span></span><br><span class="line">    {</span><br><span class="line">        <span class="keyword">if</span> (collision.gameObject.CompareTag(<span class="string">"Player"</span>))</span><br><span class="line">        {</span><br><span class="line">            FindObjectOfType&lt;PlayerController&gt;().Die();</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>同理我们可以复制粘贴白色尖刺，通过更改变换颜色<code>SwitchColor.cs</code>脚本的颜色和重新勾选碰撞体来制作黑色尖刺：</p><ul><li><code>Commponent Type</code>：选择<code>Ground</code>，性质与<code>Ground</code>一致</li><li><code>Start Color</code>：颜色<code>51</code>，<code>51</code>，<code>51</code>；透明度 <code>255</code></li><li><code>End Color</code>：颜色<code>71</code>，<code>71</code>，<code>71</code>；透明度<code>255</code></li></ul><p><img data-src="./image/loading.gif" data-original="https://cdn.jsdelivr.net/gh/Yousazoe/picgo-repo/img/0081Kckwgy1glotyuw5hmj30bn0biaaz.jpg"></p><p>最后将黑白两个尖刺都拖至预制体文件夹<code>Prefab</code>中以备之后关卡搭建使用。</p><p><img data-src="./image/loading.gif" data-original="https://cdn.jsdelivr.net/gh/Yousazoe/picgo-repo/img/0081Kckwgy1glou01t6tyj30dq0443yn.jpg"></p><h4 id="项目导出"><a href="#项目导出" class="headerlink" title="项目导出"></a>项目导出</h4><h5 id="分辨率"><a href="#分辨率" class="headerlink" title="分辨率"></a>分辨率</h5><p>直接导出为可执行程序会导致之前设计的UI位置会发生变化，所以我们新建脚本<code>Resolution.cs</code>，固定分辨率为1024x768：</p><figure class="highlight c#"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">using</span> System.Collections;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Resolution</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">{</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Awake</span>()</span></span><br><span class="line">    {</span><br><span class="line">        Screen.SetResolution(<span class="number">1024</span>,<span class="number">768</span>,<span class="literal">true</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>这里1024x768的分辨率来源是根据UI的<code>Canvas Scaler</code>中的分辨率：</p><p><img data-src="./image/loading.gif" data-original="https://cdn.jsdelivr.net/gh/Yousazoe/picgo-repo/img/0081Kckwgy1glrd93hiu4j30fk049mxi.jpg"></p><p>回到Unity将其挂在到主相机<code>Main Camera</code>上，测试运行，UI就恢复了正常，回到原位。</p></div><footer class="post-footer"><div class="post-tags"><a href="/tags/Game-Develop/" rel="tag"># Game Develop</a> <a href="/tags/Unity/" rel="tag"># Unity</a> <a href="/tags/Csharp/" rel="tag"># Csharp</a> <a href="/tags/2D-Game/" rel="tag"># 2D Game</a></div><div class="post-nav"><div class="post-nav-item"><a href="/archives/e5e6b796.html" rel="prev" title="开始画像素画#8"><i class="fa fa-chevron-left"></i> 开始画像素画#8</a></div><div class="post-nav-item"><a href="/archives/5b27815c.html" rel="next" title="像素宝典#1">像素宝典#1 <i class="fa fa-chevron-right"></i></a></div></div></footer></article></div><script>window.addEventListener("tabs:register",()=>{let{activeClass:e}=CONFIG.comments;if(CONFIG.comments.storage&&(e=localStorage.getItem("comments_active")||e),e){let t=document.querySelector(`a[href="#comment-${e}"]`);t&&t.click()}}),CONFIG.comments.storage&&window.addEventListener("tabs:click",t=>{t.target.matches(".tabs-comment .tab-content .tab-pane")&&(t=t.target.classList[1],localStorage.setItem("comments_active",t))})</script></div><div class="toggle sidebar-toggle"><span class="toggle-line toggle-line-first"></span> <span class="toggle-line toggle-line-middle"></span> <span class="toggle-line toggle-line-last"></span></div><aside class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc">Table of Contents</li><li class="sidebar-nav-overview">Overview</li></ul><div class="post-toc-wrap sidebar-panel"><div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BC%95%E8%A8%80"><span class="nav-number">1.</span> <span class="nav-text">引言</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%A1%B9%E7%9B%AE%E4%BB%8B%E7%BB%8D"><span class="nav-number">2.</span> <span class="nav-text">项目介绍</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%A1%B9%E7%9B%AE%E6%9E%B6%E6%9E%84"><span class="nav-number">2.1.</span> <span class="nav-text">项目架构</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%8E%A9%E5%AE%B6%E5%8A%9F%E8%83%BD"><span class="nav-number">2.2.</span> <span class="nav-text">玩家功能</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%8C%89%E5%B7%A6%E5%8F%B3%E9%94%AE%E8%BF%9B%E8%A1%8C%E7%A7%BB%E5%8A%A8"><span class="nav-number">2.2.1.</span> <span class="nav-text">按左右键进行移动</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%90%91%E4%B8%8A%E8%BF%9B%E8%A1%8C%E8%B7%B3%E8%B7%83"><span class="nav-number">2.2.2.</span> <span class="nav-text">向上进行跳跃</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%A0%B8%E5%BF%83%E5%8A%9F%E8%83%BD%E6%90%AD%E5%BB%BA"><span class="nav-number">3.</span> <span class="nav-text">核心功能搭建</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%A7%92%E8%89%B2%E6%8E%A7%E5%88%B6"><span class="nav-number">3.1.</span> <span class="nav-text">角色控制</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%8F%98%E9%87%8F%E5%A3%B0%E6%98%8E"><span class="nav-number">3.1.1.</span> <span class="nav-text">变量声明</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E5%AE%9E%E7%8E%B0"><span class="nav-number">3.1.2.</span> <span class="nav-text">横向移动实现</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E7%A7%BB%E5%8A%A8%E6%9C%9D%E5%90%91"><span class="nav-number">3.1.3.</span> <span class="nav-text">移动朝向</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E8%B7%B3%E8%B7%83"><span class="nav-number">3.1.4.</span> <span class="nav-text">跳跃</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%8A%A8%E7%94%BB%E8%BF%9E%E6%8E%A5"><span class="nav-number">3.1.5.</span> <span class="nav-text">动画连接</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%95%B4%E7%90%86"><span class="nav-number">3.1.6.</span> <span class="nav-text">整理</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%A2%9C%E8%89%B2%E8%BD%AC%E6%8D%A2"><span class="nav-number">3.2.</span> <span class="nav-text">颜色转换</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%AD%BB%E4%BA%A1%E5%8F%8A%E6%AD%BB%E4%BA%A1%E7%89%B9%E6%95%88"><span class="nav-number">3.3.</span> <span class="nav-text">死亡及死亡特效</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%8A%A0%E8%BD%BD%E5%85%B3%E5%8D%A1"><span class="nav-number">3.4.</span> <span class="nav-text">加载关卡</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%94%A8%E6%88%B7%E7%95%8C%E9%9D%A2%E5%8F%8A%E6%95%B0%E6%8D%AE%E7%BB%A7%E6%89%BF"><span class="nav-number">3.5.</span> <span class="nav-text">用户界面及数据继承</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%9F%B3%E4%B9%90%E4%B8%8E%E9%9F%B3%E6%95%88"><span class="nav-number">3.6.</span> <span class="nav-text">音乐与音效</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%95%88%E6%9E%9C%E5%AE%8C%E5%96%84%E6%80%BB%E7%BB%93"><span class="nav-number">4.</span> <span class="nav-text">效果完善总结</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%BC%80%E5%A7%8B%E7%95%8C%E9%9D%A2"><span class="nav-number">4.1.</span> <span class="nav-text">开始界面</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%AE%8B%E5%BD%B1%E6%95%88%E6%9E%9C"><span class="nav-number">4.2.</span> <span class="nav-text">残影效果</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81%E9%80%BB%E8%BE%91"><span class="nav-number">4.2.1.</span> <span class="nav-text">代码逻辑</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E7%B2%92%E5%AD%90%E6%95%88%E6%9E%9C"><span class="nav-number">4.2.2.</span> <span class="nav-text">粒子效果</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#%E7%B2%92%E5%AD%90%E7%B3%BB%E7%BB%9F%EF%BC%88Particle-System%EF%BC%89%E4%B8%BB%E6%A8%A1%E5%9D%97"><span class="nav-number">4.2.2.1.</span> <span class="nav-text">粒子系统（Particle System）主模块</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#Emission-%E6%A8%A1%E5%9D%97"><span class="nav-number">4.2.2.2.</span> <span class="nav-text">Emission 模块</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#Shape%E6%A8%A1%E5%9D%97"><span class="nav-number">4.2.2.3.</span> <span class="nav-text">Shape模块</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#Color-Over-Lifetime-%E6%A8%A1%E5%9D%97"><span class="nav-number">4.2.2.4.</span> <span class="nav-text">Color Over Lifetime 模块</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#Texture-Sheet-Animation-%E6%A8%A1%E5%9D%97"><span class="nav-number">4.2.2.5.</span> <span class="nav-text">Texture Sheet Animation 模块</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%95%88%E6%9E%9C"><span class="nav-number">4.2.3.</span> <span class="nav-text">效果</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%B0%96%E5%88%BA%E5%92%8C%E4%BA%8C%E6%AE%B5%E8%B7%B3"><span class="nav-number">4.3.</span> <span class="nav-text">尖刺和二段跳</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%B0%96%E5%88%BA"><span class="nav-number">4.3.1.</span> <span class="nav-text">尖刺</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%A1%B9%E7%9B%AE%E5%AF%BC%E5%87%BA"><span class="nav-number">4.4.</span> <span class="nav-text">项目导出</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%88%86%E8%BE%A8%E7%8E%87"><span class="nav-number">4.4.1.</span> <span class="nav-text">分辨率</span></a></li></ol></li></ol></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person"><img class="site-author-image" itemprop="image" alt="Yousazoe" src="https://tva1.sinaimg.cn/large/008eGmZEly1gn2f3efk0dj30lc0lcq31.jpg"><p class="site-author-name" itemprop="name">Yousazoe</p><div class="site-description" itemprop="description">done is better than perfect</div></div><div class="site-state-wrap motion-element"><nav class="site-state"><div class="site-state-item site-state-posts"><a href="/archives/"><span class="site-state-item-count">271</span> <span class="site-state-item-name">posts</span></a></div><div class="site-state-item site-state-categories"><a href="/categories/"><span class="site-state-item-count">44</span> <span class="site-state-item-name">categories</span></a></div><div class="site-state-item site-state-tags"><a href="/tags/"><span class="site-state-item-count">70</span> <span class="site-state-item-name">tags</span></a></div></nav></div><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="mailto:zoeyousa@gmail.com" title="E-Mail → mailto:zoeyousa@gmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i></a> </span><span class="links-of-author-item"><a href="https://github.com/Yousazoe" title="GitHub → https://github.com/Yousazoe" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i></a> </span><span class="links-of-author-item"><a href="https://twitter.com/YousaZoe" title="Twitter → https://twitter.com/YousaZoe" rel="noopener" target="_blank"><i class="fab fa-twitter fa-fw"></i></a> </span><span class="links-of-author-item"><a href="https://www.weibo.com/6034231696/profile?rightmod=1&amp;wvr=6&amp;mod=personinfo&amp;is_all=1" title="Weibo → https://www.weibo.com/6034231696/profile?rightmod=1&amp;wvr=6&amp;mod=personinfo&amp;is_all=1" rel="noopener" target="_blank"><i class="fab fa-weibo fa-fw"></i></a> </span><span class="links-of-author-item"><a href="https://steamcommunity.com/profiles/76561198856466228/" title="Steam → https://steamcommunity.com/profiles/76561198856466228/" rel="noopener" target="_blank"><i class="fab fa-steam fa-fw"></i></a> </span><span class="links-of-author-item"><a href="https://www.chess.com/member/yousazoe" title="Chess → https://www.chess.com/member/yousazoe" rel="noopener" target="_blank"><i class="fa fa-chess-pawn fa-fw"></i></a> </span><span class="links-of-author-item"><a href="/atom.xml" title="RSS → /atom.xml"><i class="fa fa-rss fa-fw"></i></a></span></div><div class="cc-license motion-element" itemprop="license"><a href="https://creativecommons.org/licenses/by-nc-sa/4.0/zh-CN" class="cc-opacity" rel="noopener" target="_blank"><img src="./image/loading.gif" data-original="/images/cc-by-nc-sa.svg" alt="Creative Commons"></a></div></div><div class="twopeople"><div class="container" style="height:200px"><canvas class="illo" width="800" height="800" style="max-width:200px;max-height:200px;touch-action:none;width:640px;height:640px"></canvas></div><script src="https://cdn.jsdelivr.net/gh/Justlovesmile/CDN/js/twopeople1.js"></script><script src="https://cdn.jsdelivr.net/gh/Justlovesmile/CDN/js/zdog.dist.js"></script><script id="rendered-js" src="https://cdn.jsdelivr.net/gh/Justlovesmile/CDN/js/twopeople.js"></script><style>.twopeople{margin:0;align-items:center;justify-content:center;text-align:center}canvas{display:block;margin:0 auto;cursor:move}</style></div><div class="back-to-top motion-element"><i class="fa fa-arrow-up"></i> <span>0%</span></div></div></aside><div id="sidebar-dimmer"></div></div></main><footer class="footer"><div class="footer-inner"><div class="translate-style">繁/简：<a id="translateLink" href="javascript:translatePage();">繁体</a></div><script type="text/javascript" src="/js/tw_cn.js"></script><script type="text/javascript">var defaultEncoding=2,translateDelay=0,cookieDomain="https://tding.top/",msgToTraditionalChinese="繁体",msgToSimplifiedChinese="简体",translateButtonId="translateLink";translateInitilization()</script><div class="beian"><a href="https://beian.miit.gov.cn/" rel="noopener" target="_blank">晋ICP备2021009930号 </a><img src="./image/loading.gif" data-original="https://cdn.jsdelivr.net/gh/Yousazoe/picgo-repo/img/备案图标.png" style="display:inline-block"></div><div class="copyright">© 2020 – <span itemprop="copyrightYear">2022</span> <span class="with-love"><i class="fa fa-heart"></i> </span><span class="author" itemprop="copyrightHolder">Yousazoe</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-chart-area"></i> </span><span title="Symbols count total">4m</span></div><div class="powered-by">今早雾霾蔽日，但是不要害怕，太阳依旧在云端</div><div class="busuanzi-count"><script data-pjax="" async="" src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span class="post-meta-item" id="busuanzi_container_site_uv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-user"></i> </span><span class="site-uv" title="Total Visitors"><span id="busuanzi_value_site_uv"></span> </span></span><span class="post-meta-divider">|</span> <span class="post-meta-item" id="busuanzi_container_site_pv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-eye"></i> </span><span class="site-pv" title="Total Views"><span id="busuanzi_value_site_pv"></span></span></span></div></div></footer></div><script src="/lib/anime.min.js"></script><script src="//cdn.jsdelivr.net/gh/theme-next/theme-next-pjax@0/pjax.min.js"></script><script src="//cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><script src="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.js"></script><script src="//cdn.jsdelivr.net/npm/lozad@1/dist/lozad.min.js"></script><script src="//cdn.jsdelivr.net/npm/pangu@4/dist/browser/pangu.min.js"></script><script src="/lib/velocity/velocity.min.js"></script><script src="/lib/velocity/velocity.ui.min.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/pisces.js"></script><script src="/js/next-boot.js"></script><script>var pjax = new Pjax({
  selectors: [
    'head title',
    '#page-configurations',
    '.content-wrap',
    '.post-toc-wrap',
    '.languages',
    '#pjax'
  ],
  switches: {
    '.post-toc-wrap': Pjax.switches.innerHTML
  },
  analytics: false,
  cacheBust: false,
  scrollTo : !CONFIG.bookmark.enable
});

window.addEventListener('pjax:success', () => {
    $(document).ready(function () {

    if(location.href.indexOf("#reloaded")==-1){
        location.href=location.href+"#reloaded";
        location.reload();
    }
}）
#在这后面可以加入程序的其他代码  


  document.querySelectorAll('script[data-pjax], script#page-configurations, #pjax script').forEach(element => {
    var code = element.text || element.textContent || element.innerHTML || '';
    var parent = element.parentNode;
    parent.removeChild(element);
    var script = document.createElement('script');
    if (element.id) {
      script.id = element.id;
    }
    if (element.className) {
      script.className = element.className;
    }
    if (element.type) {
      script.type = element.type;
    }
    if (element.src) {
      script.src = element.src;
      // Force synchronous loading of peripheral JS.
      script.async = false;
    }
    if (element.dataset.pjax !== undefined) {
      script.dataset.pjax = '';
    }
    if (code !== '') {
      script.appendChild(document.createTextNode(code));
    }
    parent.appendChild(script);
  });

  
  NexT.boot.refresh();
  
  // Define Motion Sequence & Bootstrap Motion.
  if (CONFIG.motion.enable) {
    NexT.motion.integrator
      .init()
      .add(NexT.motion.middleWares.subMenu)
      .add(NexT.motion.middleWares.postList)
      .bootstrap();
  }
  
  NexT.utils.updateSidebarPosition();
});</script><script defer="" src="/lib/three/three.min.js"></script><script defer="" src="//cdn.jsdelivr.net/gh/bynotes/texiao/source/js/caidai.js"></script><script data-pjax="">!function(){var e,t,o,n,r=document.getElementsByTagName("link");if(0<r.length)for(i=0;i<r.length;i++)"canonical"==r[i].rel.toLowerCase()&&r[i].href&&(e=r[i].href);t=(e||window.location.protocol).split(":")[0],e=e||window.location.href,window,o=e,n=document.referrer,/([http|https]:\/\/[a-zA-Z0-9\_\.]+\.baidu\.com)/gi.test(o)||(t="https"===String(t).toLowerCase()?"https://sp0.baidu.com/9_Q4simg2RQJ8t7jm9iCKT-xh_/s.gif":"//api.share.baidu.com/s.gif",n?(t+="?r="+encodeURIComponent(document.referrer),o&&(t+="&l="+o)):o&&(t+="?l="+o),(new Image).src=t)}()</script><script src="/js/local-search.js"></script><script src="//code.tidio.co/ij6vccjedzwoh5yxyoc9qbw6tycfnwjj.js"></script><script data-pjax="">document.querySelectorAll(".pdfobject-container").forEach(e=>{var t=e.dataset.target,a="#"+Object.entries({navpanes:0,toolbar:0,statusbar:0,pagemode:"thumbs",view:"FitH"}).map(([e,t])=>`${e}=${encodeURIComponent(t)}`).join("&"),r=`/lib/pdf/web/viewer.html?file=${encodeURIComponent(t)}${a}`;NexT.utils.supportsPDFs()?e.innerHTML=`<embed class="pdfobject" src="${t+a}" type="application/pdf" style="height: ${e.dataset.height};">`:e.innerHTML=`<iframe src="${r}" style="height: ${e.dataset.height};" frameborder="0"></iframe>`})</script><script data-pjax="">document.querySelectorAll("pre.mermaid").length&&NexT.utils.getScript("//cdn.jsdelivr.net/npm/mermaid@8/dist/mermaid.min.js",()=>{mermaid.initialize({theme:"forest",logLevel:3,flowchart:{curve:"linear"},gantt:{axisFormat:"%m/%d/%Y"},sequence:{actorMargin:50}})},window.mermaid)</script><div id="pjax"></div><script type="text/javascript" src="/js/cursor/fireworks.js"></script><script async="" src="//code.tidio.co/ij6vccjedzwoh5yxyoc9qbw6tycfnwjj.js"></script><script>!function(t,h,e,j){t.hj=t.hj||function(){(t.hj.q=t.hj.q||[]).push(arguments)},t._hjSettings={hjid:2272201,hjsv:6},e=h.getElementsByTagName("head")[0],(j=h.createElement("script")).async=1,j.src="https://static.hotjar.com/c/hotjar-"+t._hjSettings.hjid+".js?sv="+t._hjSettings.hjsv,e.appendChild(j)}(window,document)</script><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({pluginRootPath:"live2dw/",pluginJsPath:"lib/",pluginModelPath:"assets/",tagMode:!1,debug:!1,model:{jsonPath:"/live2dw/assets/hijiki.model.json"},display:{position:"right",width:100,height:200},mobile:{show:!0},log:!1})</script><script>window.imageLazyLoadSetting={isSPA:!1,preloadRatio:3,processImages:null}</script><script>window.addEventListener("load",function(){var t=/\.(gif|jpg|jpeg|tiff|png)$/i,r=/^data:image\/[a-z]+;base64,/;Array.prototype.slice.call(document.querySelectorAll("img[data-original]")).forEach(function(a){var e=a.parentNode;"A"===e.tagName&&(e.href.match(t)||e.href.match(r))&&(e.href=a.dataset.original)})})</script><script>!function(n){n.imageLazyLoadSetting.processImages=o;var e=n.imageLazyLoadSetting.isSPA,i=n.imageLazyLoadSetting.preloadRatio||1,r=Array.prototype.slice.call(document.querySelectorAll("img[data-original]"));function o(){e&&(r=Array.prototype.slice.call(document.querySelectorAll("img[data-original]")));for(var t,a=0;a<r.length;a++)0<=(t=(t=r[a]).getBoundingClientRect()).bottom&&0<=t.left&&t.top<=(n.innerHeight*i||document.documentElement.clientHeight*i)&&function(){var e=r[a],t=e,n=function(){r=r.filter(function(t){return e!==t})},i=new Image,o=t.getAttribute("data-original");i.onload=function(){t.src=o,n()},t.src!==o&&(i.src=o)}()}o(),n.addEventListener("scroll",function(){var t=o,e=n;clearTimeout(t.tId),t.tId=setTimeout(function(){t.call(e)},500)})}(this)</script><script type="text/javascript" charset="utf-8" src="/js/lazyload-plugin/lazyload.intersectionObserver.min.js"></script></body></html>