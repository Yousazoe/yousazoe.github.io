<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 6.2.0"><link rel="apple-touch-icon" sizes="180x180" href="/images/favicon.ico"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.ico"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.ico"><link rel="mask-icon" href="/images/favicon.ico" color="#222"><meta name="google-site-verification" content="35AYyqm-wpmGmXtkn-vQMrk7AkFl1Do55uHdlLLLT38"><meta name="baidu-site-verification" content="slBbq5f8WxljPytW"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="//fonts.proxy.ustclug.org/css?family=Lato:300,300italic,400,400italic,700,700italic&amp;display=swap&amp;subset=latin,latin-ext"><link rel="stylesheet" href="//lib.baomitu.com/font-awesome/5.15.4/css/all.min.css"><link rel="stylesheet" href="//lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css"><link rel="stylesheet" href="//unpkg.com/pace-js@1/themes/blue/pace-theme-minimal.css"><script src="//unpkg.com/pace-js@1.2.4/pace.min.js"></script><script id="hexo-configurations">var NexT=window.NexT||{},CONFIG={hostname:"yousazoe.top",root:"/",scheme:"Gemini",version:"7.8.0",exturl:!1,sidebar:{position:"left",display:"post",padding:18,offset:12,onmobile:!1},copycode:{enable:!0,show_result:!0,style:"mac"},back2top:{enable:!0,sidebar:!0,scrollpercent:!0},bookmark:{enable:!1,color:"#222",save:"auto"},fancybox:!0,mediumzoom:!1,lazyload:!0,pangu:!0,comments:{style:"tabs",active:null,storage:!0,lazyload:!0,nav:null},algolia:{hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}},localsearch:{enable:!0,trigger:"auto",top_n_per_article:3,unescape:!1,preload:!1},motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}},path:"search.xml"}</script><meta name="description" content="引言本节的主题是 Lambertian 着色，向场景中的每盏灯拍摄一条阴影射线。"><meta property="og:type" content="article"><meta property="og:title" content="A Gentle Introduction to DirectX Raytracing 9"><meta property="og:url" content="https://yousazoe.top/archives/d820ec7a.html"><meta property="og:site_name" content="Fl0w3r"><meta property="og:description" content="引言本节的主题是 Lambertian 着色，向场景中的每盏灯拍摄一条阴影射线。"><meta property="og:locale" content="en_US"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/Yousazoe/picgo-repo/img/Tutor09-Output.png"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/Yousazoe/picgo-repo/img/Tutor09-Output-20220115195010593.png"><meta property="article:published_time" content="2022-01-15T11:46:34.000Z"><meta property="article:modified_time" content="2022-09-17T09:07:54.403Z"><meta property="article:author" content="Yousazoe"><meta property="article:tag" content="Computer Graphics"><meta property="article:tag" content="Ray Tracing"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/Yousazoe/picgo-repo/img/Tutor09-Output.png"><link rel="canonical" href="https://yousazoe.top/archives/d820ec7a.html"><script id="page-configurations">CONFIG.page={sidebar:"",isHome:!1,isPost:!0,lang:"en"}</script><title>A Gentle Introduction to DirectX Raytracing 9 | Fl0w3r</title><noscript><style>.sidebar-inner,.use-motion .brand,.use-motion .collection-header,.use-motion .comments,.use-motion .menu-item,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header{opacity:initial}.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.use-motion .logo-line-before i{left:initial}.use-motion .logo-line-after i{right:initial}</style></noscript><link rel="alternate" href="/atom.xml" title="Fl0w3r" type="application/atom+xml"></head><body itemscope="" itemtype="http://schema.org/WebPage"><div class="container use-motion"><div class="headband"></div><header class="header" itemscope="" itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-container"><div class="site-nav-toggle"><div class="toggle" aria-label="Toggle navigation bar"><span class="toggle-line toggle-line-first"></span> <span class="toggle-line toggle-line-middle"></span> <span class="toggle-line toggle-line-last"></span></div></div><div class="site-meta"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span><h1 class="site-title">Fl0w3r</h1><span class="logo-line-after"><i></i></span></a><p class="site-subtitle" itemprop="description">carpe diem</p></div><div class="site-nav-right"><div class="toggle popup-trigger"><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class="site-nav"><ul id="menu" class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-address-card fa-fw"></i>About</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a></li><li class="menu-item menu-item-links"><a href="/links/" rel="section"><i class="fa fa-paperclip fa-fw"></i>Links</a></li><li class="menu-item menu-item-photos"><a href="/photos/" rel="section"><i class="fa fa-camera fa-fw"></i>Photos</a></li><li class="menu-item menu-item-artitalk"><a href="/artitalk/" rel="section"><i class="fa fa-calendar fa-fw"></i>Artitalk</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a></li><li class="menu-item menu-item-document"><a href="/docs/" rel="section"><i class="fas fa-book fa-fw"></i>Document</a></li><li class="menu-item menu-item-qexoadmin"><a href="https://blog-yousazoe-qexo.vercel.app/" rel="noopener" target="_blank"><i class="fa fa-database fa-fw"></i>QexoAdmin</a></li><li class="menu-item menu-item-gametracker"><a href="https://yousazoe.notion.site/yousazoe/b05999823bd14b57a7a6cd81fba1a1af?v=21c3398e0bdb429c9b8157b7bf12ff6a" rel="noopener" target="_blank"><i class="fas fa-trophy fa-fw"></i>GameTracker</a></li><li class="menu-item menu-item-sitemap"><a href="/sitemap.xml" rel="section"><i class="fa fa-sitemap fa-fw"></i>Sitemap</a></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search</a></li></ul></nav><div class="search-pop-overlay"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"><input autocomplete="off" autocapitalize="off" placeholder="Searching..." spellcheck="false" type="search" class="search-input"></div><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span></div><div id="search-result"><div id="no-result"><i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i></div></div></div></div></div></header><div class="reading-progress-bar"></div><main class="main"><div class="main-inner"><div class="content-wrap"><div class="content post posts-expand"><article itemscope="" itemtype="http://schema.org/Article" class="post-block" lang="en"><link itemprop="mainEntityOfPage" href="https://yousazoe.top/archives/d820ec7a.html"><span hidden="" itemprop="author" itemscope="" itemtype="http://schema.org/Person"><meta itemprop="image" content="https://img.yousazoe.top/uPic/img/blog/icon/icon.jpeg"><meta itemprop="name" content="Yousazoe"><meta itemprop="description" content="done is better than perfect"></span><span hidden="" itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization"><meta itemprop="name" content="Fl0w3r"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">A Gentle Introduction to DirectX Raytracing 9</h1><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i> </span><span class="post-meta-item-text">Posted on</span> <time title="Created: 2022-01-15 19:46:34" itemprop="dateCreated datePublished" datetime="2022-01-15T19:46:34+08:00">2022-01-15</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-folder"></i> </span><span class="post-meta-item-text">In</span> <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/%E5%85%89%E7%BA%BF%E8%BF%BD%E8%B8%AA-Ray-Tracing/" itemprop="url" rel="index"><span itemprop="name">光线追踪 (Ray Tracing)</span></a> </span></span><span class="post-meta-item" title="Views" id="busuanzi_container_page_pv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-eye"></i> </span><span class="post-meta-item-text">Views: </span><span id="busuanzi_value_page_pv"></span></span><br><span class="post-meta-item" title="Symbols count in article"><span class="post-meta-item-icon"><i class="fas fa-pen"></i></span><span>6.6k</span> </span><span class="post-meta-item" title="Reading time"><span class="post-meta-item-icon"><i class="far fa-clock"></i> </span><span>12 mins.</span></span></div></header><div class="post-body" itemprop="articleBody"><p><img data-src="https://img.yousazoe.top/uPic/img/blog/icon/mona-loading-default.gif" data-original="https://cdn.jsdelivr.net/gh/Yousazoe/picgo-repo/img/Tutor09-Output.png"></p><h3 id="引言"><a href="#引言" class="headerlink" title="引言"></a>引言</h3><p>本节的主题是 Lambertian 着色，向场景中的每盏灯拍摄一条阴影射线。</p><span id="more"></span><blockquote><p>In <a target="_blank" rel="noopener" href="http://cwyman.org/code/dxrTutors/tutors/Tutor8/tutorial08.md.html">Tutorial 8</a>, we added random camera jitter over a camera lens to introduce dynamic <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Depth_of_field">depth of field</a>, which is typically hard to achieve using rasterization.</p></blockquote><p>在<a target="_blank" rel="noopener" href="http://cwyman.org/code/dxrTutors/tutors/Tutor8/tutorial08.md.html">教程8</a>中，我们在摄像机镜头上添加了随机摄像机抖动，以引入动态<a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Depth_of_field">景深</a>，这通常很难使用光栅化来实现。</p><blockquote><p>This tutorial finally gets rid of the <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Ambient_occlusion">ambient occlusion</a> shading introduced in <a target="_blank" rel="noopener" href="http://cwyman.org/code/dxrTutors/tutors/Tutor5/tutorial05.md.html">Tutorial 5</a> and replaces it with a simple diffuse shading model (also known as a <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Lambertian_reflectance">Lambertian</a> material model). In addition to using Lambertian shading, we also trace shadow rays to each light in the scene. This gives us pixel-accurate hard shadows, which is still something of an open problem in rasterization (which has been plagued by <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Shadow_mapping">shadow map</a> <a target="_blank" rel="noopener" href="http://roar11.com/2015/05/dealing-with-shadow-map-artifacts/">artifacts</a> for decades).</p></blockquote><p>本教程最终摆脱了 <a target="_blank" rel="noopener" href="http://cwyman.org/code/dxrTutors/tutors/Tutor5/tutorial05.md.html">教程 5</a> 中引入的<a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Ambient_occlusion">环境光遮蔽</a>着色，并将其替换为简单的漫反射着色模型（也称为<a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Lambertian_reflectance">Lambertian</a>材质模型）。除了使用 Lambertian 着色之外，我们还将阴影光线追踪到场景中的每一种光线。这为我们提供了像素级精度的硬阴影，这在光栅化中仍然是一个悬而未决的问题（几十年来一直受到 <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Shadow_mapping">阴影贴图</a> <a target="_blank" rel="noopener" href="http://roar11.com/2015/05/dealing-with-shadow-map-artifacts/">伪影</a>的困扰）。</p><h3 id="Our-Lambertian-Rendering-Pipeline"><a href="#Our-Lambertian-Rendering-Pipeline" class="headerlink" title="Our Lambertian Rendering Pipeline"></a>Our Lambertian Rendering Pipeline</h3><blockquote><p>If you open up <code>Tutor09-LambertianPlusShadows.cpp</code>, you will find our new pipeline combines a the <code>ThinLensGBufferPass</code> from <a target="_blank" rel="noopener" href="http://cwyman.org/code/dxrTutors/tutors/Tutor8/tutorial08.md.html">Tutorial 8</a> and our new <code>LambertianPlusShadowPass</code>.</p></blockquote><p>如果您打开 <code>Tutor09-LambertianPlusShadows.cpp</code>，您会发现我们的新管道结合了<a target="_blank" rel="noopener" href="http://cwyman.org/code/dxrTutors/tutors/Tutor8/tutorial08.md.html">教程8 </a>中的 <code>ThinLensGBufferPass</code> 和我们新的 <code>LambertianPlusShadowPass</code>。</p><figure class="highlight c++"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">// Create our rendering pipeline</span></span><br><span class="line">RenderingPipeline *pipeline = <span class="keyword">new</span> <span class="built_in">RenderingPipeline</span>();</span><br><span class="line">pipeline-&gt;<span class="built_in">setPass</span>(<span class="number">0</span>, ThinLensGBufferPass::<span class="built_in">create</span>());   </span><br><span class="line">pipeline-&gt;<span class="built_in">setPass</span>(<span class="number">1</span>, LambertianPlusShadowPass::<span class="built_in">create</span>());    </span><br></pre></td></tr></tbody></table></figure><blockquote><p>Just like the ambient occlusion pass our new <code>LambertianPlusShadowPass</code> replaces, we will read from a G-buffer, compute shading and ray traced shadows, and output the result to the displayed image <code>kOutputChannel</code>.</p></blockquote><p>就像我们新的 <code>LambertianPlusShadowPass</code> 取代的环境光遮蔽一样，我们将从G缓冲区读取，计算阴影和光线追踪阴影，并将结果输出到显示的图像 <code>kOutputChannel</code>。</p><h3 id="Setting-up-Our-Lambertian-Rendering-Pass"><a href="#Setting-up-Our-Lambertian-Rendering-Pass" class="headerlink" title="Setting up Our Lambertian Rendering Pass"></a>Setting up Our Lambertian Rendering Pass</h3><blockquote><p>Continue by looking in <code>LambertianPlusShadowPass.h</code>. This header consists entirely of standard boilerplate and <code>RayLaunch</code> wrappers you have seen in prior tutorials.</p></blockquote><p>继续查看 <code>LambertianPlusShadowPass.h</code>。此头文件完全由您在之前的教程中看到的标准样板和 <code>RayLaunch</code> 包装器组成。</p><blockquote><p>Similarly, looking at <code>LambertianPlusShadowPass::initialize()</code> shows a set of familar functionality: requesting appropriate inputs from our G-buffer pass and setting up our diffuse <code>RayLaunch</code> wrapper’s ray generation, miss, closest-hit, and any-hit shaders appropriately.</p></blockquote><p>同样，查看 <code>LambertianPlusShadowPass::initialize()</code> 显示了一组熟悉的功能：从我们的 G 缓冲区传递请求适当的输入，并适当地设置漫反射 <code>RayLaunch</code> 包装器的光线生成、未命中、最接近命中和任意命中着色器。</p><blockquote><p>Looking at <code>LambertianPlusShadowPass::execute()</code> is also straightforward, though it might be worth pointing out that in:</p></blockquote><p>看看 <code>LambertianPlusShadowPass::execute()</code> 也很简单，尽管可能值得指出这一点：</p><figure class="highlight c++"><table><tbody><tr><td class="code"><pre><span class="line">rayGenVars[<span class="string">"RayGenCB"</span>][<span class="string">"gMinT"</span>] = mpResManager-&gt;<span class="built_in">getMinTDist</span>();</span><br></pre></td></tr></tbody></table></figure><blockquote><p><code>getMinTDist()</code> returns a selectable parameter from the GUI that specifies how far shadow rays should be offset to avoid self-intersections due to numerical precision.</p></blockquote><p><code>getMinTDist()</code> 从 GUI 返回一个可选参数，该参数指定阴影光线应偏移多远以避免由于数值精度而产生的自交。</p><h3 id="Lambertian-Shading-and-Shooting-Shadow-Rays"><a href="#Lambertian-Shading-and-Shooting-Shadow-Rays" class="headerlink" title="Lambertian Shading and Shooting Shadow Rays"></a>Lambertian Shading and Shooting Shadow Rays</h3><blockquote><p>In our HLSL shader file <code>lambertianPlusShadows.rt.hlsl</code>, let’s start by looking at out ray generation shader <code>LambertShadowsRayGen()</code>:</p></blockquote><p>在我们的 HLSL 着色器文件 <code>lambertianPlusShadows.rt.hlsl</code> 中，让我们从射线生成着色器 <code>LambertShadowsRayGen()</code> 开始。:</p><figure class="highlight c++"><table><tbody><tr><td class="code"><pre><span class="line">[<span class="built_in">shader</span>(<span class="string">"raygeneration"</span>)]</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">LambertShadowsRayGen</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">  ...</span><br><span class="line">  float4 difMatlColor = gDiffuseMatl[launchIndex];     </span><br><span class="line">  </span><br><span class="line">  <span class="comment">// If we don't hit any geometry, our difuse material is our background color.</span></span><br><span class="line">  float3 shadeColor = (worldPos.w != <span class="number">0.0f</span>) ? <span class="built_in">float3</span>(<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>) : difMatlColor.rgb;</span><br><span class="line">  ...  </span><br></pre></td></tr></tbody></table></figure><blockquote><p>Most of the the beginning of this shader is identical to our ambient occlusion shader. However, we do load our diffuse material color from the G-buffer. The G-buffer’s diffuse color serves two purposes in our implementation: for surfaces, it stores their Lambertian color; for background pixels, it stores the background color.</p></blockquote><p>此着色器的大部分开头都与我们的环境光遮蔽着色器相同。但是，我们确实从 G 缓冲区加载了漫反射材料的颜色。在我们的实现中，G 缓冲区的漫反射颜色有两个用途：对于表面，它存储其 Lambertian 颜色；对于背景像素，它存储背景色。</p><blockquote><p>So, we initialize our final output color <code>shadeColor</code> to the diffuse color if our pixel falls on the background, otherwise we initialize our shaded color to black.</p></blockquote><p>因此，如果像素落在背景上，我们将最终输出的颜色 <code>shadeColor</code> 初始化为漫反射色，否则我们将着色颜色初始化为黑色。</p><figure class="highlight c++"><table><tbody><tr><td class="code"><pre><span class="line">  ...</span><br><span class="line">  <span class="comment">// Loop over all the lights in the scene</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="type">int</span> lightIdx = <span class="number">0</span>; lightIdx &lt; gLightsCount; lightIdx++) </span><br><span class="line">  {</span><br><span class="line">     <span class="comment">// Query our scene to get this info about the current light</span></span><br><span class="line">     <span class="type">float</span>  distToLight;   <span class="comment">// How far away is it?</span></span><br><span class="line">     float3 lightColor;    <span class="comment">// What color is it?</span></span><br><span class="line">     float3 toLight;       <span class="comment">// What direction is it from our current hitpoint?</span></span><br><span class="line"></span><br><span class="line">     <span class="comment">// A helper to query the Falcor scene to get light data</span></span><br><span class="line">     <span class="built_in">getLightData</span>(lightIdx, worldPos.xyz, toLight, lightColor, distToLight);</span><br><span class="line"></span><br><span class="line">     <span class="comment">// Compute our Lambertion term (NL dot L)</span></span><br><span class="line">     <span class="type">float</span> NdotL = <span class="built_in">saturate</span>(<span class="built_in">dot</span>(worldNorm.xyz, toLight));</span><br><span class="line"></span><br><span class="line">     <span class="comment">// Shoot our ray.  Return 1.0 for lit, 0.0 for shadowed</span></span><br><span class="line">     <span class="type">float</span> vis   = <span class="built_in">shootShadowRay</span>(worldPos.xyz, toLight, gMinT, distToLight);</span><br><span class="line"></span><br><span class="line">     <span class="comment">// Accumulate our Lambertian shading color</span></span><br><span class="line">     shadeColor += vis * NdotL * lightColor; </span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Modulate based on the physically based Lambertian term (albedo/pi)</span></span><br><span class="line">  shadeColor *= difMatlColor.rgb / M_PI;</span><br><span class="line">  ...</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><blockquote><p>The next important part of our Lambertian shader is our loop over the scene’s lights. Here <code>gLightsCount</code> is an automatically set Falcor global variable that specifies how many lights your currently loaded scene has. We need to loop over all these lights and accumulate the light’s (potentially shadowed) contribution to the current pixel.</p></blockquote><p>Lambertian 着色器的下一个重要部分是我们在场景灯光上的循环。此处 <code>gLightsCount</code>是一个自动设置的 Falcor 全局变量，用于指定当前加载的场景有多少灯光。我们需要循环所有这些光，并累积光对当前像素的贡献（可能被阴影）。</p><blockquote><p>To do this we need a little more data about the light’s properties. To avoid digging into specifcs of Falcor’s scene representation, I wrote a simple helper <code>getLightData()</code> to extract this light data. (For reference, this function is available in header with HLSL helper functions in the tutorial’s Visual Studio project.)</p></blockquote><p>为此，我们需要更多关于光属性的数据。为了避免深入研究Falcor场景表示的规格，我写了一个简单的助手 <code>getLightData()</code> 来提取这些光数据。（作为参考，此函数在标头中可用，并在教程的 Visual Studio 项目中提供 HLSL 帮助程序函数。</p><blockquote><p>Once we have the direction to the light, we can compute the Lambertian color as light color times diffuse <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Bidirectional_reflectance_distribution_function">BRDF</a> times Lambertian term:</p><ul><li>Our diffuse BRDF is <code>difMatlColor.rgb / M_PI</code></li><li>Our Lambertian term is the dot product <code>NdotL</code></li><li>Our light color is <code>lightColor \* vis</code></li></ul></blockquote><p>一旦我们有了光的方向，我们就可以计算出朗伯色作为光色乘以漫反射 <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Bidirectional_reflectance_distribution_function">BRDF</a> 乘以朗伯子项：</p><ul><li>我们的漫反射 BRDF 是 <code>difMatlColor.rgb / M_PI</code></li><li>我们的 Lambertian term 是点积 <code>NdotL</code></li><li>我们的光色是 <code>lightColor \* vis</code></li></ul><blockquote><p>Where <code>vis</code> is a visibility factor of either <code>1.0f</code> or <code>0.0f</code> depending on if our shadow ray determined the light illuminates the pixel.</p></blockquote><p>其中 <code>vis</code> 是 <code>0.0f</code> 或 <code>1.0f</code> 的可见性因子，具体取决于我们的阴影光线是否决定了光线照亮像素。</p><blockquote><p>We compute our visibility factor with our utility routine <code>shootShadowRay()</code>. It turns out that both shadow and ambient occlusion rays are asking the same question (i.e., “is anything between point A and point B?”). That means <code>shootShadowRay()</code> is identical to the <code>shootAoRay()</code> used in prior tutorials. (And our miss, closest-hit, and any-hit shaders are also the same.)</p></blockquote><p>我们用我们的效用例程 <code>shootShadowRay()</code> 来计算我们的可见性因子。事实证明，阴影和环境光遮蔽射线都在问同样的问题（即，“A 点和 B 点之间有什么东西吗？”）。这意味着 <code>shootShadowRay()</code> 与之前教程中使用的 <code>shootAoRay()</code> 相同。（我们的未命中、最接近命中和任意命中着色器也是相同的。）</p><h3 id="What-Does-it-Look-Like"><a href="#What-Does-it-Look-Like" class="headerlink" title="What Does it Look Like?"></a>What Does it Look Like?</h3><blockquote><p>That covers the important points of this tutorial. When running, you get the following result:</p></blockquote><p>这涵盖了本教程的要点。运行时，您将获得以下结果：</p><p><img data-src="https://img.yousazoe.top/uPic/img/blog/icon/mona-loading-default.gif" data-original="https://cdn.jsdelivr.net/gh/Yousazoe/picgo-repo/img/Tutor09-Output-20220115195010593.png"></p><blockquote><p>Hopefully, this tutorial demonstrated how to use a slightly more interesting and realistic shading model and how to do simplistic queries to Falcor scene data to shoot shadow rays towards scene-specified lights.</p></blockquote><p>希望本教程演示了如何使用稍微有趣和逼真的着色模型，以及如何对 Falcor 场景数据进行简单查询，以将阴影光线射向场景指定的灯光。</p><blockquote><p>When you are ready, continue on to <a target="_blank" rel="noopener" href="http://cwyman.org/code/dxrTutors/tutors/Tutor10/tutorial10.md.html">Tutorial 10</a>, shows how to load an <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/High-dynamic-range_imaging">high dynamic range</a> <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Reflection_mapping">environment map</a> and use a DirectX miss shader to return a background color that varies across the screen.</p></blockquote><p>准备就绪后，请继续学习 <a target="_blank" rel="noopener" href="http://cwyman.org/code/dxrTutors/tutors/Tutor10/tutorial10.md.html">教程10</a>，了解如何加载 <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/High-dynamic-range_imaging">高动态范围</a><a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Reflection_mapping">环境贴图</a>，并使用 DirectX 未命中着色器返回随屏幕变化的背景色。</p></div><div class="popular-posts-header">Related Posts</div><ul class="popular-posts"><li class="popular-posts-item"><div class="popular-posts-title"><a href="/archives/7dbe30e4.html" rel="bookmark">Blockwise Multi-Order Feature Regression for Real-Time Path Tracing Reconstruction</a></div></li><li class="popular-posts-item"><div class="popular-posts-title"><a href="/archives/971404c0.html" rel="bookmark">Rendering Course by Wangningbei</a></div></li><li class="popular-posts-item"><div class="popular-posts-title"><a href="/archives/8b6729fe.html" rel="bookmark">A Gentle Introduction to DirectX Raytracing 14</a></div></li></ul><footer class="post-footer"><div class="post-tags"><a href="/tags/Computer-Graphics/" rel="tag"># Computer Graphics</a> <a href="/tags/Ray-Tracing/" rel="tag"># Ray Tracing</a></div><div class="post-nav"><div class="post-nav-item"><a href="/archives/6ad1c311.html" rel="prev" title="Lecture 01 - Introduction"><i class="fa fa-chevron-left"></i> Lecture 01 - Introduction</a></div><div class="post-nav-item"><a href="/archives/decab052.html" rel="next" title="材质着色与光照">材质着色与光照 <i class="fa fa-chevron-right"></i></a></div></div></footer></article></div><script>window.addEventListener("tabs:register",()=>{let{activeClass:e}=CONFIG.comments;if(CONFIG.comments.storage&&(e=localStorage.getItem("comments_active")||e),e){let t=document.querySelector(`a[href="#comment-${e}"]`);t&&t.click()}}),CONFIG.comments.storage&&window.addEventListener("tabs:click",t=>{t.target.matches(".tabs-comment .tab-content .tab-pane")&&(t=t.target.classList[1],localStorage.setItem("comments_active",t))})</script></div><div class="toggle sidebar-toggle"><span class="toggle-line toggle-line-first"></span> <span class="toggle-line toggle-line-middle"></span> <span class="toggle-line toggle-line-last"></span></div><aside class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc">Table of Contents</li><li class="sidebar-nav-overview">Overview</li></ul><div class="post-toc-wrap sidebar-panel"><div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BC%95%E8%A8%80"><span class="nav-number">1.</span> <span class="nav-text">引言</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Our-Lambertian-Rendering-Pipeline"><span class="nav-number">2.</span> <span class="nav-text">Our Lambertian Rendering Pipeline</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Setting-up-Our-Lambertian-Rendering-Pass"><span class="nav-number">3.</span> <span class="nav-text">Setting up Our Lambertian Rendering Pass</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Lambertian-Shading-and-Shooting-Shadow-Rays"><span class="nav-number">4.</span> <span class="nav-text">Lambertian Shading and Shooting Shadow Rays</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#What-Does-it-Look-Like"><span class="nav-number">5.</span> <span class="nav-text">What Does it Look Like?</span></a></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person"><img class="site-author-image" itemprop="image" alt="Yousazoe" src="https://img.yousazoe.top/uPic/img/blog/icon/icon.jpeg"><p class="site-author-name" itemprop="name">Yousazoe</p><div class="site-description" itemprop="description">done is better than perfect</div></div><div class="site-state-wrap motion-element"><nav class="site-state"><div class="site-state-item site-state-posts"><a href="/archives/"><span class="site-state-item-count">292</span> <span class="site-state-item-name">posts</span></a></div><div class="site-state-item site-state-categories"><a href="/categories/"><span class="site-state-item-count">46</span> <span class="site-state-item-name">categories</span></a></div><div class="site-state-item site-state-tags"><a href="/tags/"><span class="site-state-item-count">71</span> <span class="site-state-item-name">tags</span></a></div></nav></div><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="mailto:zoeyousa@gmail.com" title="E-Mail → mailto:zoeyousa@gmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i></a> </span><span class="links-of-author-item"><a href="https://github.com/Yousazoe" title="GitHub → https://github.com/Yousazoe" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i></a> </span><span class="links-of-author-item"><a href="https://twitter.com/YousaZoe" title="Twitter → https://twitter.com/YousaZoe" rel="noopener" target="_blank"><i class="fab fa-twitter fa-fw"></i></a> </span><span class="links-of-author-item"><a href="https://www.weibo.com/6034231696/profile?rightmod=1&amp;wvr=6&amp;mod=personinfo&amp;is_all=1" title="Weibo → https://www.weibo.com/6034231696/profile?rightmod=1&amp;wvr=6&amp;mod=personinfo&amp;is_all=1" rel="noopener" target="_blank"><i class="fab fa-weibo fa-fw"></i></a> </span><span class="links-of-author-item"><a href="https://steamcommunity.com/profiles/76561198856466228/" title="Steam → https://steamcommunity.com/profiles/76561198856466228/" rel="noopener" target="_blank"><i class="fab fa-steam fa-fw"></i></a> </span><span class="links-of-author-item"><a href="https://www.chess.com/member/yousazoe" title="Chess → https://www.chess.com/member/yousazoe" rel="noopener" target="_blank"><i class="fa fa-chess-pawn fa-fw"></i></a> </span><span class="links-of-author-item"><a href="/atom.xml" title="RSS → /atom.xml"><i class="fa fa-rss fa-fw"></i></a></span></div><div class="cc-license motion-element" itemprop="license"><a href="https://creativecommons.org/licenses/by-nc-sa/4.0/zh-CN" class="cc-opacity" rel="noopener" target="_blank"><img src="https://img.yousazoe.top/uPic/img/blog/icon/mona-loading-default.gif" data-original="/images/cc-by-nc-sa.svg" alt="Creative Commons"></a></div></div><div class="twopeople"><div class="container" style="height:200px"><canvas class="illo" width="800" height="800" style="max-width:200px;max-height:200px;touch-action:none;width:640px;height:640px"></canvas></div><script src="https://img.yousazoe.top/js/twopeople1.js"></script><script src="https://img.yousazoe.top/js/zdog.dist.js"></script><script id="rendered-js" src="https://img.yousazoe.top/js/twopeople.js"></script><style>.twopeople{margin:0;align-items:center;justify-content:center;text-align:center}canvas{display:block;margin:0 auto;cursor:move}</style></div><div class="cc-license animated" itemprop="sponsor"><link rel="preconnect" href="https://www.netlify.com"><span class="exturl cc-opacity" title="Deploy with Netlify → https://www.netlify.com" data-url="aHR0cHM6Ly93d3cubmV0bGlmeS5jb20="><img width="80" src="https://img.yousazoe.top/uPic/img/blog/icon/mona-loading-default.gif" data-original="https://www.netlify.com/img/global/badges/netlify-dark.svg" alt="Netlify"></span></div><div class="back-to-top motion-element"><i class="fa fa-arrow-up"></i> <span>0%</span></div></div></aside><div id="sidebar-dimmer"></div></div></main><footer class="footer"><div class="footer-inner"><div class="translate-style">繁/简：<a id="translateLink" href="javascript:translatePage();">繁体</a></div><script type="text/javascript" src="/js/tw_cn.js"></script><script type="text/javascript">var defaultEncoding=2,translateDelay=0,cookieDomain="https://tding.top/",msgToTraditionalChinese="繁体",msgToSimplifiedChinese="简体",translateButtonId="translateLink";translateInitilization()</script><div class="beian"><a href="https://beian.miit.gov.cn/" rel="noopener" target="_blank">晋ICP备2021009930号 </a><img src="https://img.yousazoe.top/uPic/img/blog/icon/mona-loading-default.gif" data-original="https://img.yousazoe.top/uPic/img/blog/icon/beian.png" style="display:inline-block"></div><div class="copyright">© 2020 – <span itemprop="copyrightYear">2022</span> <span class="with-love"><i class="fa fa-heart"></i> </span><span class="author" itemprop="copyrightHolder">Yousazoe</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-chart-area"></i> </span><span title="Symbols count total">4.5m</span></div><div class="powered-by"><span><a target="_blank" rel="noopener" href="https://www.upyun.com/?utm_source=lianmeng&amp;utm_medium=referral"><img src="https://img.yousazoe.top/uPic/img/blog/icon/mona-loading-default.gif" data-original="https://cdn.jsdelivr.net/gh/YukiNoUta/cdn-static@main/blog/svg/upyun.svg" width="53" height="18" style="fill:currentColor;display:inline-block"></a></span><span class="post-meta-divider">|</span>今早雾霾蔽日，但是不要害怕，太阳依旧在云端</div><div class="busuanzi-count"><script data-pjax="" async="" src="js/busuanzi.pure.mini.js"></script><span class="post-meta-item" id="busuanzi_container_site_uv" style="display:inline"><span class="post-meta-item-icon"><i class="fa fa-user"></i> </span><span class="site-uv" title="Total Visitors"><span id="busuanzi_value_site_uv"></span> </span></span><span class="post-meta-divider">|</span> <span class="post-meta-item" id="busuanzi_container_site_pv" style="display:inline"><span class="post-meta-item-icon"><i class="fa fa-eye"></i> </span><span class="site-pv" title="Total Views"><span id="busuanzi_value_site_pv"></span></span></span></div></div></footer></div><script src="//unpkg.com/animejs@3.1.0/lib/anime.min.js"></script><script src="//npm.elemecdn.com/pjax/pjax.min.js"></script><script src="//lib.baomitu.com/jquery/3.6.0/jquery.min.js"></script><script src="//lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js"></script><script src="//unpkg.com/lozad@1.16.0/dist/lozad.min.js"></script><script src="//lib.baomitu.com/pangu/4.0.7/pangu.min.js"></script><script src="/lib/velocity/velocity.min.js"></script><script src="/lib/velocity/velocity.ui.min.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/pisces.js"></script><script src="/js/next-boot.js"></script><script>var pjax = new Pjax({
  selectors: [
    'head title',
    '#page-configurations',
    '.content-wrap',
    '.post-toc-wrap',
    '.languages',
    '#pjax'
  ],
  switches: {
    '.post-toc-wrap': Pjax.switches.innerHTML
  },
  analytics: false,
  cacheBust: false,
  scrollTo : !CONFIG.bookmark.enable
});

window.addEventListener('pjax:success', () => {
    $(document).ready(function () {

    if(location.href.indexOf("#reloaded")==-1){
        location.href=location.href+"#reloaded";
        location.reload();
    }
}）
#在这后面可以加入程序的其他代码  


  document.querySelectorAll('script[data-pjax], script#page-configurations, #pjax script').forEach(element => {
    var code = element.text || element.textContent || element.innerHTML || '';
    var parent = element.parentNode;
    parent.removeChild(element);
    var script = document.createElement('script');
    if (element.id) {
      script.id = element.id;
    }
    if (element.className) {
      script.className = element.className;
    }
    if (element.type) {
      script.type = element.type;
    }
    if (element.src) {
      script.src = element.src;
      // Force synchronous loading of peripheral JS.
      script.async = false;
    }
    if (element.dataset.pjax !== undefined) {
      script.dataset.pjax = '';
    }
    if (code !== '') {
      script.appendChild(document.createTextNode(code));
    }
    parent.appendChild(script);
  });

  
  NexT.boot.refresh();
  
  // Define Motion Sequence & Bootstrap Motion.
  if (CONFIG.motion.enable) {
    NexT.motion.integrator
      .init()
      .add(NexT.motion.middleWares.subMenu)
      .add(NexT.motion.middleWares.postList)
      .bootstrap();
  }
  
  NexT.utils.updateSidebarPosition();
});</script><script defer="" src="//img.yousazoe.top/js/three.min.js"></script><script defer="" src="//img.yousazoe.top/js/caidai.js"></script><script data-pjax="">!function(){var e,t,o,n,r=document.getElementsByTagName("link");if(0<r.length)for(i=0;i<r.length;i++)"canonical"==r[i].rel.toLowerCase()&&r[i].href&&(e=r[i].href);t=(e||window.location.protocol).split(":")[0],e=e||window.location.href,window,o=e,n=document.referrer,/([http|https]:\/\/[a-zA-Z0-9\_\.]+\.baidu\.com)/gi.test(o)||(t="https"===String(t).toLowerCase()?"https://sp0.baidu.com/9_Q4simg2RQJ8t7jm9iCKT-xh_/s.gif":"//api.share.baidu.com/s.gif",n?(t+="?r="+encodeURIComponent(document.referrer),o&&(t+="&l="+o)):o&&(t+="?l="+o),(new Image).src=t)}()</script><script src="/js/local-search.js"></script><script data-pjax="">document.querySelectorAll(".pdfobject-container").forEach(e=>{var t=e.dataset.target,a="#"+Object.entries({navpanes:0,toolbar:0,statusbar:0,pagemode:"thumbs",view:"FitH"}).map(([e,t])=>`${e}=${encodeURIComponent(t)}`).join("&"),r=`/lib/pdf/web/viewer.html?file=${encodeURIComponent(t)}${a}`;NexT.utils.supportsPDFs()?e.innerHTML=`<embed class="pdfobject" src="${t+a}" type="application/pdf" style="height: ${e.dataset.height};">`:e.innerHTML=`<iframe src="${r}" style="height: ${e.dataset.height};" frameborder="0"></iframe>`})</script><script data-pjax="">document.querySelectorAll("pre.mermaid").length&&NexT.utils.getScript("//lib.baomitu.com/mermaid/8.4.8/mermaid.min.js",()=>{mermaid.initialize({theme:"forest",logLevel:3,flowchart:{curve:"linear"},gantt:{axisFormat:"%m/%d/%Y"},sequence:{actorMargin:50}})},window.mermaid)</script><div id="pjax"></div><script type="text/javascript" src="/js/cursor/fireworks.js"></script><script src="https://img.yousazoe.top/live2dw/lib/L2Dwidget.min.js"></script><script>L2Dwidget.init({pluginRootPath:"live2dw/",pluginJsPath:"lib/",pluginModelPath:"assets/",tagMode:!1,debug:!1,model:{jsonPath:"/live2dw/assets/assets/hijiki.model.json"},display:{position:"right",width:100,height:200},mobile:{show:!0},log:!1})</script><script>window.imageLazyLoadSetting={isSPA:!1,preloadRatio:5,processImages:null}</script><script>window.addEventListener("load",function(){var t=/\.(gif|jpg|jpeg|tiff|png)$/i,r=/^data:image\/[a-z]+;base64,/;Array.prototype.slice.call(document.querySelectorAll("img[data-original]")).forEach(function(a){var e=a.parentNode;"A"===e.tagName&&(e.href.match(t)||e.href.match(r))&&(e.href=a.dataset.original)})})</script><script>!function(n){n.imageLazyLoadSetting.processImages=o;var e=n.imageLazyLoadSetting.isSPA,i=n.imageLazyLoadSetting.preloadRatio||1,r=Array.prototype.slice.call(document.querySelectorAll("img[data-original]"));function o(){e&&(r=Array.prototype.slice.call(document.querySelectorAll("img[data-original]")));for(var t,a=0;a<r.length;a++)0<=(t=(t=r[a]).getBoundingClientRect()).bottom&&0<=t.left&&t.top<=(n.innerHeight*i||document.documentElement.clientHeight*i)&&function(){var e=r[a],t=e,n=function(){r=r.filter(function(t){return e!==t})},i=new Image,o=t.getAttribute("data-original");i.onload=function(){t.src=o,n()},t.src!==o&&(i.src=o)}()}o(),n.addEventListener("scroll",function(){var t=o,e=n;clearTimeout(t.tId),t.tId=setTimeout(function(){t.call(e)},500)})}(this)</script><script type="text/javascript" charset="utf-8" src="/js/lazyload-plugin/lazyload.intersectionObserver.min.js"></script></body></html>