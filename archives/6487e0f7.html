<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 6.2.0"><link rel="apple-touch-icon" sizes="180x180" href="/images/favicon.ico"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.ico"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.ico"><link rel="mask-icon" href="/images/favicon.ico" color="#222"><meta name="google-site-verification" content="35AYyqm-wpmGmXtkn-vQMrk7AkFl1Do55uHdlLLLT38"><meta name="baidu-site-verification" content="slBbq5f8WxljPytW"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="//fonts.proxy.ustclug.org/css?family=Lato:300,300italic,400,400italic,700,700italic&amp;display=swap&amp;subset=latin,latin-ext"><link rel="stylesheet" href="//lf9-cdn-tos.bytecdntp.com/cdn/expire-1-M/font-awesome/5.15.4/css/all.min.css"><link rel="stylesheet" href="//lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css"><link rel="stylesheet" href="//unpkg.com/pace-js@1/themes/blue/pace-theme-minimal.css"><script src="//unpkg.com/pace-js@1.2.4/pace.min.js"></script><script id="hexo-configurations">var NexT=window.NexT||{},CONFIG={hostname:"yousazoe.top",root:"/",scheme:"Gemini",version:"7.8.0",exturl:!1,sidebar:{position:"left",display:"post",padding:18,offset:12,onmobile:!1},copycode:{enable:!0,show_result:!0,style:"mac"},back2top:{enable:!0,sidebar:!0,scrollpercent:!0},bookmark:{enable:!1,color:"#222",save:"auto"},fancybox:!0,mediumzoom:!1,lazyload:!0,pangu:!0,comments:{style:"tabs",active:null,storage:!0,lazyload:!0,nav:null},algolia:{hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}},localsearch:{enable:!0,trigger:"auto",top_n_per_article:3,unescape:!1,preload:!1},motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}},path:"search.xml"}</script><meta name="description" content="PromaxGames Sponsor Titles by        Blake Fawley           引言一说到游戏，很多人脑海里浮现的可能是家用游戏机的绚丽画面。不过遗憾的是，我们暂时还不能开发那样的游戏。我们将开发一个通过命令行运行的简单游戏，学习C++的基本用法。"><meta property="og:type" content="article"><meta property="og:title" content="2D游戏开发"><meta property="og:url" content="https://yousazoe.top/archives/6487e0f7.html"><meta property="og:site_name" content="Fl0w3r"><meta property="og:description" content="PromaxGames Sponsor Titles by        Blake Fawley           引言一说到游戏，很多人脑海里浮现的可能是家用游戏机的绚丽画面。不过遗憾的是，我们暂时还不能开发那样的游戏。我们将开发一个通过命令行运行的简单游戏，学习C++的基本用法。"><meta property="og:locale" content="en_US"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/Yousazoe/picgo-repo/img/0081Kckwgy1gkrfcylq45j312w0gak12.jpg"><meta property="article:published_time" content="2020-11-16T15:20:35.000Z"><meta property="article:modified_time" content="2023-03-11T13:00:22.119Z"><meta property="article:author" content="Yousazoe"><meta property="article:tag" content="Cpp"><meta property="article:tag" content="Game Develop"><meta property="article:tag" content="SEGA"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/Yousazoe/picgo-repo/img/0081Kckwgy1gkrfcylq45j312w0gak12.jpg"><link rel="canonical" href="https://yousazoe.top/archives/6487e0f7.html"><script id="page-configurations">CONFIG.page={sidebar:"",isHome:!1,isPost:!0,lang:"en"}</script><title>2D游戏开发 | Fl0w3r</title><noscript><style>.sidebar-inner,.use-motion .brand,.use-motion .collection-header,.use-motion .comments,.use-motion .menu-item,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header{opacity:initial}.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.use-motion .logo-line-before i{left:initial}.use-motion .logo-line-after i{right:initial}</style></noscript><link rel="alternate" href="/atom.xml" title="Fl0w3r" type="application/atom+xml"></head><body itemscope="" itemtype="http://schema.org/WebPage"><div class="container use-motion"><div class="headband"></div><header class="header" itemscope="" itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-container"><div class="site-nav-toggle"><div class="toggle" aria-label="Toggle navigation bar"><span class="toggle-line toggle-line-first"></span> <span class="toggle-line toggle-line-middle"></span> <span class="toggle-line toggle-line-last"></span></div></div><div class="site-meta"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span><h1 class="site-title">Fl0w3r</h1><span class="logo-line-after"><i></i></span></a><p class="site-subtitle" itemprop="description">carpe diem</p></div><div class="site-nav-right"><div class="toggle popup-trigger"><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class="site-nav"><ul id="menu" class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-address-card fa-fw"></i>About</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a></li><li class="menu-item menu-item-links"><a href="/links/" rel="section"><i class="fa fa-paperclip fa-fw"></i>Links</a></li><li class="menu-item menu-item-photos"><a href="/photos/" rel="section"><i class="fa fa-camera fa-fw"></i>Photos</a></li><li class="menu-item menu-item-artitalk"><a href="/artitalk/" rel="section"><i class="fa fa-calendar fa-fw"></i>Artitalk</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a></li><li class="menu-item menu-item-document"><a href="/docs/" rel="section"><i class="fas fa-book fa-fw"></i>Document</a></li><li class="menu-item menu-item-qexoadmin"><a href="https://blog-yousazoe-qexo.vercel.app/" rel="noopener" target="_blank"><i class="fa fa-database fa-fw"></i>QexoAdmin</a></li><li class="menu-item menu-item-gametracker"><a href="https://yousazoe.notion.site/yousazoe/b05999823bd14b57a7a6cd81fba1a1af?v=21c3398e0bdb429c9b8157b7bf12ff6a" rel="noopener" target="_blank"><i class="fas fa-trophy fa-fw"></i>GameTracker</a></li><li class="menu-item menu-item-sitemap"><a href="/sitemap.xml" rel="section"><i class="fa fa-sitemap fa-fw"></i>Sitemap</a></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search</a></li></ul></nav><div class="search-pop-overlay"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"><input autocomplete="off" autocapitalize="off" placeholder="Searching..." spellcheck="false" type="search" class="search-input"></div><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span></div><div id="search-result"><div id="no-result"><i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i></div></div></div></div></div></header><div class="reading-progress-bar"></div><main class="main"><div class="main-inner"><div class="content-wrap"><div class="content post posts-expand"><article itemscope="" itemtype="http://schema.org/Article" class="post-block" lang="en"><link itemprop="mainEntityOfPage" href="https://yousazoe.top/archives/6487e0f7.html"><span hidden="" itemprop="author" itemscope="" itemtype="http://schema.org/Person"><meta itemprop="image" content="https://img.yousazoe.top/uPic/img/blog/icon/icon.jpeg"><meta itemprop="name" content="Yousazoe"><meta itemprop="description" content="done is better than perfect"></span><span hidden="" itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization"><meta itemprop="name" content="Fl0w3r"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">2D游戏开发</h1><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i> </span><span class="post-meta-item-text">Posted on</span> <time title="Created: 2020-11-16 23:20:35" itemprop="dateCreated datePublished" datetime="2020-11-16T23:20:35+08:00">2020-11-16</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-folder"></i> </span><span class="post-meta-item-text">In</span> <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91-Game-Development/" itemprop="url" rel="index"><span itemprop="name">游戏开发 (Game Development)</span></a> </span></span><span class="post-meta-item" title="Views" id="busuanzi_container_page_pv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-eye"></i> </span><span class="post-meta-item-text">Views: </span><span id="busuanzi_value_page_pv"></span></span><br><span class="post-meta-item" title="Symbols count in article"><span class="post-meta-item-icon"><i class="fas fa-pen"></i></span><span>5.4k</span> </span><span class="post-meta-item" title="Reading time"><span class="post-meta-item-icon"><i class="far fa-clock"></i> </span><span>10 mins.</span></span></div></header><div class="post-body" itemprop="articleBody"><p><img data-src="https://img.yousazoe.top/uPic/img/blog/icon/mona-loading-default.gif" data-original="https://cdn.jsdelivr.net/gh/Yousazoe/picgo-repo/img/0081Kckwgy1gkrfcylq45j312w0gak12.jpg"></p><div align="center"><font size="3"><i><a target="_blank" rel="noopener" href="https://www.behance.net/gallery/66966371/PromaxGames-Sponsor-Titles">PromaxGames Sponsor Titles</a> by <a target="_blank" rel="noopener" href="https://www.behance.net/BlakeFawley">Blake Fawley</a></i></font></div><h3 id="引言"><a href="#引言" class="headerlink" title="引言"></a>引言</h3><p>一说到游戏，很多人脑海里浮现的可能是家用游戏机的绚丽画面。不过遗憾的是，我们暂时还不能开发那样的游戏。我们将开发一个通过命令行运行的简单游戏，学习C++的基本用法。</p><span id="more"></span><h3 id="开发一个益智游戏"><a href="#开发一个益智游戏" class="headerlink" title="开发一个益智游戏"></a>开发一个益智游戏</h3><p>作为第一个游戏，我们决定去开发那个非常有名的“推箱子”的游戏。准备好场景数据后就可以进行单人游戏，游戏中也没有什么复杂的动作，因此无须设计太多东西能够完成。从结果来看，只需200行的代码就可以实现。</p><h4 id="需求分析"><a href="#需求分析" class="headerlink" title="需求分析"></a>需求分析</h4><p>玩家用键盘操作，这里只支持移动操作。<code>p</code>代表玩家角色。上下左右移动分别通过<code>w</code>、<code>a</code>、<code>s</code>、<code>d</code>控制，并且需要按下回车键<code>Enter</code>。例如，依次按下<code>a</code>和<code>Enter</code>后，玩家将向左移动。</p><p>除了<code>p</code>外，<code>#</code>代表墙壁，<code>o</code>代表尚未到达目的地的箱子，<code>.</code>代表目的地。为了便于识别，玩家到达<code>.</code>处时将变成<code>P</code>，箱子将变成<code>O</code>。等所有箱子都被推到<code>.</code>并变成<code>O</code>时，就表示游戏成功了。游戏中的箱子只能一个一个地推，不能拉。以上就是游戏的大概玩法。</p><h4 id="键盘和画面输出"><a href="#键盘和画面输出" class="headerlink" title="键盘和画面输出"></a>键盘和画面输出</h4><p>画面的输入输出都是通过C++标准库<code>iostram</code>实现的。输入处理主要使用<code>istream</code>（<em>input stream</em>），输出处理则依赖<code>ostream</code>（<em>output stream</em>）</p><figure class="highlight c++"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>{</span><br><span class="line">  <span class="type">char</span> c;</span><br><span class="line">  cin &gt;&gt; c;</span><br><span class="line">  cout &lt;&lt; <span class="string">"Input Character is "</span> &lt;&lt; c &lt;&lt; endl;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p><code>cin</code>和<code>cout</code>分别是<code>istream</code>类型和<code>ostream</code>类型的全局变量 <code>A</code>（全局变量指的是不属于任何类的变量。在C#和 Java 中没有这个概念，它们使用类中的<code>static</code>且<code>public</code>的变量来替代。），包含<code>iostream</code>头文件并声明<code>using namespace std</code>后，就可以在任意位置使用。<br><code>cin</code>通过<code>&gt;&gt;</code>将输入值写入变量，<code>cout</code>通过<code>&lt;&lt;</code>将变量值输出。<code>endl</code>是“end line”的缩写，也就是换行，程序执行到该处将会输出一行字符到画面上。上面虽然只是一个在键盘上输入字符并通过回车键显示字符的简单程序，但这就是该游戏输入输出处理的全部内容。</p><h4 id="主循环"><a href="#主循环" class="headerlink" title="主循环"></a>主循环</h4><p>所谓游戏程序，无非就是获取输入、将输入反映到游戏世界中、显示结果这三项处理的无限循环，这个过程称为游戏循环或者主循环，代码如下所示：</p><figure class="highlight c++"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">while</span> (<span class="literal">true</span>){</span><br><span class="line">  <span class="built_in">getInput</span>();</span><br><span class="line">  <span class="built_in">updateGame</span>();</span><br><span class="line">  <span class="built_in">draw</span>();</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>代码十分简单，但据笔者所知，所有的游戏程序无一例外地都采用了这种结构。可能根据游戏的不同，在<code>getInput()</code>中会有<code>cin</code>或手柄输入的不同，或者在<code>draw()</code>中会有<code>cout</code>或 3D 图形输出的不同，但是最基本的结构都是一致的。前面的例子中只执行了一次主循环，这是因为该游戏采用了命令行执行的方式。至于如何去掉这种限制，我们将在后续章节中讨论。</p><h4 id="编写逻辑处理"><a href="#编写逻辑处理" class="headerlink" title="编写逻辑处理"></a>编写逻辑处理</h4><p>接下来开始各个模块的开发。建议读者动起手来，首先试着创建出前面截图中出现的游戏场景。<br>为方便描述，我们将像下面这样使用文本来表示游戏场景：</p><figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">########</span><br><span class="line"># .. p #</span><br><span class="line"># oo # #</span><br><span class="line">#      #</span><br><span class="line">#      #</span><br><span class="line">########</span><br></pre></td></tr></tbody></table></figure><h4 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h4><p>代码编写完后必须进行测试，这里我们按照下列四个要点进行：</p><ul><li><p>移动墙壁所在的格子会如何</p></li><li><p>移动已经到达目的地的箱子会如何</p></li><li><p>推动两个以上的箱子会如何</p></li><li><p>朝着墙壁推动箱子会如何</p></li></ul><p>测试中是不是发现了很多问题？可能要么墙壁排乱了，要么推动位于目的地的箱子时目标地点不见了，要么箱子被挤到墙壁中了……如果一开始就能正确运行，那固然值得高兴，但从长远来看，现在经历一些挫折或许会更有利。</p><h3 id="示例代码讲解"><a href="#示例代码讲解" class="headerlink" title="示例代码讲解"></a>示例代码讲解</h3><h4 id="场景数据常量"><a href="#场景数据常量" class="headerlink" title="场景数据常量"></a>场景数据常量</h4><p>刚开始我们使用全局变量来存储场景数据：</p><figure class="highlight c++"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">//“#”代表墙壁、“_”代表空间、“.”代表目的地、“o”代表箱子、“p”代表玩家</span></span><br><span class="line"><span class="type">const</span> <span class="type">char</span> gStageData[] = <span class="string">"\</span></span><br><span class="line"><span class="string">########\n\</span></span><br><span class="line"><span class="string"># .. p #\n\</span></span><br><span class="line"><span class="string"># oo   #\n\</span></span><br><span class="line"><span class="string">#      #\n\</span></span><br><span class="line"><span class="string">#\n\   #\n\</span></span><br><span class="line"><span class="string">########"</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> gStageWidth = <span class="number">8</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> gStageHeight = <span class="number">5</span>;</span><br></pre></td></tr></tbody></table></figure><p>首先用一个容易理解的字符串对该变量赋值，游戏开始后再将其转化为其他形式。相比一开始就使用 <code>0</code> 代表空间、<code>1</code> 代表玩家进行赋值，这样做更加简单。但需要注意的是，在C++ 中，如果字符串常量要中途换行显示，就必须在行末加上符号<code>\</code>。<br>这里定义的常量都是全局变量，笔者习惯以<code>g</code>开头命名。因为全局变量可以在程序中的任何地方被访问，所以加上这样一个标志以示区别会很方便。此外，按笔者的命名习惯，变量名都以小写字母开头，其后的每个单词则首字母大写，比如 <code>gStageWidth</code>。另外，因为后续没有修改该值的打算，所以使用了<code>const</code>关键字，这个习惯可以避免很多bug。</p><figure class="highlight c++"><table><tbody><tr><td class="code"><pre><span class="line"><span class="type">const</span> <span class="type">int</span> gStageWidth = <span class="number">8</span>; <span class="comment">//第一次赋值 OK</span></span><br><span class="line">gStageWidth = <span class="number">4</span>; <span class="comment">//编译错误！</span></span><br></pre></td></tr></tbody></table></figure><p>因为添加了<code>const</code>，所以如果代码试图在变量定义之外的地方对其赋值，则将导致编译错误，这可以防止某些错误操作。建议读者养成这个习惯，对第一次赋值后就不会再修改的变量添加<code>const</code>关键字。</p><h4 id="枚举类型"><a href="#枚举类型" class="headerlink" title="枚举类型"></a>枚举类型</h4><p>接下来是枚举类型：</p><figure class="highlight c++"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">enum</span> <span class="title class_">Object</span>{</span><br><span class="line">  OBJ_SPACE,</span><br><span class="line">  OBJ_WALL,</span><br><span class="line">  OBJ_GOAL,</span><br><span class="line">  OBJ_BLOCK,</span><br><span class="line">  OBJ_BLOCK_ON_GOAL,</span><br><span class="line">  OBJ_MAN,</span><br><span class="line">  OBJ_MAN_ON_GOAL,</span><br><span class="line">  OBJ_UNKNOWN,</span><br><span class="line">};</span><br></pre></td></tr></tbody></table></figure><p>场景中的所有状态都被保存在容量等于“宽 × 高”的枚举类型数组中。数组元素的类型可以是<code>int</code>或者<code>char</code>，只要保证元素值不会超出该类型所能表示的范围即可。不过，这样有可能会因为疏忽而代入无意义的值。使用枚举类型则不会有这个问题，并且调试时可以看见枚举类型的名字，很方便，所以应该尽量使用枚举类型。<br>注意“位于目的地的箱子”和“不在目的地的箱子”的枚举值是不同的。其实也可以采用另一种做法，将是否是目的地的信息单独存储在另外一个数组中，或者通过位运算将两种信息保存在同一个数组里。不过为了便于理解，这里我们采用了最直接的做法。</p><h4 id="函数原型"><a href="#函数原型" class="headerlink" title="函数原型"></a>函数原型</h4><p>下面我们来看函数原型：</p><figure class="highlight c++"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">// 函数原型</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">initialize</span><span class="params">( Object* state, <span class="type">int</span> w, <span class="type">int</span> h, <span class="type">const</span> <span class="type">char</span>* stageData )</span></span>;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">draw</span><span class="params">( <span class="type">const</span> Object* state, <span class="type">int</span> w, <span class="type">int</span> h )</span></span>;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">update</span><span class="params">( Object* state, <span class="type">char</span> input, <span class="type">int</span> w, <span class="type">int</span> h )</span></span>;</span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">checkClear</span><span class="params">( <span class="type">const</span> Object* state, <span class="type">int</span> w, <span class="type">int</span> h )</span></span>;</span><br></pre></td></tr></tbody></table></figure><p>上述代码声明了几个函数：读取场景数据字符串并将其转换Object数组的 <code>initialize()</code>、画面绘制函数 <code>draw()</code>、更新函数 <code>update()</code>、检测游戏是否通关的 <code>checkClear()</code>。至于前面讨论主循环时出现的 <code>getInput()</code>函数，因为此处我们直接在 <code>main()</code> 函数中添加了输入处理的代码，所以用不上。注意开发时应当尽可能地将各个功能封装成函数。</p><h4 id="main函数"><a href="#main函数" class="headerlink" title="main函数"></a>main函数</h4><p>现在来看程序的入口<code>main</code>函数。首先创建一个大小等于“宽 × 高”的Object数组，并调用初始化函数 <code>initialize()</code>，使游戏处于就绪状态。</p><figure class="highlight c++"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>{</span><br><span class="line">  <span class="comment">// 创建状态数组</span></span><br><span class="line">  Object* state = <span class="keyword">new</span> Object[ gStageWidth * gStageHeight ];</span><br><span class="line">  <span class="comment">// 初始化场景</span></span><br><span class="line">  <span class="built_in">initialize</span>( state, gStageWidth, gStageHeight, gStageData );</span><br><span class="line">  <span class="comment">// 主循环</span></span><br><span class="line">  ( 略 )</span><br><span class="line">  <span class="comment">// 胜利时的提示信息</span></span><br><span class="line">  cout &lt;&lt; <span class="string">"Congratulation's! you win."</span> &lt;&lt; endl;</span><br><span class="line">  <span class="comment">// 通关</span></span><br><span class="line">  <span class="keyword">delete</span>[] state; <span class="comment">//通过 new 创建的数组不能使用 delete，而应当使用 delete[]</span></span><br><span class="line">  state = <span class="number">0</span>; <span class="comment">//笔者的习惯</span></span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>读者可能不太熟悉这种把枚举类型当作类名处理的写法。实际上枚举类型是一种用于列举的类 型，所以可以通过 <code>new</code> 生成，也可以用作参数和返回值。记住这一点将大有裨益。虽然枚举类型内 部本质上是一个 <code>int</code>，但是如果将 Object 类型的变量赋值为 <code>5</code> 或者 <code>10</code> 等数值，则会导致编译错误， 这就保证了只能通过枚举类型来赋值。</p><p>另外请注意，虽然逻辑上 Object 应当是个二维数组，但是这里使用了一维数组的创建方式。 初学者往往习惯通过二维数组的方式进行声明，即像下面这样：</p><figure class="highlight c++"><table><tbody><tr><td class="code"><pre><span class="line">Object state[ <span class="number">5</span> ][ <span class="number">8</span> ];</span><br></pre></td></tr></tbody></table></figure><p>但遗憾的是，二维数组无法通过 new 动态创建。如果不采用 <code>new</code> 来动态创建，就必须在定义数 组时就确定好数组的尺寸，比如横 8 纵 5，但是这样做会使数组的尺寸永远固定，程序将丧失一定的 灵活性。后面我们会讨论如何将一维数组当作二维数组来使用。</p><p>主循环结束意味着顺利通关，这时会输出胜利时的提示信息，然后释放 <code>state</code> 空间并结束程 序。虽然在程序退出前不执行 <code>delete</code> 也不会有什么问题，但还是应当养成及时释放空间的习惯。 注意这里通过 <code>new</code> 创建的数组在释放时必须使用 <code>delete[]</code> 而非 <code>delete</code>。后面我们会解释这么做 的原因。</p><p>最好将 <code>delete</code> 后的指针赋值为 <code>0</code>，这样可以在很大程度上避免一些指针相关的 bug。笔者在任何时候都遵守这个习惯，哪怕在程序即将退出时，也会将无用的指针赋值为 <code>0</code>。</p><h5 id="主循环-1"><a href="#主循环-1" class="headerlink" title="主循环"></a>主循环</h5><p>相关代码大致如下所示：</p><figure class="highlight c++"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">// 主循环</span></span><br><span class="line"><span class="keyword">while</span> ( <span class="literal">true</span> ){</span><br><span class="line">  <span class="comment">// 首先绘制</span></span><br><span class="line">  <span class="built_in">draw</span>( state, gStageWidth, gStageHeight );</span><br><span class="line">  <span class="comment">// 通关检测</span></span><br><span class="line">  <span class="keyword">if</span> ( <span class="built_in">checkClear</span>( state, gStageWidth, gStageHeight ) ){</span><br><span class="line">  <span class="keyword">break</span>; <span class="comment">//通关检测 }</span></span><br><span class="line">  <span class="comment">// 获取输入</span></span><br><span class="line">  cout &lt;&lt; <span class="string">"a:left s:right w:up z:down. command?"</span> &lt;&lt; endl; <span class="comment">//操作说明 char input;</span></span><br><span class="line">  cin &gt;&gt; input;</span><br><span class="line">  <span class="comment">// 更新</span></span><br><span class="line">  <span class="built_in">update</span>( state, input, gStageWidth, gStageHeight );</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>为了将输入前的状态反映到画面上，程序一开始就执行了 <code>draw( )</code>，但游戏整体仍然按照输 入更新、绘制的顺序执行。调用 <code>draw()</code> 后立刻执行通关检测是为了应对满足通关条件时的突发情况。试想如果在某个时刻场景数据已经满足了通关条件，这时没有执行通关处理却继续响应输入，那么推动箱子后就又将变成不允许通关的状态了。正因为如此，才需要在响应输入前先判断通关条件。</p><p>输入处理只是简单地通过 <code>cin</code> 读取输入的字符，在读取之前程序会提示操作说明。输入的内容会被传递给 <code>update()</code> 以更新游戏的状态。各个游戏的主循环处理基本上都遵循这个模式。</p><h4 id="初始化场景"><a href="#初始化场景" class="headerlink" title="初始化场景"></a>初始化场景</h4><p><code>initialize()</code> 的内容如下所示：</p><figure class="highlight c++"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">initialize</span><span class="params">(Object* state,<span class="type">int</span> width,<span class="type">int</span> height,<span class="type">const</span> <span class="type">char</span>* stageData )</span></span>{</span><br><span class="line">  <span class="type">const</span> <span class="type">char</span>* d = stageData; <span class="comment">//读取指针 int x = 0;</span></span><br><span class="line">  <span class="type">int</span> y = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">while</span> ( *d != <span class="string">'\0'</span> ){ <span class="comment">//当字符不为NULL时</span></span><br><span class="line">    Object t;</span><br><span class="line">    <span class="keyword">switch</span> ( *d ){</span><br><span class="line">      <span class="keyword">case</span> <span class="string">'#'</span>: t = OBJ_WALL; <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">' '</span>: t = OBJ_SPACE; <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">'o'</span>: t = OBJ_BLOCK; <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">'O'</span>: t = OBJ_BLOCK_ON_GOAL; <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">'.'</span>: t = OBJ_GOAL; <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">'p'</span>: t = OBJ_MAN; <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">'P'</span>: t = OBJ_MAN_ON_GOAL; <span class="keyword">break</span>; </span><br><span class="line">      <span class="keyword">case</span> <span class="string">'\n'</span>: <span class="comment">//到下一行</span></span><br><span class="line">        x = <span class="number">0</span>; <span class="comment">//x返回到最左边</span></span><br><span class="line">        ++y; <span class="comment">//y 进到下一段</span></span><br><span class="line">        t = OBJ_UNKNOWN; <span class="comment">//没有数据 break;</span></span><br><span class="line">      <span class="keyword">default</span>: t = OBJ_UNKNOWN; <span class="keyword">break</span>; <span class="comment">//非法数据 }</span></span><br><span class="line">      ++d;</span><br><span class="line">      <span class="comment">// 如果遇到未知字符则无视</span></span><br><span class="line">      <span class="keyword">if</span> ( t != OBJ_UNKNOWN ){</span><br><span class="line">        state[ y*width + x ] = t; <span class="comment">//写入</span></span><br><span class="line">        ++x; }</span><br><span class="line">} }</span><br></pre></td></tr></tbody></table></figure><p>这段代码会逐个读取字符并将其转换为 Object 类型。<code>switch</code> 后的 <code>if</code> 语句是为了忽略非法输入。虽然程序考虑了数据中存在注释等无关信息的情况，但是错误处理仍不够完善。比如当场景数 据残缺不全，或者宽度、高度值和预想的不一致时，程序的行为都是未知的。最好的做法是通过场景数据自行计算出宽度和高度值，我们可以封装一个函数来实现这个功能。</p><p>另外，如前所述，<code>state</code> 变量是按照一维数组的方式创建的。</p><figure class="highlight c++"><table><tbody><tr><td class="code"><pre><span class="line">state[ y*width + x ] = t; <span class="comment">//写入</span></span><br></pre></td></tr></tbody></table></figure><p><code>y*width + x</code>表示从左上角向右 x 列，向下 y 行处的网格位置。</p><figure class="highlight c++"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">draw</span><span class="params">( <span class="type">const</span> Object* state, <span class="type">int</span> width, <span class="type">int</span> height )</span></span>{</span><br><span class="line">  <span class="comment">//Object 枚举类型的顺序</span></span><br><span class="line">  <span class="type">const</span> <span class="type">char</span> font[] = {<span class="string">' '</span>, <span class="string">'#'</span>, <span class="string">'.'</span>, <span class="string">'o'</span>, <span class="string">'O'</span>, <span class="string">'p'</span>, <span class="string">'P'</span>};</span><br><span class="line">  <span class="keyword">for</span> ( <span class="type">int</span> y = <span class="number">0</span>; y &lt; height; ++y ){</span><br><span class="line">    <span class="keyword">for</span> ( <span class="type">int</span> x=<span class="number">0</span>; x &lt; width; ++x ){</span><br><span class="line">      Object o = state[ y*width + x ];</span><br><span class="line">      cout &lt;&lt; font[ o ];</span><br><span class="line">    }</span><br><span class="line">    cout &lt;&lt; endl;</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><div align="center"><font size="3"><i>Acknowledgement<br><a target="_blank" rel="noopener" href="https://www.behance.net/BlakeFawley">Blake Fawley</a></i></font></div></div><div class="popular-posts-header">Related Posts</div><ul class="popular-posts"><li class="popular-posts-item"><div class="popular-posts-title"><a href="/archives/1e8beaae.html" rel="bookmark">Procedural Dungeon Generation Algorithm</a></div></li><li class="popular-posts-item"><div class="popular-posts-title"><a href="/archives/e094b83a.html" rel="bookmark">Fast Inverse Square Root — a Quake III Algorithm</a></div></li><li class="popular-posts-item"><div class="popular-posts-title"><a href="/archives/f1767e7a.html" rel="bookmark">精读 Effective C++</a></div></li></ul><footer class="post-footer"><div class="post-tags"><a href="/tags/Cpp/" rel="tag"># Cpp</a> <a href="/tags/Game-Develop/" rel="tag"># Game Develop</a> <a href="/tags/SEGA/" rel="tag"># SEGA</a></div><div class="post-nav"><div class="post-nav-item"><a href="/archives/9c0e841f.html" rel="prev" title="Pico-8 精彩代码--植物生长效果解析"><i class="fa fa-chevron-left"></i> Pico-8 精彩代码--植物生长效果解析</a></div><div class="post-nav-item"><a href="/archives/25e9a91.html" rel="next" title="开始画像素画#6">开始画像素画#6 <i class="fa fa-chevron-right"></i></a></div></div></footer></article></div><script>window.addEventListener("tabs:register",()=>{let{activeClass:e}=CONFIG.comments;if(CONFIG.comments.storage&&(e=localStorage.getItem("comments_active")||e),e){let t=document.querySelector(`a[href="#comment-${e}"]`);t&&t.click()}}),CONFIG.comments.storage&&window.addEventListener("tabs:click",t=>{t.target.matches(".tabs-comment .tab-content .tab-pane")&&(t=t.target.classList[1],localStorage.setItem("comments_active",t))})</script></div><div class="toggle sidebar-toggle"><span class="toggle-line toggle-line-first"></span> <span class="toggle-line toggle-line-middle"></span> <span class="toggle-line toggle-line-last"></span></div><aside class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc">Table of Contents</li><li class="sidebar-nav-overview">Overview</li></ul><div class="post-toc-wrap sidebar-panel"><div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BC%95%E8%A8%80"><span class="nav-number">1.</span> <span class="nav-text">引言</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BC%80%E5%8F%91%E4%B8%80%E4%B8%AA%E7%9B%8A%E6%99%BA%E6%B8%B8%E6%88%8F"><span class="nav-number">2.</span> <span class="nav-text">开发一个益智游戏</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90"><span class="nav-number">2.1.</span> <span class="nav-text">需求分析</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%94%AE%E7%9B%98%E5%92%8C%E7%94%BB%E9%9D%A2%E8%BE%93%E5%87%BA"><span class="nav-number">2.2.</span> <span class="nav-text">键盘和画面输出</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%B8%BB%E5%BE%AA%E7%8E%AF"><span class="nav-number">2.3.</span> <span class="nav-text">主循环</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%BC%96%E5%86%99%E9%80%BB%E8%BE%91%E5%A4%84%E7%90%86"><span class="nav-number">2.4.</span> <span class="nav-text">编写逻辑处理</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%B5%8B%E8%AF%95"><span class="nav-number">2.5.</span> <span class="nav-text">测试</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%A4%BA%E4%BE%8B%E4%BB%A3%E7%A0%81%E8%AE%B2%E8%A7%A3"><span class="nav-number">3.</span> <span class="nav-text">示例代码讲解</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%9C%BA%E6%99%AF%E6%95%B0%E6%8D%AE%E5%B8%B8%E9%87%8F"><span class="nav-number">3.1.</span> <span class="nav-text">场景数据常量</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%9E%9A%E4%B8%BE%E7%B1%BB%E5%9E%8B"><span class="nav-number">3.2.</span> <span class="nav-text">枚举类型</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%87%BD%E6%95%B0%E5%8E%9F%E5%9E%8B"><span class="nav-number">3.3.</span> <span class="nav-text">函数原型</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#main%E5%87%BD%E6%95%B0"><span class="nav-number">3.4.</span> <span class="nav-text">main函数</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E4%B8%BB%E5%BE%AA%E7%8E%AF-1"><span class="nav-number">3.4.1.</span> <span class="nav-text">主循环</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%88%9D%E5%A7%8B%E5%8C%96%E5%9C%BA%E6%99%AF"><span class="nav-number">3.5.</span> <span class="nav-text">初始化场景</span></a></li></ol></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person"><img class="site-author-image" itemprop="image" alt="Yousazoe" src="https://img.yousazoe.top/uPic/img/blog/icon/icon.jpeg"><p class="site-author-name" itemprop="name">Yousazoe</p><div class="site-description" itemprop="description">done is better than perfect</div></div><div class="site-state-wrap motion-element"><nav class="site-state"><div class="site-state-item site-state-posts"><a href="/archives/"><span class="site-state-item-count">305</span> <span class="site-state-item-name">posts</span></a></div><div class="site-state-item site-state-categories"><a href="/categories/"><span class="site-state-item-count">49</span> <span class="site-state-item-name">categories</span></a></div><div class="site-state-item site-state-tags"><a href="/tags/"><span class="site-state-item-count">75</span> <span class="site-state-item-name">tags</span></a></div></nav></div><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="mailto:zoeyousa@gmail.com" title="E-Mail → mailto:zoeyousa@gmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i></a> </span><span class="links-of-author-item"><a href="https://github.com/Yousazoe" title="GitHub → https://github.com/Yousazoe" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i></a> </span><span class="links-of-author-item"><a href="https://twitter.com/YousaZoe" title="Twitter → https://twitter.com/YousaZoe" rel="noopener" target="_blank"><i class="fab fa-twitter fa-fw"></i></a> </span><span class="links-of-author-item"><a href="https://steamcommunity.com/profiles/76561198856466228/" title="Steam → https://steamcommunity.com/profiles/76561198856466228/" rel="noopener" target="_blank"><i class="fab fa-steam fa-fw"></i></a> </span><span class="links-of-author-item"><a href="https://www.chess.com/member/yousazoe" title="Chess → https://www.chess.com/member/yousazoe" rel="noopener" target="_blank"><i class="fa fa-chess-pawn fa-fw"></i></a> </span><span class="links-of-author-item"><a href="https://space.bilibili.com/399504060" title="Bilibili → https://space.bilibili.com/399504060" rel="noopener" target="_blank"><i class="fa fa-th-large fa-fw"></i></a> </span><span class="links-of-author-item"><a href="/atom.xml" title="RSS → /atom.xml"><i class="fa fa-rss fa-fw"></i></a></span></div><div class="cc-license motion-element" itemprop="license"><a href="https://creativecommons.org/licenses/by-nc-sa/4.0/zh-CN" class="cc-opacity" rel="noopener" target="_blank"><img src="https://img.yousazoe.top/uPic/img/blog/icon/mona-loading-default.gif" data-original="/images/cc-by-nc-sa.svg" alt="Creative Commons"></a></div></div><div class="twopeople"><div class="container" style="height:200px"><canvas class="illo" width="800" height="800" style="max-width:200px;max-height:200px;touch-action:none;width:640px;height:640px"></canvas></div><script src="https://img.yousazoe.top/js/twopeople1.js"></script><script src="https://img.yousazoe.top/js/zdog.dist.js"></script><script id="rendered-js" src="https://img.yousazoe.top/js/twopeople.js"></script><style>.twopeople{margin:0;align-items:center;justify-content:center;text-align:center}canvas{display:block;margin:0 auto;cursor:move}</style></div><div class="cc-license animated" itemprop="sponsor"><link rel="preconnect" href="https://www.netlify.com"><span class="exturl cc-opacity" title="Deploy with Netlify → https://www.netlify.com" data-url="aHR0cHM6Ly93d3cubmV0bGlmeS5jb20="><img width="80" src="https://img.yousazoe.top/uPic/img/blog/icon/mona-loading-default.gif" data-original="https://www.netlify.com/img/global/badges/netlify-dark.svg" alt="Netlify"></span></div><div class="back-to-top motion-element"><i class="fa fa-arrow-up"></i> <span>0%</span></div></div></aside><div id="sidebar-dimmer"></div></div></main><footer class="footer"><div class="footer-inner"><div class="translate-style">繁/简：<a id="translateLink" href="javascript:translatePage();">繁体</a></div><script type="text/javascript" src="/js/tw_cn.js"></script><script type="text/javascript">var defaultEncoding=2,translateDelay=0,cookieDomain="https://tding.top/",msgToTraditionalChinese="繁体",msgToSimplifiedChinese="简体",translateButtonId="translateLink";translateInitilization()</script><div class="beian"><a href="https://beian.miit.gov.cn/" rel="noopener" target="_blank">晋ICP备2021009930号 </a><img src="https://img.yousazoe.top/uPic/img/blog/icon/mona-loading-default.gif" data-original="https://img.yousazoe.top/uPic/img/blog/icon/beian.png" style="display:inline-block"></div><div class="copyright">© 2020 – <span itemprop="copyrightYear">2023</span> <span class="with-love"><i class="fa fa-heart"></i> </span><span class="author" itemprop="copyrightHolder">Yousazoe</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-chart-area"></i> </span><span title="Symbols count total">4.6m</span></div><div class="powered-by"><span><a target="_blank" rel="noopener" href="https://www.upyun.com/?utm_source=lianmeng&amp;utm_medium=referral"><img src="https://img.yousazoe.top/uPic/img/blog/icon/mona-loading-default.gif" data-original="https://cdn.jsdelivr.net/gh/YukiNoUta/cdn-static@main/blog/svg/upyun.svg" width="53" height="18" style="fill:currentColor;display:inline-block"></a></span><span class="post-meta-divider">|</span>今早雾霾蔽日，但是不要害怕，太阳依旧在云端</div><div class="busuanzi-count"><script data-pjax="" async="" src="js/busuanzi.pure.mini.js"></script><span class="post-meta-item" id="busuanzi_container_site_uv" style="display:inline"><span class="post-meta-item-icon"><i class="fa fa-user"></i> </span><span class="site-uv" title="Total Visitors"><span id="busuanzi_value_site_uv"></span> </span></span><span class="post-meta-divider">|</span> <span class="post-meta-item" id="busuanzi_container_site_pv" style="display:inline"><span class="post-meta-item-icon"><i class="fa fa-eye"></i> </span><span class="site-pv" title="Total Views"><span id="busuanzi_value_site_pv"></span></span></span></div></div></footer></div><script src="//unpkg.com/animejs@3.1.0/lib/anime.min.js"></script><script src="//npm.elemecdn.com/pjax/pjax.min.js"></script><script src="//lib.baomitu.com/jquery/3.6.0/jquery.min.js"></script><script src="//lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js"></script><script src="//unpkg.com/lozad@1.16.0/dist/lozad.min.js"></script><script src="//lib.baomitu.com/pangu/4.0.7/pangu.min.js"></script><script src="/lib/velocity/velocity.min.js"></script><script src="/lib/velocity/velocity.ui.min.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/pisces.js"></script><script src="/js/next-boot.js"></script><script>var pjax = new Pjax({
  selectors: [
    'head title',
    '#page-configurations',
    '.content-wrap',
    '.post-toc-wrap',
    '.languages',
    '#pjax'
  ],
  switches: {
    '.post-toc-wrap': Pjax.switches.innerHTML
  },
  analytics: false,
  cacheBust: false,
  scrollTo : !CONFIG.bookmark.enable
});

window.addEventListener('pjax:success', () => {
    $(document).ready(function () {

    if(location.href.indexOf("#reloaded")==-1){
        location.href=location.href+"#reloaded";
        location.reload();
    }
}）
#在这后面可以加入程序的其他代码  


  document.querySelectorAll('script[data-pjax], script#page-configurations, #pjax script').forEach(element => {
    var code = element.text || element.textContent || element.innerHTML || '';
    var parent = element.parentNode;
    parent.removeChild(element);
    var script = document.createElement('script');
    if (element.id) {
      script.id = element.id;
    }
    if (element.className) {
      script.className = element.className;
    }
    if (element.type) {
      script.type = element.type;
    }
    if (element.src) {
      script.src = element.src;
      // Force synchronous loading of peripheral JS.
      script.async = false;
    }
    if (element.dataset.pjax !== undefined) {
      script.dataset.pjax = '';
    }
    if (code !== '') {
      script.appendChild(document.createTextNode(code));
    }
    parent.appendChild(script);
  });

  
  NexT.boot.refresh();
  
  // Define Motion Sequence & Bootstrap Motion.
  if (CONFIG.motion.enable) {
    NexT.motion.integrator
      .init()
      .add(NexT.motion.middleWares.subMenu)
      .add(NexT.motion.middleWares.postList)
      .bootstrap();
  }
  
  NexT.utils.updateSidebarPosition();
});</script><script defer="" src="//img.yousazoe.top/js/three.min.js"></script><script defer="" src="//img.yousazoe.top/js/caidai.js"></script><script data-pjax="">!function(){var e,t,o,n,r=document.getElementsByTagName("link");if(0<r.length)for(i=0;i<r.length;i++)"canonical"==r[i].rel.toLowerCase()&&r[i].href&&(e=r[i].href);t=(e||window.location.protocol).split(":")[0],e=e||window.location.href,window,o=e,n=document.referrer,/([http|https]:\/\/[a-zA-Z0-9\_\.]+\.baidu\.com)/gi.test(o)||(t="https"===String(t).toLowerCase()?"https://sp0.baidu.com/9_Q4simg2RQJ8t7jm9iCKT-xh_/s.gif":"//api.share.baidu.com/s.gif",n?(t+="?r="+encodeURIComponent(document.referrer),o&&(t+="&l="+o)):o&&(t+="?l="+o),(new Image).src=t)}()</script><script src="/js/local-search.js"></script><script data-pjax="">document.querySelectorAll(".pdfobject-container").forEach(e=>{var t=e.dataset.target,a="#"+Object.entries({navpanes:0,toolbar:0,statusbar:0,pagemode:"thumbs",view:"FitH"}).map(([e,t])=>`${e}=${encodeURIComponent(t)}`).join("&"),r=`/lib/pdf/web/viewer.html?file=${encodeURIComponent(t)}${a}`;NexT.utils.supportsPDFs()?e.innerHTML=`<embed class="pdfobject" src="${t+a}" type="application/pdf" style="height: ${e.dataset.height};">`:e.innerHTML=`<iframe src="${r}" style="height: ${e.dataset.height};" frameborder="0"></iframe>`})</script><script data-pjax="">document.querySelectorAll("pre.mermaid").length&&NexT.utils.getScript("//lib.baomitu.com/mermaid/8.4.8/mermaid.min.js",()=>{mermaid.initialize({theme:"forest",logLevel:3,flowchart:{curve:"linear"},gantt:{axisFormat:"%m/%d/%Y"},sequence:{actorMargin:50}})},window.mermaid)</script><div id="pjax"></div><script type="text/javascript" src="/js/cursor/fireworks.js"></script><script src="https://img.yousazoe.top/live2dw/lib/L2Dwidget.min.js"></script><script>L2Dwidget.init({pluginRootPath:"live2dw/",pluginJsPath:"lib/",pluginModelPath:"assets/",tagMode:!1,debug:!1,model:{jsonPath:"/live2dw/assets/assets/hijiki.model.json"},display:{position:"right",width:100,height:200},mobile:{show:!0},log:!1})</script><script>window.imageLazyLoadSetting={isSPA:!1,preloadRatio:5,processImages:null}</script><script>window.addEventListener("load",function(){var t=/\.(gif|jpg|jpeg|tiff|png)$/i,r=/^data:image\/[a-z]+;base64,/;Array.prototype.slice.call(document.querySelectorAll("img[data-original]")).forEach(function(a){var e=a.parentNode;"A"===e.tagName&&(e.href.match(t)||e.href.match(r))&&(e.href=a.dataset.original)})})</script><script>!function(n){n.imageLazyLoadSetting.processImages=o;var e=n.imageLazyLoadSetting.isSPA,i=n.imageLazyLoadSetting.preloadRatio||1,r=Array.prototype.slice.call(document.querySelectorAll("img[data-original]"));function o(){e&&(r=Array.prototype.slice.call(document.querySelectorAll("img[data-original]")));for(var t,a=0;a<r.length;a++)0<=(t=(t=r[a]).getBoundingClientRect()).bottom&&0<=t.left&&t.top<=(n.innerHeight*i||document.documentElement.clientHeight*i)&&function(){var e=r[a],t=e,n=function(){r=r.filter(function(t){return e!==t})},i=new Image,o=t.getAttribute("data-original");i.onload=function(){t.src=o,n()},t.src!==o&&(i.src=o)}()}o(),n.addEventListener("scroll",function(){var t=o,e=n;clearTimeout(t.tId),t.tId=setTimeout(function(){t.call(e)},500)})}(this)</script><script type="text/javascript" charset="utf-8" src="/js/lazyload-plugin/lazyload.intersectionObserver.min.js"></script></body></html>