<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 6.2.0"><link rel="apple-touch-icon" sizes="180x180" href="/images/favicon.ico"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.ico"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.ico"><link rel="mask-icon" href="/images/favicon.ico" color="#222"><meta name="google-site-verification" content="35AYyqm-wpmGmXtkn-vQMrk7AkFl1Do55uHdlLLLT38"><meta name="baidu-site-verification" content="slBbq5f8WxljPytW"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="//fonts.proxy.ustclug.org/css?family=Lato:300,300italic,400,400italic,700,700italic&amp;display=swap&amp;subset=latin,latin-ext"><link rel="stylesheet" href="//lf9-cdn-tos.bytecdntp.com/cdn/expire-1-M/font-awesome/5.15.4/css/all.min.css"><link rel="stylesheet" href="//lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css"><link rel="stylesheet" href="//unpkg.com/pace-js@1/themes/blue/pace-theme-minimal.css"><script src="//unpkg.com/pace-js@1.2.4/pace.min.js"></script><script id="hexo-configurations">var NexT=window.NexT||{},CONFIG={hostname:"yousazoe.top",root:"/",scheme:"Gemini",version:"7.8.0",exturl:!1,sidebar:{position:"left",display:"post",padding:18,offset:12,onmobile:!1},copycode:{enable:!0,show_result:!0,style:"mac"},back2top:{enable:!0,sidebar:!0,scrollpercent:!0},bookmark:{enable:!1,color:"#222",save:"auto"},fancybox:!0,mediumzoom:!1,lazyload:!0,pangu:!0,comments:{style:"tabs",active:null,storage:!0,lazyload:!0,nav:null},algolia:{hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}},localsearch:{enable:!0,trigger:"auto",top_n_per_article:3,unescape:!1,preload:!1},motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}},path:"search.xml"}</script><meta name="description" content="å¼•è¨€æœ¬èŠ‚æˆ‘ä»¬å°†å‡å°‘å…‰çº¿è®¡æ•°ï¼Œå°†é˜´å½±å°„çº¿æ‹æ‘„åˆ°æ¯ä¸ªåƒç´ ä»…ä¸€ä¸ªéšæœºå…‰ã€‚"><meta property="og:type" content="article"><meta property="og:title" content="A Gentle Introduction to DirectX Raytracing 11"><meta property="og:url" content="https://yousazoe.top/archives/fb0ddd71.html"><meta property="og:site_name" content="Fl0w3r"><meta property="og:description" content="å¼•è¨€æœ¬èŠ‚æˆ‘ä»¬å°†å‡å°‘å…‰çº¿è®¡æ•°ï¼Œå°†é˜´å½±å°„çº¿æ‹æ‘„åˆ°æ¯ä¸ªåƒç´ ä»…ä¸€ä¸ªéšæœºå…‰ã€‚"><meta property="og:locale" content="en_US"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/Yousazoe/picgo-repo/img/Tutor11-Output.png"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/Yousazoe/picgo-repo/img/Tutor11-Output-20220126150245601.png"><meta property="article:published_time" content="2022-01-26T07:00:34.000Z"><meta property="article:modified_time" content="2024-09-26T08:07:01.384Z"><meta property="article:author" content="Yousazoe"><meta property="article:tag" content="Computer Graphics"><meta property="article:tag" content="Ray Tracing"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/Yousazoe/picgo-repo/img/Tutor11-Output.png"><link rel="canonical" href="https://yousazoe.top/archives/fb0ddd71.html"><script id="page-configurations">CONFIG.page={sidebar:"",isHome:!1,isPost:!0,lang:"en"}</script><title>A Gentle Introduction to DirectX Raytracing 11 | Fl0w3r</title><noscript><style>.sidebar-inner,.use-motion .brand,.use-motion .collection-header,.use-motion .comments,.use-motion .menu-item,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header{opacity:initial}.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.use-motion .logo-line-before i{left:initial}.use-motion .logo-line-after i{right:initial}</style></noscript><link rel="alternate" href="/atom.xml" title="Fl0w3r" type="application/atom+xml"></head><body itemscope="" itemtype="http://schema.org/WebPage"><div class="container use-motion"><div class="headband"></div><header class="header" itemscope="" itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-container"><div class="site-nav-toggle"><div class="toggle" aria-label="Toggle navigation bar"><span class="toggle-line toggle-line-first"></span> <span class="toggle-line toggle-line-middle"></span> <span class="toggle-line toggle-line-last"></span></div></div><div class="site-meta"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span><h1 class="site-title">Fl0w3r</h1><span class="logo-line-after"><i></i></span></a><p class="site-subtitle" itemprop="description">carpe diem</p></div><div class="site-nav-right"><div class="toggle popup-trigger"><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class="site-nav"><ul id="menu" class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-address-card fa-fw"></i>About</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a></li><li class="menu-item menu-item-links"><a href="/links/" rel="section"><i class="fa fa-paperclip fa-fw"></i>Links</a></li><li class="menu-item menu-item-photos"><a href="/photos/" rel="section"><i class="fa fa-camera fa-fw"></i>Photos</a></li><li class="menu-item menu-item-artitalk"><a href="/artitalk/" rel="section"><i class="fa fa-calendar fa-fw"></i>Artitalk</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a></li><li class="menu-item menu-item-document"><a href="/docs/" rel="section"><i class="fas fa-book fa-fw"></i>Document</a></li><li class="menu-item menu-item-qexoadmin"><a href="https://blog-yousazoe-qexo.vercel.app/" rel="noopener" target="_blank"><i class="fa fa-database fa-fw"></i>QexoAdmin</a></li><li class="menu-item menu-item-gametracker"><a href="https://yousazoe.notion.site/yousazoe/b05999823bd14b57a7a6cd81fba1a1af?v=21c3398e0bdb429c9b8157b7bf12ff6a" rel="noopener" target="_blank"><i class="fas fa-trophy fa-fw"></i>GameTracker</a></li><li class="menu-item menu-item-sitemap"><a href="/sitemap.xml" rel="section"><i class="fa fa-sitemap fa-fw"></i>Sitemap</a></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search</a></li></ul></nav><div class="search-pop-overlay"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"><input autocomplete="off" autocapitalize="off" placeholder="Searching..." spellcheck="false" type="search" class="search-input"></div><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span></div><div id="search-result"><div id="no-result"><i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i></div></div></div></div></div></header><div class="reading-progress-bar"></div><main class="main"><div class="main-inner"><div class="content-wrap"><div class="content post posts-expand"><article itemscope="" itemtype="http://schema.org/Article" class="post-block" lang="en"><link itemprop="mainEntityOfPage" href="https://yousazoe.top/archives/fb0ddd71.html"><span hidden="" itemprop="author" itemscope="" itemtype="http://schema.org/Person"><meta itemprop="image" content="https://img.yousazoe.top/uPic/img/blog/icon/icon.jpeg"><meta itemprop="name" content="Yousazoe"><meta itemprop="description" content="done is better than perfect"></span><span hidden="" itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization"><meta itemprop="name" content="Fl0w3r"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">A Gentle Introduction to DirectX Raytracing 11</h1><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i> </span><span class="post-meta-item-text">Posted on</span> <time title="Created: 2022-01-26 15:00:34" itemprop="dateCreated datePublished" datetime="2022-01-26T15:00:34+08:00">2022-01-26</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-folder"></i> </span><span class="post-meta-item-text">In</span> <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/%E5%85%89%E7%BA%BF%E8%BF%BD%E8%B8%AA-Ray-Tracing/" itemprop="url" rel="index"><span itemprop="name">å…‰çº¿è¿½è¸ª (Ray Tracing)</span></a> </span></span><span class="post-meta-item" title="Views" id="busuanzi_container_page_pv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-eye"></i> </span><span class="post-meta-item-text">Views: </span><span id="busuanzi_value_page_pv"></span></span><br><span class="post-meta-item" title="Symbols count in article"><span class="post-meta-item-icon"><i class="fas fa-pen"></i></span><span>4.4k</span> </span><span class="post-meta-item" title="Reading time"><span class="post-meta-item-icon"><i class="far fa-clock"></i> </span><span>8 mins.</span></span></div></header><div class="post-body" itemprop="articleBody"><style>.darkmode--activated{--body-bg-color:#282828;--content-bg-color:#333;--card-bg-color:#555;--text-color:#ccc;--blockquote-color:#bbb;--link-color:#ccc;--link-hover-color:#eee;--brand-color:#ddd;--brand-hover-color:#ddd;--table-row-odd-bg-color:#282828;--table-row-hover-bg-color:#363636;--menu-item-bg-color:#555;--btn-default-bg:#222;--btn-default-color:#ccc;--btn-default-border-color:#555;--btn-default-hover-bg:#666;--btn-default-hover-color:#ccc;--btn-default-hover-border-color:#666;--highlight-background:#282b2e;--highlight-foreground:#a9b7c6;--highlight-gutter-background:#34393d;--highlight-gutter-foreground:#9ca9b6}.darkmode--activated img{opacity:.75}.darkmode--activated img:hover{opacity:.9}.darkmode--activated code{color:#69dbdc;background:0 0}button.darkmode-toggle{z-index:9999}.darkmode-ignore,img{display:flex!important}.beian img{display:inline-block!important}</style><p><img data-src="https://img.yousazoe.top/uPic/img/blog/icon/mona-loading-default.gif" data-original="https://cdn.jsdelivr.net/gh/Yousazoe/picgo-repo/img/Tutor11-Output.png"></p><h3 id="å¼•è¨€"><a href="#å¼•è¨€" class="headerlink" title="å¼•è¨€"></a>å¼•è¨€</h3><p>æœ¬èŠ‚æˆ‘ä»¬å°†å‡å°‘å…‰çº¿è®¡æ•°ï¼Œå°†é˜´å½±å°„çº¿æ‹æ‘„åˆ°æ¯ä¸ªåƒç´ ä»…ä¸€ä¸ªéšæœºå…‰ã€‚</p><span id="more"></span><blockquote><p>In <a target="_blank" rel="noopener" href="http://cwyman.org/code/dxrTutors/tutors/Tutor9/tutorial09.md.html">Tutorial 9</a>, we added a Lambertian shading model that traced a shadow ray to every light. While accurate, there are many reasons tracing shadows rays for each light maybe a poor choice. A key consideration is costs increase linearly with additional lights in the scene.</p></blockquote><p>åœ¨<a target="_blank" rel="noopener" href="http://cwyman.org/code/dxrTutors/tutors/Tutor9/tutorial09.md.html">æ•™ç¨‹ 9</a>ä¸­ï¼Œæˆ‘ä»¬æ·»åŠ äº†ä¸€ä¸ª Lambertian ç€è‰²æ¨¡å‹ï¼Œè¯¥æ¨¡å‹å°†é˜´å½±å…‰çº¿è¿½è¸ªåˆ°æ¯ä¸ªç¯å…‰ã€‚è™½ç„¶å‡†ç¡®ï¼Œä½†æœ‰å¾ˆå¤šåŸå› ä¸ºæ¯ä¸ªç¯å…‰è·Ÿè¸ªé˜´å½±å…‰çº¿å¯èƒ½æ˜¯ä¸€ä¸ªç³Ÿç³•çš„é€‰æ‹©ã€‚ä¸€ä¸ªå…³é”®çš„è€ƒè™‘å› ç´ æ˜¯æˆæœ¬ä¼šéšç€åœºæ™¯ä¸­çš„é¢å¤–ç¯å…‰è€Œçº¿æ€§å¢åŠ ã€‚</p><blockquote><p>In this tutorial, we will randomly select <strong>just one</strong> light to test for each pixel. This is a common strategy when path tracing with explicit direct lighting, but more importantly introduces the idea of <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Monte_Carlo_integration">Monte Carlo integration</a> on a very simple quantity (the Lambertian term with direct illumination).</p></blockquote><p>åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæˆ‘ä»¬å°†éšæœºé€‰æ‹©<strong>ä¸€ä¸ª</strong>ç¯å…‰æ¥æµ‹è¯•æ¯ä¸ªåƒç´ ã€‚è¿™æ˜¯ä½¿ç”¨æ˜¾å¼ç›´æ¥ç…§æ˜è¿›è¡Œè·¯å¾„è·Ÿè¸ªæ—¶çš„å¸¸ç”¨ç­–ç•¥ï¼Œä½†æ›´é‡è¦çš„æ˜¯åœ¨ä¸€ä¸ªéå¸¸ç®€å•çš„é‡ï¼ˆå…·æœ‰ç›´æ¥ç…§æ˜çš„ Lambertian é¡¹ï¼‰ä¸Š å¼•å…¥äº†<a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Monte_Carlo_integration">è’™ç‰¹å¡æ´›ç§¯åˆ†çš„æ€æƒ³ã€‚</a></p><h3 id="Changes-to-our-C-Render-Pass"><a href="#Changes-to-our-C-Render-Pass" class="headerlink" title="Changes to our C++ Render Pass"></a>Changes to our C++ Render Pass</h3><blockquote><p>There is a single difference between the C++ code for this tutorial and <a target="_blank" rel="noopener" href="http://cwyman.org/code/dxrTutors/tutors/Tutor9/tutorial09.md.html">Tutorial 9</a>. Since our shader requires a random number generator, we pass down a changing â€œframe countâ€ to allow us to reseed our pseudorandom number generator each frame.</p></blockquote><p>æœ¬æ•™ç¨‹çš„ C++ ä»£ç ä¸<a target="_blank" rel="noopener" href="http://cwyman.org/code/dxrTutors/tutors/Tutor9/tutorial09.md.html">æ•™ç¨‹ 9</a> ä¹‹é—´åªæœ‰ä¸€ä¸ªåŒºåˆ«ã€‚ç”±äºæˆ‘ä»¬çš„ç€è‰²å™¨éœ€è¦ä¸€ä¸ªéšæœºæ•°ç”Ÿæˆå™¨ï¼Œæˆ‘ä»¬ä¼ é€’ä¸€ä¸ªä¸æ–­å˜åŒ–çš„â€œå¸§è®¡æ•°â€ï¼Œä»¥å…è®¸æˆ‘ä»¬åœ¨æ¯ä¸€å¸§é‡æ–°æ¤å…¥æˆ‘ä»¬çš„ä¼ªéšæœºæ•°ç”Ÿæˆå™¨ã€‚</p><blockquote><p>Our header <code>DiffuseOneShadowRayPass.h</code> declares:</p></blockquote><p>æˆ‘ä»¬çš„å¤´æ–‡ä»¶ <code>DiffuseOneShadowRayPass.h</code> å£°æ˜ï¼š</p><figure class="highlight c++"><table><tbody><tr><td class="code"><pre><span class="line"><span class="type">uint32_t</span>  mFrameCount = <span class="number">0x1337</span>u;</span><br></pre></td></tr></tbody></table></figure><blockquote><p>This is a counter that increments each frame and only seeds our per-pixel random numbers. Because we donâ€™t want the same random number generator as <code>ThinLensGBufferPass</code> (or any of our other <code>RenderPasses</code>), we initialize <code>mFrameCount</code> to a different value in each pass. I picked somewhat arbitrary hexadecimal numbers, but thereâ€™s nothing special about these values <strong>except</strong> each pass is initialized uniquely.</p></blockquote><p>è¿™æ˜¯ä¸€ä¸ªè®¡æ•°å™¨ï¼Œå®ƒé€’å¢æ¯ä¸€å¸§å¹¶ä¸”åªæ’­ç§æˆ‘ä»¬çš„æ¯åƒç´ éšæœºæ•°ã€‚å› ä¸ºæˆ‘ä»¬ä¸æƒ³è¦ä¸ <code>ThinLensGBufferPass</code>ï¼ˆæˆ–ä»»ä½•å…¶ä»–<code>RenderPasses</code>ï¼‰ç›¸åŒçš„éšæœºæ•°ç”Ÿæˆå™¨ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨æ¯æ¬¡ä¼ é€’ä¸­åˆå§‹åŒ– <code>mFrameCount</code> ä¸ºä¸åŒçš„å€¼ã€‚æˆ‘é€‰æ‹©äº†ä¸€äº›ä»»æ„çš„åå…­è¿›åˆ¶æ•°å­—ï¼Œä½†æ˜¯è¿™äº›å€¼æ²¡æœ‰ä»€ä¹ˆç‰¹åˆ«ä¹‹å¤„ï¼Œ<strong>é™¤äº†</strong>æ¯ä¸ªé€šé“éƒ½æ˜¯å”¯ä¸€åˆå§‹åŒ–çš„ã€‚</p><blockquote><p>We also pass this <code>mFrameCount</code> down to our shader so we can use it:</p></blockquote><p>æˆ‘ä»¬è¿˜å°†å®ƒä¼ é€’ <code>mFrameCount</code> ç»™æˆ‘ä»¬çš„ç€è‰²å™¨ï¼Œä»¥ä¾¿æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å®ƒï¼š</p><figure class="highlight c++"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">auto</span> rayGenVars = mpRays-&gt;<span class="built_in">getRayGenVars</span>();</span><br><span class="line">rayGenVars[<span class="string">"RayGenCB"</span>][<span class="string">"gFrameCount"</span>] = mFrameCount++;</span><br></pre></td></tr></tbody></table></figure><h3 id="HLSL-Changes-for-Random-Light-Selection"><a href="#HLSL-Changes-for-Random-Light-Selection" class="headerlink" title="HLSL Changes for Random Light Selection"></a>HLSL Changes for Random Light Selection</h3><blockquote><p>Open up <code>diffusePlus1Shadow.rt.hlsl</code>. Our first change is we initialize a pseudorandom number generator using our input frame count:</p></blockquote><p>æ‰“å¼€ <code>diffusePlus1Shadow.rt.hlsl</code>ã€‚æˆ‘ä»¬çš„ç¬¬ä¸€ä¸ªå˜åŒ–æ˜¯æˆ‘ä»¬ä½¿ç”¨è¾“å…¥å¸§è®¡æ•°åˆå§‹åŒ–ä¸€ä¸ªä¼ªéšæœºæ•°ç”Ÿæˆå™¨ï¼š</p><figure class="highlight c++"><table><tbody><tr><td class="code"><pre><span class="line">[<span class="built_in">shader</span>(<span class="string">"raygeneration"</span>)]</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">LambertianShadowsRayGen</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">  ...</span><br><span class="line">  uint randSeed = <span class="built_in">initRand</span>( launchIndex.x + launchIndex.y * launchDim.x,</span><br><span class="line">                            gFrameCount );</span><br><span class="line">  ...</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><blockquote><p>Then when we are shading, we no longer loop over our lights:</p></blockquote><p>ç„¶åå½“æˆ‘ä»¬ç€è‰²æ—¶ï¼Œæˆ‘ä»¬ä¸å†å¾ªç¯æˆ‘ä»¬çš„ç¯å…‰ï¼š</p><figure class="highlight c++"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">// Old: loop over all lights</span></span><br><span class="line"><span class="comment">// for (int lightIndex = 0; lightIndex &lt; gLightsCount; lightIndex++)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// New: pick a single random light in [0...gLightsCount-1]</span></span><br><span class="line"><span class="type">int</span> lightIndex = <span class="built_in">min</span>( <span class="built_in">int</span>(gLightsCount * <span class="built_in">nextRand</span>(randSeed)), gLightsCount<span class="number">-1</span> );</span><br></pre></td></tr></tbody></table></figure><blockquote><p>The last consideration: because we use just a single light for shading, in a scene with <strong>N</strong> lights our random sampling will be too dark (by a factor of <strong>N</strong>). In <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Monte_Carlo_integration">Monte Carlo integration</a>, the contribution of each random sample should be divided by the probability of selecting that sample.</p></blockquote><p>æœ€åä¸€ä¸ªè€ƒè™‘ï¼šå› ä¸ºæˆ‘ä»¬åªä½¿ç”¨ä¸€ä¸ªç¯å…‰è¿›è¡Œç€è‰²ï¼Œåœ¨æœ‰<strong>N</strong>ä¸ªç¯å…‰çš„åœºæ™¯ä¸­ï¼Œæˆ‘ä»¬çš„éšæœºé‡‡æ ·ä¼šå¤ªæš—ï¼ˆ<strong>N</strong>å€ï¼‰ã€‚åœ¨<a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Monte_Carlo_integration">è’™ç‰¹å¡æ´›ç§¯åˆ†</a>ä¸­ï¼Œæ¯ä¸ªéšæœºæ ·æœ¬çš„è´¡çŒ®åº”è¯¥é™¤ä»¥é€‰æ‹©è¯¥æ ·æœ¬çš„æ¦‚ç‡ã€‚</p><blockquote><p>Our uniform random light selection (above) samples each light with probability <code>1.0f / N</code>, so when shading with a random light, we should multiply that lightâ€™s contribution by <code>N</code>. If using a more intelligent light sampling scheme, a more sophisticated probability must be computed. This means our shading computation changes:</p></blockquote><p>æˆ‘ä»¬çš„å‡åŒ€éšæœºå…‰é€‰æ‹©ï¼ˆä¸Šå›¾ï¼‰ä»¥æ¦‚ç‡ å¯¹æ¯ä¸ªå…‰è¿›è¡Œé‡‡æ · <code>1.0f / N</code>ï¼Œå› æ­¤å½“ä½¿ç”¨éšæœºå…‰è¿›è¡Œç€è‰²æ—¶ï¼Œæˆ‘ä»¬åº”è¯¥å°†è¯¥å…‰çš„è´¡çŒ®ä¹˜ä»¥ <code>N</code>ã€‚å¦‚æœä½¿ç”¨æ›´æ™ºèƒ½çš„å…‰é‡‡æ ·æ–¹æ¡ˆï¼Œåˆ™å¿…é¡»è®¡ç®—æ›´å¤æ‚çš„æ¦‚ç‡ã€‚è¿™æ„å‘³ç€æˆ‘ä»¬çš„ç€è‰²è®¡ç®—å‘ç”Ÿäº†å˜åŒ–ï¼š</p><figure class="highlight c++"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">// Old, per-light contribution when looping through all lights</span></span><br><span class="line"><span class="comment">// shadeColor += NdotL * lightColor * isLit * matlDiffuse / M_PI;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// New contribution for a single, randomly selected light</span></span><br><span class="line">shadeColor = gLightsCount * NdotL * lightColor * isLit * matlDiffuse / M_PI;</span><br></pre></td></tr></tbody></table></figure><h3 id="What-Does-it-Look-Like"><a href="#What-Does-it-Look-Like" class="headerlink" title="What Does it Look Like?"></a>What Does it Look Like?</h3><blockquote><p>That covers the important points of this tutorial. When running, you get the following result:</p></blockquote><p>è¿™æ¶µç›–äº†æœ¬æ•™ç¨‹çš„é‡ç‚¹ã€‚è¿è¡Œæ—¶ï¼Œæ‚¨ä¼šå¾—åˆ°ä»¥ä¸‹ç»“æœï¼š</p><p><img data-src="https://img.yousazoe.top/uPic/img/blog/icon/mona-loading-default.gif" data-original="https://cdn.jsdelivr.net/gh/Yousazoe/picgo-repo/img/Tutor11-Output-20220126150245601.png"></p><blockquote><p>The tutorial defaults to running with temporal accumulation enabled, so if you turn away for a moment, you might not see the difference from <a target="_blank" rel="noopener" href="http://cwyman.org/code/dxrTutors/tutors/Tutor9/tutorial09.md.html">Tutorial 9</a>. However, if you disable temporal accumulation, you will notice the shadows are significantly noisier.</p></blockquote><p>æœ¬æ•™ç¨‹é»˜è®¤åœ¨å¯ç”¨æ—¶é—´ç´¯ç§¯çš„æƒ…å†µä¸‹è¿è¡Œï¼Œå› æ­¤å¦‚æœæ‚¨è½¬èº«ç¦»å¼€ç‰‡åˆ»ï¼Œæ‚¨å¯èƒ½çœ‹ä¸å‡ºä¸<a target="_blank" rel="noopener" href="http://cwyman.org/code/dxrTutors/tutors/Tutor9/tutorial09.md.html">æ•™ç¨‹ 9</a>çš„åŒºåˆ«ã€‚ä½†æ˜¯ï¼Œå¦‚æœæ‚¨ç¦ç”¨æ—¶é—´ç´¯ç§¯ï¼Œæ‚¨ä¼šæ³¨æ„åˆ°é˜´å½±æ˜æ˜¾æ›´åŠ å˜ˆæ‚ã€‚</p><blockquote><p>Something we observed in our research: it is easier to denoise direct lighting than indirect, global lighting. This means if you decide to use a filter (like our <a target="_blank" rel="noopener" href="http://research.nvidia.com/publication/2017-07_Spatiotemporal-Variance-Guided-Filtering%3A">spatiotemporal variance-guded filter</a>) to reconstruct noisy results for your indirect lighting, you can probably save the cost of extra shadow rays for direct lighting. By the time you have enough information to reconstruct indirect light, you probably have more than enough to reconstruct your direct light, too.</p></blockquote><p>æˆ‘ä»¬åœ¨ç ”ç©¶ä¸­è§‚å¯Ÿåˆ°ï¼šç›´æ¥ç…§æ˜æ¯”é—´æ¥å…¨å±€ç…§æ˜æ›´å®¹æ˜“å»å™ªã€‚è¿™æ„å‘³ç€å¦‚æœæ‚¨å†³å®šä½¿ç”¨è¿‡æ»¤å™¨ï¼ˆä¾‹å¦‚æˆ‘ä»¬çš„ <a target="_blank" rel="noopener" href="http://research.nvidia.com/publication/2017-07_Spatiotemporal-Variance-Guided-Filtering%3A">æ—¶ç©ºæ–¹å·®å¼•å¯¼è¿‡æ»¤å™¨</a>ï¼‰æ¥é‡å»ºé—´æ¥ç…§æ˜çš„å™ªå£°ç»“æœï¼Œæ‚¨å¯èƒ½å¯ä»¥èŠ‚çœç›´æ¥ç…§æ˜çš„é¢å¤–é˜´å½±å…‰çº¿çš„æˆæœ¬ã€‚å½“ä½ æœ‰è¶³å¤Ÿçš„ä¿¡æ¯æ¥é‡å»ºé—´æ¥å…‰æ—¶ï¼Œä½ å¯èƒ½ä¹Ÿæœ‰è¶³å¤Ÿçš„ä¿¡æ¯æ¥é‡å»ºä½ çš„ç›´æ¥å…‰ã€‚</p><blockquote><p>When you are ready, continue on to <a target="_blank" rel="noopener" href="http://cwyman.org/code/dxrTutors/tutors/Tutor12/tutorial12.md.html">Tutorial 12</a>, which adds one bounce diffuse global illumination.</p></blockquote><p>å‡†å¤‡å¥½åï¼Œç»§ç»­<a target="_blank" rel="noopener" href="http://cwyman.org/code/dxrTutors/tutors/Tutor12/tutorial12.md.html">æ•™ç¨‹ 12</a>ï¼Œå®ƒæ·»åŠ äº†ä¸€ä¸ªåå¼¹æ¼«åå°„å…¨å±€ç…§æ˜ã€‚</p></div><div class="popular-posts-header">Related Posts</div><ul class="popular-posts"><li class="popular-posts-item"><div class="popular-posts-title"><a href="/archives/7dbe30e4.html" rel="bookmark">Blockwise Multi-Order Feature Regression for Real-Time Path Tracing Reconstruction</a></div></li><li class="popular-posts-item"><div class="popular-posts-title"><a href="/archives/971404c0.html" rel="bookmark">Rendering Course by Wangningbei</a></div></li><li class="popular-posts-item"><div class="popular-posts-title"><a href="/archives/8b6729fe.html" rel="bookmark">A Gentle Introduction to DirectX Raytracing 14</a></div></li></ul><footer class="post-footer"><div class="post-tags"><a href="/tags/Computer-Graphics/" rel="tag"># Computer Graphics</a> <a href="/tags/Ray-Tracing/" rel="tag"># Ray Tracing</a></div><div class="post-nav"><div class="post-nav-item"><a href="/archives/dd03028a.html" rel="prev" title="Static Libraries and ZERO Warnings"><i class="fa fa-chevron-left"></i> Static Libraries and ZERO Warnings</a></div><div class="post-nav-item"><a href="/archives/60029739.html" rel="next" title="Rendering Context">Rendering Context <i class="fa fa-chevron-right"></i></a></div></div></footer></article></div><script>window.addEventListener("tabs:register",()=>{let{activeClass:e}=CONFIG.comments;if(CONFIG.comments.storage&&(e=localStorage.getItem("comments_active")||e),e){let t=document.querySelector(`a[href="#comment-${e}"]`);t&&t.click()}}),CONFIG.comments.storage&&window.addEventListener("tabs:click",t=>{t.target.matches(".tabs-comment .tab-content .tab-pane")&&(t=t.target.classList[1],localStorage.setItem("comments_active",t))})</script></div><div class="toggle sidebar-toggle"><span class="toggle-line toggle-line-first"></span> <span class="toggle-line toggle-line-middle"></span> <span class="toggle-line toggle-line-last"></span></div><aside class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc">Table of Contents</li><li class="sidebar-nav-overview">Overview</li></ul><div class="post-toc-wrap sidebar-panel"><div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BC%95%E8%A8%80"><span class="nav-number">1.</span> <span class="nav-text">å¼•è¨€</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Changes-to-our-C-Render-Pass"><span class="nav-number">2.</span> <span class="nav-text">Changes to our C++ Render Pass</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#HLSL-Changes-for-Random-Light-Selection"><span class="nav-number">3.</span> <span class="nav-text">HLSL Changes for Random Light Selection</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#What-Does-it-Look-Like"><span class="nav-number">4.</span> <span class="nav-text">What Does it Look Like?</span></a></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person"><img class="site-author-image" itemprop="image" alt="Yousazoe" src="https://img.yousazoe.top/uPic/img/blog/icon/icon.jpeg"><p class="site-author-name" itemprop="name">Yousazoe</p><div class="site-description" itemprop="description">done is better than perfect</div></div><div class="site-state-wrap motion-element"><nav class="site-state"><div class="site-state-item site-state-posts"><a href="/archives/"><span class="site-state-item-count">311</span> <span class="site-state-item-name">posts</span></a></div><div class="site-state-item site-state-categories"><a href="/categories/"><span class="site-state-item-count">51</span> <span class="site-state-item-name">categories</span></a></div><div class="site-state-item site-state-tags"><a href="/tags/"><span class="site-state-item-count">79</span> <span class="site-state-item-name">tags</span></a></div></nav></div><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="mailto:zoeyousa@gmail.com" title="E-Mail â†’ mailto:zoeyousa@gmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i></a> </span><span class="links-of-author-item"><a href="https://github.com/Yousazoe" title="GitHub â†’ https://github.com/Yousazoe" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i></a> </span><span class="links-of-author-item"><a href="https://twitter.com/YousaZoe" title="Twitter â†’ https://twitter.com/YousaZoe" rel="noopener" target="_blank"><i class="fab fa-twitter fa-fw"></i></a> </span><span class="links-of-author-item"><a href="https://steamcommunity.com/profiles/76561198856466228/" title="Steam â†’ https://steamcommunity.com/profiles/76561198856466228/" rel="noopener" target="_blank"><i class="fab fa-steam fa-fw"></i></a> </span><span class="links-of-author-item"><a href="https://www.chess.com/member/yousazoe" title="Chess â†’ https://www.chess.com/member/yousazoe" rel="noopener" target="_blank"><i class="fa fa-chess-pawn fa-fw"></i></a> </span><span class="links-of-author-item"><a href="https://space.bilibili.com/399504060" title="Bilibili â†’ https://space.bilibili.com/399504060" rel="noopener" target="_blank"><i class="fa fa-th-large fa-fw"></i></a> </span><span class="links-of-author-item"><a href="/atom.xml" title="RSS â†’ /atom.xml"><i class="fa fa-rss fa-fw"></i></a></span></div><div class="cc-license motion-element" itemprop="license"><a href="https://creativecommons.org/licenses/by-nc-sa/4.0/zh-CN" class="cc-opacity" rel="noopener" target="_blank"><img src="https://img.yousazoe.top/uPic/img/blog/icon/mona-loading-default.gif" data-original="/images/cc-by-nc-sa.svg" alt="Creative Commons"></a></div></div><div class="twopeople"><div class="container" style="height:200px"><canvas class="illo" width="800" height="800" style="max-width:200px;max-height:200px;touch-action:none;width:640px;height:640px"></canvas></div><script src="https://img.yousazoe.top/js/twopeople1.js"></script><script src="https://img.yousazoe.top/js/zdog.dist.js"></script><script id="rendered-js" src="https://img.yousazoe.top/js/twopeople.js"></script><style>.twopeople{margin:0;align-items:center;justify-content:center;text-align:center}canvas{display:block;margin:0 auto;cursor:move}</style></div><div class="cc-license animated" itemprop="sponsor"><link rel="preconnect" href="https://www.netlify.com"><span class="exturl cc-opacity" title="Deploy with Netlify â†’ https://www.netlify.com" data-url="aHR0cHM6Ly93d3cubmV0bGlmeS5jb20="><img width="80" src="https://img.yousazoe.top/uPic/img/blog/icon/mona-loading-default.gif" data-original="https://www.netlify.com/img/global/badges/netlify-dark.svg" alt="Netlify"></span></div><div class="back-to-top motion-element"><i class="fa fa-arrow-up"></i> <span>0%</span></div></div></aside><div id="sidebar-dimmer"></div></div></main><footer class="footer"><div class="footer-inner"><div class="translate-style">ç¹/ç®€ï¼š<a id="translateLink" href="javascript:translatePage();">ç¹ä½“</a></div><script type="text/javascript" src="/js/tw_cn.js"></script><script type="text/javascript">var defaultEncoding=2,translateDelay=0,cookieDomain="https://tding.top/",msgToTraditionalChinese="ç¹ä½“",msgToSimplifiedChinese="ç®€ä½“",translateButtonId="translateLink";translateInitilization()</script><div class="beian"><a href="https://beian.miit.gov.cn/" rel="noopener" target="_blank">æ™‹ICPå¤‡2021009930å· </a><img src="https://img.yousazoe.top/uPic/img/blog/icon/mona-loading-default.gif" data-original="https://img.yousazoe.top/uPic/img/blog/icon/beian.png" style="display:inline-block"></div><div class="copyright">Â© 2020 â€“ <span itemprop="copyrightYear">2024</span> <span class="with-love"><i class="fa fa-heart"></i> </span><span class="author" itemprop="copyrightHolder">Yousazoe</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-chart-area"></i> </span><span title="Symbols count total">4.7m</span></div><div class="powered-by"><span><a target="_blank" rel="noopener" href="https://www.upyun.com/?utm_source=lianmeng&amp;utm_medium=referral"><img src="https://img.yousazoe.top/uPic/img/blog/icon/mona-loading-default.gif" data-original="https://cdn.jsdelivr.net/gh/YukiNoUta/cdn-static@main/blog/svg/upyun.svg" width="53" height="18" style="fill:currentColor;display:inline-block"></a></span><span class="post-meta-divider">|</span>ä»Šæ—©é›¾éœ¾è”½æ—¥ï¼Œä½†æ˜¯ä¸è¦å®³æ€•ï¼Œå¤ªé˜³ä¾æ—§åœ¨äº‘ç«¯</div><div class="busuanzi-count"><script data-pjax="" async="" src="js/busuanzi.pure.mini.js"></script><span class="post-meta-item" id="busuanzi_container_site_uv" style="display:inline"><span class="post-meta-item-icon"><i class="fa fa-user"></i> </span><span class="site-uv" title="Total Visitors"><span id="busuanzi_value_site_uv"></span> </span></span><span class="post-meta-divider">|</span> <span class="post-meta-item" id="busuanzi_container_site_pv" style="display:inline"><span class="post-meta-item-icon"><i class="fa fa-eye"></i> </span><span class="site-pv" title="Total Views"><span id="busuanzi_value_site_pv"></span></span></span></div></div></footer></div><script src="//unpkg.com/animejs@3.1.0/lib/anime.min.js"></script><script src="//npm.elemecdn.com/pjax/pjax.min.js"></script><script src="//lib.baomitu.com/jquery/3.6.0/jquery.min.js"></script><script src="//lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js"></script><script src="//unpkg.com/lozad@1.16.0/dist/lozad.min.js"></script><script src="//lib.baomitu.com/pangu/4.0.7/pangu.min.js"></script><script src="/lib/velocity/velocity.min.js"></script><script src="/lib/velocity/velocity.ui.min.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/pisces.js"></script><script src="/js/next-boot.js"></script><script>var pjax = new Pjax({
  selectors: [
    'head title',
    '#page-configurations',
    '.content-wrap',
    '.post-toc-wrap',
    '.languages',
    '#pjax'
  ],
  switches: {
    '.post-toc-wrap': Pjax.switches.innerHTML
  },
  analytics: false,
  cacheBust: false,
  scrollTo : !CONFIG.bookmark.enable
});

window.addEventListener('pjax:success', () => {
    $(document).ready(function () {

    if(location.href.indexOf("#reloaded")==-1){
        location.href=location.href+"#reloaded";
        location.reload();
    }
}ï¼‰
#åœ¨è¿™åé¢å¯ä»¥åŠ å…¥ç¨‹åºçš„å…¶ä»–ä»£ç   


  document.querySelectorAll('script[data-pjax], script#page-configurations, #pjax script').forEach(element => {
    var code = element.text || element.textContent || element.innerHTML || '';
    var parent = element.parentNode;
    parent.removeChild(element);
    var script = document.createElement('script');
    if (element.id) {
      script.id = element.id;
    }
    if (element.className) {
      script.className = element.className;
    }
    if (element.type) {
      script.type = element.type;
    }
    if (element.src) {
      script.src = element.src;
      // Force synchronous loading of peripheral JS.
      script.async = false;
    }
    if (element.dataset.pjax !== undefined) {
      script.dataset.pjax = '';
    }
    if (code !== '') {
      script.appendChild(document.createTextNode(code));
    }
    parent.appendChild(script);
  });

  
  NexT.boot.refresh();
  
  // Define Motion Sequence & Bootstrap Motion.
  if (CONFIG.motion.enable) {
    NexT.motion.integrator
      .init()
      .add(NexT.motion.middleWares.subMenu)
      .add(NexT.motion.middleWares.postList)
      .bootstrap();
  }
  
  NexT.utils.updateSidebarPosition();
});</script><script defer="" src="//img.yousazoe.top/js/three.min.js"></script><script defer="" src="//img.yousazoe.top/js/caidai.js"></script><script data-pjax="">!function(){var e,t,o,n,r=document.getElementsByTagName("link");if(0<r.length)for(i=0;i<r.length;i++)"canonical"==r[i].rel.toLowerCase()&&r[i].href&&(e=r[i].href);t=(e||window.location.protocol).split(":")[0],e=e||window.location.href,window,o=e,n=document.referrer,/([http|https]:\/\/[a-zA-Z0-9\_\.]+\.baidu\.com)/gi.test(o)||(t="https"===String(t).toLowerCase()?"https://sp0.baidu.com/9_Q4simg2RQJ8t7jm9iCKT-xh_/s.gif":"//api.share.baidu.com/s.gif",n?(t+="?r="+encodeURIComponent(document.referrer),o&&(t+="&l="+o)):o&&(t+="?l="+o),(new Image).src=t)}()</script><script src="/js/local-search.js"></script><script data-pjax="">document.querySelectorAll(".pdfobject-container").forEach(e=>{var t=e.dataset.target,a="#"+Object.entries({navpanes:0,toolbar:0,statusbar:0,pagemode:"thumbs",view:"FitH"}).map(([e,t])=>`${e}=${encodeURIComponent(t)}`).join("&"),r=`/lib/pdf/web/viewer.html?file=${encodeURIComponent(t)}${a}`;NexT.utils.supportsPDFs()?e.innerHTML=`<embed class="pdfobject" src="${t+a}" type="application/pdf" style="height: ${e.dataset.height};">`:e.innerHTML=`<iframe src="${r}" style="height: ${e.dataset.height};" frameborder="0"></iframe>`})</script><script data-pjax="">document.querySelectorAll("pre.mermaid").length&&NexT.utils.getScript("//lib.baomitu.com/mermaid/8.4.8/mermaid.min.js",()=>{mermaid.initialize({theme:"forest",logLevel:3,flowchart:{curve:"linear"},gantt:{axisFormat:"%m/%d/%Y"},sequence:{actorMargin:50}})},window.mermaid)</script><div id="pjax"><script src="https://unpkg.com/darkmode-js@1.5.7/lib/darkmode-js.min.js"></script><script>var options={bottom:"64px",right:"unset",left:"32px",time:"0.5s",mixColor:"transparent",backgroundColor:"transparent",buttonColorDark:"#100f2c",buttonColorLight:"#fff",saveInCookies:!0,label:"ğŸŒ“",autoMatchOsTheme:!0};const darkmode=new Darkmode(options);window.darkmode=darkmode,darkmode.showWidget()</script></div><script type="text/javascript" src="/js/cursor/fireworks.js"></script><script src="https://img.yousazoe.top/live2dw/lib/L2Dwidget.min.js"></script><script>L2Dwidget.init({pluginRootPath:"live2dw/",pluginJsPath:"lib/",pluginModelPath:"assets/",tagMode:!1,debug:!1,model:{jsonPath:"/live2dw/assets/assets/hijiki.model.json"},display:{position:"right",width:100,height:200},mobile:{show:!0},log:!1})</script><script>window.imageLazyLoadSetting={isSPA:!1,preloadRatio:5,processImages:null}</script><script>window.addEventListener("load",function(){var t=/\.(gif|jpg|jpeg|tiff|png)$/i,r=/^data:image\/[a-z]+;base64,/;Array.prototype.slice.call(document.querySelectorAll("img[data-original]")).forEach(function(a){var e=a.parentNode;"A"===e.tagName&&(e.href.match(t)||e.href.match(r))&&(e.href=a.dataset.original)})})</script><script>!function(n){n.imageLazyLoadSetting.processImages=o;var e=n.imageLazyLoadSetting.isSPA,i=n.imageLazyLoadSetting.preloadRatio||1,r=Array.prototype.slice.call(document.querySelectorAll("img[data-original]"));function o(){e&&(r=Array.prototype.slice.call(document.querySelectorAll("img[data-original]")));for(var t,a=0;a<r.length;a++)0<=(t=(t=r[a]).getBoundingClientRect()).bottom&&0<=t.left&&t.top<=(n.innerHeight*i||document.documentElement.clientHeight*i)&&function(){var e=r[a],t=e,n=function(){r=r.filter(function(t){return e!==t})},i=new Image,o=t.getAttribute("data-original");i.onload=function(){t.src=o,n()},t.src!==o&&(i.src=o)}()}o(),n.addEventListener("scroll",function(){var t=o,e=n;clearTimeout(t.tId),t.tId=setTimeout(function(){t.call(e)},500)})}(this)</script><script type="text/javascript" charset="utf-8" src="/js/lazyload-plugin/lazyload.intersectionObserver.min.js"></script></body></html>